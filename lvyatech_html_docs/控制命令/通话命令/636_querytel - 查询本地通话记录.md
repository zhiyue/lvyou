# querytel - 查询本地通话记录

---
- **页面ID**: 636
- **作者ID**: 1
- **创建时间**: 2025-07-02 21:07:32
- **分类ID**: 186
---

###“命令：querytel - 查询本地通话记录”使用说明
####命令的作用
　　开发板本身可以滚动存储最近的50条通话记录。通过 querytel 命令，可以查询开发板本地存储的最近50条通话记录。
  
####命令的格式（示例）
```
http://192.168.7.170/ctrl?token=3f4bffa77257d243875d0a5a80635934&cmd=querytel&p1=1&p2=10&p3=0
```
####命令的格式（TCP方式示例）
```
{"cmd":"querytel", "p1":1, "p2":10, "p3":0}\x11\x12
```
####命令参数说明
 | 参数名  | 参数值（示例）  |参数类型|说明|
| ------------ |:------------ |-----|--|
|token |3f4bffa77257d243875d0a5a80635934 |字符型|管理员Token|
|cmd  | querysms |字符型|控制命令名称|
|p1 |1 |数值型|从第几条短信开始查询（offset）|
|p2 |10 |数值型|共查询多少条（rows On Page）|
|p3 |10 |数值型|查询的通话类型。（0：所有；1：仅来电；2：仅外呼电话；3：仅漏接来电）|
|p4 |132 |字符型|限制查询的通话号码关键字（省略查所有）|
####命令反馈结果
成功时返回：
```json
{
  "subType": 31,
  "code": 0,
  "offset": "1",
  "limit": "3",
  "callType": 0,
  "qkey": "",
  "results": [
    {
      "slot": 1,
      "dir": 1,
      "phNum": "053256894747",
      "telStartTs": 1751421911,
      "telEndTs": 1751421941,
      "conn": 1
    },
    {
      "slot": 2,
      "dir": 0,
      "phNum": "13855668899",
      "telStartTs": 1751267248,
      "telEndTs": 1751267251,
      "conn": 0
    },
    {
      "slot": 2,
      "dir": 1,
      "phNum": "8613316582441",
      "telStartTs": 1751266780,
      "telEndTs": 1751266787,
      "conn": 0
    },
    {
      "slot": 1,
      "dir": 0,
      "phNum": "anonymous",
      "telStartTs": 1751017174,
      "telEndTs": 1751017202,
      "conn": 0
    }
  ],
  "devId": "e51e9881265a3c8",
  "type": 402,
  "netCh": 0,
  "msgTs": 1751461200
}
```

失败时返回：
```json
{
  "code": 101,
  "msg": "Invalid arguments."
}
```

####命令反馈结果说明
　　1）查询的通话记录，保存在results字段（集合）中。
  
　　2）p1参数指定从通话记录库的第几条开始查询（最值是1）， p2参数指定共查询多少条。
　　比如：当您需要分页查询，每页5条通话记录。查询第1页时，需要发送参数：
  ```p1=1(从第1条开始查询)；p2=5(共查询5条) ```
　　查询第2页时，需要发送参数：
    ```p1=6(从第1条开始查询)；p2=5(共查询5条) ```
　　依次类推。
  
　　3）当results字段中返回的记录数大于p2指定的查询条数时，表示后面还有更多记录可以查询。
　　比如：指定参数：p1=1, p2=5。返回的查询结果中results的记录数是6，表示本页查询完成后，后面还有更多的通话记录，可以继续查询。
　　同样的，如果指定参数：p1=1, p2=5。返回的查询结果中results的记录数是5 或 小于5。则表示本页面已经是最后一页了。后面没有更多通话记录了。
  
　　4）本地通话记录库是按通话时间“降序保存”的，即最后进行的通话，总是出现在通话记录库的第1页的第1条。如果您需要查询通话记录库中最近的5条记录，则指定的参数总是：
  ```p1=1(从第1条开始查询)；p2=5(共查询5条) ```
　　这样的话，querytel命令总是返回开发板最近记录的5条通话记录。
  
　　5）返回记录的结果的各字段意义解释：
```json
  "results": [
    {
      "slot": 1,	//卡槽号。1表示卡槽一
      "dir": 1,		//通话方向。 0表示呼入通话；1表示呼出通话
      "phNum": "053256894747",		//通话号码
      "telStartTs": 1751421911,		//通话开始时间戳
      "telEndTs": 1751421941,		//通话结束时间戳
      "conn": 1		//电话是否接通。0：未接通；1：已接通
    }]
```





