# 监测设备可用状态

---
- **页面ID**: 566
- **作者ID**: 1
- **创建时间**: 2025-05-15 19:02:12
- **分类ID**: 180
---

###概要
　　在开发服务器端时，需要在服务器端获得设备的工作状态，通常有两种方式：
　　1）主动给设备发送状态查询指令 
　　2）被动接收设备上报的PING消息
　　两种方式的使用场景不同。服务器端主动给设备发送状态查询指令，适用于**偶尔**获取设备的工作状态时使用，而被动接收设备上报的PING消息，则适用于**长时间**不间断的对设备工作状态进行监听。
  
  ###一、两种获取方式对比
  ####1. 主动查询（Request-Response 模式）
#####使用场景
　　需要即时获取设备当前状态时使用（例如：用户手动刷新界面、故障诊断时）
#####工作原理
　　服务器向设备发送 stat 等指令 → 设备立即响应状态数据
#####注意事项
　　▸ 每次查询会导致设备暂停当前任务处理请求（约 1000ms 阻塞）
　　▸ 严禁高频使用（如：定时循环查询），这会导致设备持续卡顿
　　▸ 典型错误示例：setInterval(getDeviceStatus, 10000) // 每10秒轮询
　　
  ####2. 被动监听（Heartbeat 模式）
#####使用场景
　　需要 7×24 小时持续监控设备在线状态时使用
#####工作原理
　　设备定期（如 60 秒）自动发送PING报文 → 服务器记录最后活跃时间
#####技术优势
　　▸ 无设备端阻塞（后台低功耗运行）
　　▸ 网络开销小（每次报文 < 1KB）
  
  ####主动查询使用限制
  | 允许场景  |  禁止场景 |
| ------------ | ------------ |
| 心跳超时（3 次未收到 PING）  |  定时轮询（即使间隔 600 秒以上）  |
| 用户主动操作  | 批量设备同时查询  |

 

  ####被动PING消息接收流程
　　***1）正常状态***：依赖设备 PING 报文更新最后活跃时间
　　***2）当连续 3 次未收到 PING ***：假设PING消息间隔60秒，则 60（间隔秒数） * 3（次） + 8（冗余秒数） = 188秒，188秒内未收到设备上报的PING消息时，触发设备离线提醒。

###特别说明：
　　除本文上述的两种监测方式之外，其它监测方法均不推荐，包括且不限于：
　　1）尝试向设备发送 TCP ping 消息（包括win/linux中的ping命令），监听TCP是否畅通。此方法并不能可靠的监测设备的状态，不推荐使用。
　　2）尝试定期轮询设备的后台WEB页面（http://192.168.1.50:38585/mgr ）通过是否能访问到后台页面，做为监测设备是否可用的依据，此方法可能会导致设备失去响应，必须严格禁止。
  
　　合理使用主动查询与被动查询，这种设计既能保证实时性，又避免给设备造成持续性压力。

