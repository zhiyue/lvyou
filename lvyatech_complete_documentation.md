## 目录

- [简介](#简介)
- [版本变更](#版本变更)
- [进入设备管理后台](#进入设备管理后台)
- **常见问题/**
  - [相关配件的采购](#相关配件的采购)
  - [如何将开发板重置回出厂设置](#如何将开发板重置回出厂设置)
  - [通过短信不能获取WIFI的IP地址](#通过短信不能获取wifi的ip地址)
- **开发实践指南/**
  - [关于接口类型](#关于接口类型)
  - [开发板数据交互指南](#开发板数据交互指南)
  - [监测设备可用状态](#监测设备可用状态)
- **快速入门/**
  - [开发板连入WIFI](#开发板连入wifi)
  - [获取开发板的ＩＰ地址](#获取开发板的ｉｐ地址)
  - [配置开发板接口信息](#配置开发板接口信息)
  - [服务器端接收推送消息](#服务器端接收推送消息)
- **接入第三方平台/**
  - [接入企业微信群](#接入企业微信群)
  - [适配“绿微平台”普通WEB接口](#适配-绿微平台-普通web接口)
  - [接入Bark iOS](#接入bark-ios)
  - [接入钉钉群](#接入钉钉群)
  - [接入飞书群](#接入飞书群)
  - [接入Server酱Turbo](#接入server酱turbo)
  - [接入Server酱3](#接入server酱3)
- **控制命令/**
  - [什么是控制命令](#什么是控制命令)
  - [安全模型与token机制](#安全模型与token机制)
  - **OTA升级命令/**
    - [dailyota - 设置每日OTA升级时间](#dailyota-设置每日ota升级时间)
    - [otanow- 立即执行OTA升级](#otanow-立即执行ota升级)
  - **WiFi控制命令/**
    - [wf - 打开或关闭wifi](#wf-打开或关闭wifi)
    - [addwf - 增加wifi热点信息](#addwf-增加wifi热点信息)
    - [delwf - 删除wifi热点信息](#delwf-删除wifi热点信息)
  - **卡槽控制命令/**
    - [slotoff - 指定卡槽关机](#slotoff-指定卡槽关机)
    - [slotrst - 指定卡槽重启](#slotrst-指定卡槽重启)
    - [slotplmn - 指定卡注册的运营商](#slotplmn-指定卡注册的运营商)
  - **短信命令/**
    - [sendsms - 外发短信](#sendsms-外发短信)
    - [querysms - 查询本地短信库](#querysms-查询本地短信库)
  - **设备控制类命令/**
    - [chpwduser - 修改用户密码](#chpwduser-修改用户密码)
    - [now - 设置开发板时间](#now-设置开发板时间)
    - [stat - 获取开发板状态](#stat-获取开发板状态)
    - [restart - 重启开发板](#restart-重启开发板)
    - [pingsec - 修改ping间隔秒数](#pingsec-修改ping间隔秒数)
    - [dailyrst - 设置每日重启时间](#dailyrst-设置每日重启时间)
  - **通话命令/**
    - [通话指令概述](#通话指令概述)
    - [teldial - 电话拨号](#teldial-电话拨号)
    - [telanswer - 接听来电](#telanswer-接听来电)
    - [telhangup - 电话挂机](#telhangup-电话挂机)
    - [telstarttts - 播放TTS语音](#telstarttts-播放tts语音)
    - [telstoptts- 停止播放TTS语音](#telstoptts-停止播放tts语音)
    - [querytel - 查询本地通话记录](#querytel-查询本地通话记录)
    - [telkeypress - 本地电话按键](#telkeypress-本地电话按键)
- **推送消息/**
  - [什么是推送消息](#什么是推送消息)
  - [消息推送的顺序](#消息推送的顺序)
  - **其它消息/**
    - [998 - 设备PING消息](#998-设备ping消息)
  - **短信消息/**
    - [501 - 新短信消息](#501-新短信消息)
    - [502 - 外发短信成功消息](#502-外发短信成功消息)
  - **设备状态消息/**
    - [100 - WIFI已联网](#100-wifi已联网)
    - [101 - SIM1已联网](#101-sim1已联网)
    - [102 - SIM2已联网](#102-sim2已联网)
    - [202 - SIM卡基站注册](#202-sim卡基站注册)
    - [203 - SIM卡IMSI上报](#203-sim卡imsi上报)
    - [204 - SIM卡已就绪](#204-sim卡已就绪)
    - [205 - SIM卡已弹出](#205-sim卡已弹出)
    - [209 - SIM卡错误](#209-sim卡错误)
    - [301 - 通信模组异常](#301-通信模组异常)
  - **通话消息/**
    - [601 - 来电振铃消息](#601-来电振铃消息)
    - [602 - 来电接通消息](#602-来电接通消息)
    - [603 - 来电挂断消息](#603-来电挂断消息)
    - [620 - 去电拨号消息](#620-去电拨号消息)
    - [621 - 去电振铃消息](#621-去电振铃消息)
    - [622 - 去电接通报告](#622-去电接通报告)
    - [623 - 去电挂断报告](#623-去电挂断报告)
    - [641 - 通话本地按键](#641-通话本地按键)
    - [642 - 通话远程按键](#642-通话远程按键)
- **短信指令/**
  - [什么是短信指令](#什么是短信指令)
  - **用户短信指令/**
    - [pwd - 修改用户密码](#pwd-修改用户密码)
    - [stat - 查询开发板当前状态](#stat-查询开发板当前状态)
    - [wf - 打开关闭wifi及查询状态](#wf-打开关闭wifi及查询状态)
    - [addwf - 增加wifi热点信息](#addwf-增加wifi热点信息)
    - [restart - 控制开发板重启](#restart-控制开发板重启)
  - **管理短信指令/**
    - [pm99inf - 变更接口地址](#pm99inf-变更接口地址)
    - [pm99msgid - 变更上报消息](#pm99msgid-变更上报消息)
    - [pm99aes - 变更加密设置](#pm99aes-变更加密设置)
    - [pm99admpwd - 变更管理密码](#pm99admpwd-变更管理密码)
    - [pm99usrpwd - 变更用户密码](#pm99usrpwd-变更用户密码)
    - [pm99rst - 重启开发板](#pm99rst-重启开发板)
- **硬件安装/**
  - [开发板硬件介绍](#开发板硬件介绍)
  - [电源头规格说明](#电源头规格说明)
- **设备管理后台/**
  - [进入设备管理后台](#进入设备管理后台)
  - **接口信息配置/**
    - [功能概述](#功能概述)
    - [接口地址设置](#接口地址设置)
    - [HTTP接口设置](#http接口设置)
    - [TCP接口设置](#tcp接口设置)
    - [接口消息设置](#接口消息设置)
    - [其它设置](#其它设置)
  - **系统参数管理/**
    - [功能概述](#功能概述)
    - [隐含的系统参数](#隐含的系统参数)
  - **用户参数管理/**
    - [功能概述](#功能概述)
    - [关于“参数引用”](#关于-参数引用)
    - [关于“适用消息ID”](#关于-适用消息id)
  - **自定义接口消息/**
    - [功能概述](#功能概述)
  - **密码管理/**
    - [功能概述](#功能概述)
  - **附加函数/**
    - [附加函数概述](#附加函数概述)
    - [附加函数清单](#附加函数清单)

---

# 《绿邮® X系列开发板》使用指南 - 完整文档


本文档由多个独立的Markdown文件合并而成，用于大模型阅读和理解。


---


<a name="简介"></a>

## 简介


　　**绿邮® X系列开发板**是一款全功能的嵌入式双卡双待4G全网通开发板，基于C/C++和部分汇编开发。
  
　　使用**绿邮® X系列开发板**进行二次开发，不用考虑电压、信号、底层协议等繁琐的技术细节，可以简便的与各种高级语言（如Java、C#、Asp.net、Perl、PHP等）进行对接。
  
　　**绿邮® X系列开发板**将底层细节封装成了HTTP或TCP协议，以Form或Json格式与您的接口进行数据交互。开发板适用于各种行业，如政务、应急救援、保险、自动告警、移动通信等，可以帮助您快速开发新产品。
　　
  ![](images/87b7fe52_6825457298512.png)
　　
  　　
　　**完整产品图示：**
![](images/b3b1cd56_63c356034f698.png)

---

<a name="版本变更"></a>

## 版本变更


#####v109版本:
>【新增】新增$iifeq()附加函数。
>【修正】控制命令 telanswer 命令中带有TTS语音参数时，TTS播放异常的问题。
>【修正】外发纯英文短信最后出现@@@字符的问题。
>【修正】定时重启不生效的问题

#####v108版本:
>内测版本，略。


#####v107版本:
>【新增】短信与电话记录的本地存储，短信滚动存储最近100条；电话滚动存储最近50条。
>【新增】新增querysms 与 querytel 控制命令，可以查询设备中最近的短信与电话记录。
>【新增】新增slotplmn控制命令，针对境外卡在本地落地时，可以用户指定落地的运营商。
>【新增】新增短信指令：*#wf#，可以通过短信打开或关闭WIFI。
>【优化】对100~102的联网消息，新增字段hwVer（开发版固件版本号）、slotInfo（各卡槽当前状态），方便接口端无需记录设备卡槽状态，每次开发板上线时，可以直接读取各卡槽状态，简化开发。
>【优化】对100~102，203~204消息新增plmn字段，显示卡注册到的运营商代码。
>【优化】对401~402消息，新增subType，用于指明当前的回应消息的具体类型。
>【优化】优化显示屏的字体。
>【优化】将默认的devId的生成策略，改为{{WIFI_S_MAC}}。
>【修正】修正附加函数$substr()多截取一个字符的问题。
>【修正】修正关屏状态下，按键失效的错误。

#####v106版本:
>【新增】新增$concat()附加函数，可用于多个字符串拼接。
>【新增】新增引用参数：{{WIFI_F_MAC}}：开发板完整MAC地址；
　　　　　　　　　　　{{WIFI_S_MAC}}：开发板简化MAC地址；
　　　　　　　　　　　{{PRODUCT_MODEL}}：开发板产品型号（X31);
　　　　　　　　　　　{{PRODUCT_VRE}}：开发板固件版本号(106);
>【新增】新增开发板“运行参数管理”功能页面。
>【新增】新增计算式中附加函数的参数，可以再次引用另一个参数。
　　　　示例：{{devId|$concat('-', '{{PRODUCT_MODEL|$toLower()}}')}}
　　　　☆已知缺陷：附加函数的参数中，再次引用的附加函数不能携带参数。
　　　　　　√正确：{{devId|$concat('-', '{{PRODUCT_MODEL|$toLower()}}')}}
　　　　　　x 错误：{{devId|$concat('-', '{{PRODUCT_MODEL|$replace('a','b')}}')}}
	
>【优化】优化了“救援模式”中，“救援升级”与“恢复出厂”的操作流程。
>【优化】对开发板默认的devId以及“主机名”的生成算法进行了开放，允许用户自定义。
>【优化】对开发板的“控制指令”中的token算法进行了开放，允许用户自定义。
>【优化】对pm99factreset短信命令的流程进行了优化，改为短信发出后，按下开发板按键后执行重置。
>【优化】删除factreset#ready短信命令及相关文档
>【优化】“stat”命令中的mem字段，显示开发板内存空闲的百分比。
>【优化】优化了WIFI接收数据的底层算法。
>【优化】优化了通过WIFI通道的NTP时间同步算法。
>【修正】修正开发板上按键判断的一个ＢＵＧ。
>【修正】修正ＭＡＣ地址显示时，对于“０１”显示为“１”，未正确补０的问题。

#####v105版本:
>【新增】 设备端后台增加WiFi信道干扰图示。
>【新增】 新增$sha256()附加函数，可用于sha-256计算。
>【修正】 优化定时自动重启和升级检查的算法。
>【修正】 修正显示屏的WiFi信号显示错误的问题。
>【修正】 优化推送消息的charset字段的值，暂时固定为utf8。
>【修正】 修正http上报时自定义http header不能同步上报的问题。

#####v104版本:
>【新增】 长短信上报新增smsGroupId字段用于二次拼接。
>【修正】 某些情况下外发短信不完整的问题。
>【修正】 显示屏按键顺序与习惯不符的问题。
>【修正】 文档中“转发企业微信”一节中的示例代码错误。

#####v101版本：
>【新增】 新版发布。

---

<a name="进入设备管理后台"></a>

## 进入设备管理后台


　　与家里使用的路由器类似，开发板也有一套“后台管理页面”。当开发板正确连上WIFI热点之后，您就可以登录到开发板的“设备管理后台”WEB页面，完成开发板相关的配置与管理工作。

#####进入设备管理后的步骤：

　　（1）参照“快速入门”章节，开发板正确插卡、通电之后，给设备中的卡发送短信：
`*#addwf#000000#WiFi热点名#WiFi热点密码`
　　开发板收到包含有WIFI热点信息的“短信指令”后，会自动的搜索并连入指定的WIFI热点。（注意：热点必须是2.4G，不能是5G）

　　（2）参照“快速入门”章节中的“获取开发板的ＩＰ地址”一节，获取到当前开发板的IP地址，然后在浏览器中访问以下地址，进入到“设备管理后台”WEB页面。
    `http://192.168.7.170/mgr`
　　其中，此处的192.168.7.170是假设已经获取到的开发板IP地址，您实际获取到的IP地址可能与示例不同，实际使用时，请替换成您实际的IP地址即可。

　　（3）在浏览器中输入开发板后面管理页面的地址，登录到开发板后面管理页面。注意：首次登录时可能会提示您输入管理员名称、密码，以验证您的管理身份。开发板出厂默认的登录名称、密码分别是：admin、admin，您初次登录成功之后，可以在“设备管理后台”页面中修改默认的管理密码。
  
**设备管理后台图示如下：**
![](images/2050147d_6825f3588a51e.png)

　
　　设备管理后台的首页主要包括三个部分：

　　第一部分是“**标题区域**”，包括了当前设备的版本号 以及 设备代码。设备代码是全球唯一的设备ID，每一张开发板都有一个全球唯一的ID标识。
  
　　第二部分是“**设备配置**”区域，通过设备配置的相关子功能，您可以完成诸如接口信息配置，系统运行参数配置、设备密码管理等相关的信息配置工作，方便您将开发板连入到您指定的接口或第三方平台中。
  
　　第三部分是“**管理工具**”区域，您可以通过开发板提供的管理工具功能，方便的对开发中的接口推送结果进行调试，或者是对开发板的配置信息进行统一的备份或恢复。
  
　　在后面的章节中，我们将向您介绍每一个功能的具体使用方法。

---


## 常见问题

<a name="相关配件的采购"></a>

### 相关配件的采购


为了方便您使用，以下是开发板常见配件的建议采购连接，供您参考。

######通用外壳采购地址：
外壳的具体规格为：125ｍｍ x 85ｍｍ x 28ｍｍ（长宽高），外壳实物如下：
![](常见问题/images/90d9e525_63c0faaa1ecd9.jpg)
商家一（外壳质量相对较好，选128x85x28款，偶尔断货）：https://item.taobao.com/item.htm?spm=a1z09.2.0.0.eb3d2e8dwnyOWk&id=613307002286&_u=u2l7rdg671e6

商家二（外壳质量相对一般，选125x85x30款，货量充足）：https://item.taobao.com/item.htm?spm=a1z09.2.0.0.7cba2e8dMZyQcQ&id=678304074360&_u=h2l7rdg6ab28

　　
######电源采购地址：
只要是符合5v电压，能提供2A以上电流的正规USB电源，都可以使用。（少量购买时，建议自行淘宝）

单头电源商家推荐：https://detail.1688.com/offer/559367703275.html
单头电源商家推荐：https://detail.1688.com/offer/670168249877.html
推荐选购带3C认证的电源。
注意:电压必须是５Ｖ，电流必须大于或等于２Ａ。如采购的是5v1A电源，将无法正常供电。
（1688需要批量下单，不接散单。最小发货数自己沟通。）

多头电源商家推荐：https://detail.1688.com/offer/591995310066.html
推荐选购10A/50W的款式。

---

<a name="如何将开发板重置回出厂设置"></a>

### 如何将开发板重置回出厂设置


#####将开发板重置回出厂设置
　　您可以将开发板重置回出厂设置，重置完成之后，所有的配置信息都将丢失，管理员密码、用户密码也将重置回出厂默认值。
　　有以下几种方法，可以将开发板重置回出厂状态：
  
######方法一）通过短信/控制指令，重置出厂设置
　　开发板处于正常开机状态之后，给开发板中的任意一张卡发**短信指令**：
 `*#pm99factreset#7257d243875d0a5a`
　　注：7257d243875d0a5a为设备的“短token”（参见设备管理后台--“密码管理”功能）。
 
　　对应的**控制指令**格式为：
```
https://开发板IP地址/ctrl?token=3f4bffa77257d243875d0a5a80635934cmd=factreset
```
　　对应的TCP接口的控制指令格式为：
```
{"cmd":"factreset", "tid":"1234"}\x11\x12
```
  ####指令参数说明
 | 参数（示例） |说明|
| ------------  |--|
|*#pm99factreset#   |短信指令名称|
|设备token |设备的短token（参见 安全模型与token 章节）|

######方法二）通过临时热点，重置出厂设置
　　（2.1）在手机上开启一个临时热点，热点名称、热点密码都是以下固定内容：
 `LYFACTRESET`
 
　　在手机上开启一个名称与密码都是 LYFACTRESET 的临时热点。
　　 （**注意：手机临时热点必须是2.4G，不能是5G**）
   ![](常见问题/images/15b4b797_6853c9ce4c556.jpg)
  
　　（2.2）保持手机临时热点开启，不要关闭，然后将开发板断电重启。
　　（2.3）开发板重启后，将会主动连入您的手机热点，并发出：滴~滴~滴~ 的声音。
　　（2.4）确认无误后，同时按下开发板的SEL+OK两个按键，听到长嘀声后，出厂设置恢复完成。
　　（2.5）关闭手机上的临时热点，开发板自动重启，恢复出厂设置完成。

---

<a name="通过短信不能获取wifi的ip地址"></a>

### 通过短信不能获取WIFI的IP地址


#####通过短信（*#wf#000000）不能获取WIFI的IP地址，短信中提示：IP正在获取中
　　这种情况通常发生在，您之前登录过开发板的后台WEB管理界面，并配置过开发板的接口地址。
　　当您配置的接口地址，变的“无法访问”时，开发板在自动尝试重连WIFI，然后再次重新尝试连接您提供的接口地址，并循环这个过程，一直到您的接口地址可以正常访问为止。
　　所以，由于开发板不停的重连WIFI，并重连您的接口，此时开发板是无法获取到IP地址的，您也无法登录后台WEB管理页面。
######解决方案
　　有两种解决方法：
　　1.如果是您的接口故障，导致开发板无法正常连接到您的接口，此时，您需要做的是尽快解决您接口一端的故障。当您的接口故障排除之后，开发板会自动的恢复到正常工作的状态中；
  
　　2.如果您的接口地址已经改变，即开发板原来存储的接口地址信息，已经不需要再使用了，您需要给开发板更换一个新的接口地址时，此时，您需要将开发板重置回出厂设置，然后重新配置开发板的WIFI，并登录开发板的后台WEB管理页面，重新为配置新的接口地址信息。
　　关于将开发板恢复出厂设置的方法，您可以参照```将开发板重置回出厂设置```的相关章节。

---


## 开发实践指南

<a name="关于接口类型"></a>

### 关于接口类型


#####开发板支持的接口类型
　　在当前发布的固件中，开发板支持HTTP、TCP两种接口。如果您熟悉WEB开发，您可以搭建一个HTTP Server，并最终向开发板提供一下标准的HTTP URL地址，做为数据接收的地址。
　　如果您熟悉C/S开发，您可以搭建一个TCP Server，并按下述格式向开发板提供TCP Server的通信地址和端口号：`tcp://192.168.7.101:3888`
　　如果是用于生产环境，有条件的话优先推荐使用TCP接口。TCP接口功能强大，速度快，稳定性好。次选HTTP POST+FORM接口，这个接口的简单易用、开发速度快、兼容性好。

#####接口间的优缺点分析
###### HTTP接口
　　HTTP接口采用了标准的HTTP通信协议，支持GET、POST两种方式传递数据。
**优点：**使用简单、兼容性好。
**缺点：**1.开发板必须连入WIFI热点，开发板才能执行OTA升级。
　　　2.除非您的HTTP Server与开发板处于同一个网段内，否则的话，如果您的HTTP Server搭建在云端公网，需要向开发板反向发送**控制指令**会比较困难。通常，您需要借助DDNS反向解析等技术，才能实现**控制指令**从云端公网至局域网的反向数据传送。
   
###### HTTP接口哪一种模式最值得推荐？
　　HTTP接口支持GET、POST两种方式传递数据，具体的数据封装支持FORM、JSON两种。从设备稳定性角度而言，用于生产环境时，我们最推荐的是 POST+FORM 这种组合。这种组合速度快、占用资源少、兼容性好。
   

######TCP接口
　　TCP接口采用了基于JSON格式的私有数据协议，在每条JSON消息之后增加2个字节的二进制结束符（0x11 0x12）作为消息的结束标志。
**优点：**1.支持WIFI + 手机卡网络智能联网调度。即，在有WIFI网络时，数据传送优先使用WIFI，当WIFI异常断开后，开发板会自动尝试通过手机卡网络传送数据，直到WIFI网络恢复正常。
　　　2.支持纯手机卡网络传送数据，并可以在多个卡槽之间（如果开发板上同时插了多张手机卡），进行智能联网调度。开发板中的任何一张卡能正常联网，即可保持正常的数据传送。
　　　3.反向发送**控制指令**简单。即使您的TCP Server搭建在云端公网，从云端公网向局域网中的开发板发送**控制指令**，也十分的容易。
**缺点：**1.相对于HTTP接口方式，TCP接口本身开发调试，都具有一定的复杂性。
　　　2.在没有连入WIFI网络的情况下，开发板不能执行OTA（设备固件空中升级）功能。

　　如果您喜欢TCP接口方式，我们推荐您使用**网络调试助手**这个工具辅助您的开发。此工具的下载地址是：http://www.cmsoft.cn/resource/102.html
  
######最不推荐的接口模式是什么？
　　如果是用于生产环境，我们最不推荐的是HTTPS接口。由于HTTPS接口要进行大量加密、解密运算，对设备的负担较重，并不利于设备的长期稳定运行。如果您对数据传输加密有要求，建议您可以使用开发板自带的AES通讯加密功能，即HTTP+AES或TCP+AES。

---

<a name="开发板数据交互指南"></a>

### 开发板数据交互指南


#####概要
　　开发板本身属于**资源受限的**嵌入式开发设备，开发板每一次向服务器端发送HTTP请求时，都会对开发板自身产生较高的资源占用。其中HTTPS占用最高，每次的HTTPS请求几乎需要占用50％左右的资源（大量的数据RSA加解密操作）。相较于HTTPS请求，每一次的HTTP请求的资源占用会小很多，而TCP接口的资源占用最小。
　　所以，当接口端（服务器端）收到开发板推送的数据后，应在**最短的时间内**完成数据接收并应答，尽快结束本轮的数据上报动作。
  ####以下是正确的应答流程：

  ```plantuml
@startuml
开发板 -> 用户接口: 　　　　　（1）上报HTTP请求
|||
用户接口 <--  用户接口: 　（2）缓存数据
note right
将开发板上报的数据进行缓存
（此时不要进行业务处理）
end note
|||
开发板 <- 用户接口 : 　　　（3）回应HTTPCode : 200　　　　
note left
确保在最短时间内
完成应答
end note
|||
用户接口 <-- 用户接口 : 　（4）接口端业务处理
note right
获取缓存的数据，
进行后续的业务逻辑处理
end note
@enduml
```
　
 　
  ####以下是错误的应答流程：
```plantuml
@startuml
participant 开发板

开发板 -> 用户接口: 　　上报HTTP请求
activate 用户接口

用户接口 -> 接口端处理A:  　<<后续业务逻辑>>　
activate 接口端处理A

接口端处理A -> 接口端处理N...:  　<<后续业务逻辑>>　
activate 接口端处理N...
|||
接口端处理N... --> 接口端处理A: 　业务处理完成
deactivate 接口端处理N...

接口端处理A --> 用户接口: 　业务处理完成
deactivate 接口端处理A

用户接口 -> 开发板: 　回应HttpCode:200　
destroy 用户接口
note left
响应时间过长会导致
开发板上报超时
或开发板通道阻塞
end note
@enduml
```

---

<a name="监测设备可用状态"></a>

### 监测设备可用状态


#####概要
　　在开发服务器端时，需要在服务器端获得设备的工作状态，通常有两种方式：
　　1）主动给设备发送状态查询指令 
　　2）被动接收设备上报的PING消息
　　两种方式的使用场景不同。服务器端主动给设备发送状态查询指令，适用于**偶尔**获取设备的工作状态时使用，而被动接收设备上报的PING消息，则适用于**长时间**不间断的对设备工作状态进行监听。
  
  ###一、两种获取方式对比
  ####1. 主动查询（Request-Response 模式）
######使用场景
　　需要即时获取设备当前状态时使用（例如：用户手动刷新界面、故障诊断时）
######工作原理
　　服务器向设备发送 stat 等指令 → 设备立即响应状态数据
######注意事项
　　▸ 每次查询会导致设备暂停当前任务处理请求（约 1000ms 阻塞）
　　▸ 严禁高频使用（如：定时循环查询），这会导致设备持续卡顿
　　▸ 典型错误示例：setInterval(getDeviceStatus, 10000) // 每10秒轮询
　　
  ####2. 被动监听（Heartbeat 模式）
######使用场景
　　需要 7×24 小时持续监控设备在线状态时使用
######工作原理
　　设备定期（如 60 秒）自动发送PING报文 → 服务器记录最后活跃时间
######技术优势
　　▸ 无设备端阻塞（后台低功耗运行）
　　▸ 网络开销小（每次报文 < 1KB）
  
  ####主动查询使用限制
  | 允许场景  |  禁止场景 |
| ------------ | ------------ |
| 心跳超时（3 次未收到 PING）  |  定时轮询（即使间隔 600 秒以上）  |
| 用户主动操作  | 批量设备同时查询  |

 

  ####被动PING消息接收流程
　　***1）正常状态***：依赖设备 PING 报文更新最后活跃时间
　　***2）当连续 3 次未收到 PING ***：假设PING消息间隔60秒，则 60（间隔秒数） * 3（次） + 8（冗余秒数） = 188秒，188秒内未收到设备上报的PING消息时，触发设备离线提醒。

#####特别说明：
　　除本文上述的两种监测方式之外，其它监测方法均不推荐，包括且不限于：
　　1）尝试向设备发送 TCP ping 消息（包括win/linux中的ping命令），监听TCP是否畅通。此方法并不能可靠的监测设备的状态，不推荐使用。
　　2）尝试定期轮询设备的后台WEB页面（http://192.168.1.50:38585/mgr ）通过是否能访问到后台页面，做为监测设备是否可用的依据，此方法可能会导致设备失去响应，必须严格禁止。
  
　　合理使用主动查询与被动查询，这种设计既能保证实时性，又避免给设备造成持续性压力。

---


## 快速入门

<a name="开发板连入wifi"></a>

### 开发板连入WIFI


　　参照“SIM卡插卡说明”一节，给开发板插上SIM卡并通电。插卡通电完成之后，接下来，首先让开发板连入附近的WiFi热点。（注意：连入的WiFi热点必须是２.４Ｇ制式）
  
　　确保开发板中的手机卡，已经处于正常待机状态（可以拨打电话测试，正常情况下，应该能听到“无人接听”的回铃音）之后，编辑以下格式的**短信指令**，用自己的手机发送以下短信内容到开发板中的任意一张手机卡上：
　　
`*#addwf#000000#热点名#热点密码`
　　
######短信指令格式说明：
- `*#addwf#`：短信指令的固定开头。表示让开发板接收一个新的WiFi热点信息。
- `000000`：　　开发板的**用户密码**，出厂默认是000000。（如果您自行修改过，需要替换成您自己的密码）
- `热点名`：开发板附近可以连入的WiFi名。
- `密码`：　开发板附近可以连入的WiFi密码。

######示例：
　　比如，在开发板附近有一个可以连入的WiFi热点，名称是：**myhome**，热点密码是：12345678。您可以编辑以下格式的**短信指令**:
  
`*#addwf#000000#myhome#12345678`
　　
　　您可以在自己的手机上编辑好上述内容的短信，发送到开发板的任意一张手机卡上即可。开发板在收到您的短信之后，会通过设备中收到短信的手机卡，给您的手机回复一条短信，短信内容大意如下：
  
```
设备(498060912345)已经收到新的热点名：mywifi；密码：12345678
```
　　
　　此时，开发板上的**WIFI指示灯**开始进入闪烁状态，表示正在尝试连入您提供的WIFI热点。
　　当开发板正确连入了您提供的WIFI热点之后，开发板上的**WIFI指标灯**将由闪烁，变为**绿灯常亮不闪**的状态，表示开发板连入WIFI热点成功。

---

<a name="获取开发板的ｉｐ地址"></a>

### 获取开发板的ＩＰ地址


　　开发板正确连入了您指定的WiFi热点之后，您需要获取开发板的IP地址，以便于登录开发板的WEB管理端，完成进一步的用户接口信息的配置。
　　有多种方法，可以获取到开发板的IP地址：
　　1. 通过**短信指令**获取开发板IP地址（推荐）。
　　2. 通过UDP工具获取开发板的IP地址。
　　3. 通过WIFI路由器的后台登录界面获取IP地址。
　　4. 通过开发板显示屏查看IP地址。（推荐）
  
  ###1. 通过短信指令获取IP地址
　　通过**短信指令**获取IP地址的方法是官方推荐的一种方式。编辑以下格式的**短信指令**：
  `*#wf#000000`
  
######短信指令格式说明
- `*#wf#`：短信指令的固定标识。
- `000000`：默认的用户密码。
　　
编辑上述短信发送到开发板中的任意一张手机卡上，开发板将自动向您的手机回复一条包括当前IP地址的短信。
```
设备(498060912345)已连至mywifi,IP:192.168.7.170,信号:70%
```

#####2. 通过UDP工具获取开发板的IP地址
　　您可以使用任意一款UDP Server工具，监听38585的UDP端口，即可以获取到开发板的IP地址。我们推荐您使用**网络调试助手**这个工具。此工具的下载地址是：http://www.cmsoft.cn/resource/102.html
![](快速入门/images/fee234f2_63c0fb83194fe.png)
　　使用前，左上角（1）协议类型选：UDP；（2）本地主机地址必须与开发板在同一个网段内；（3）本地主机端口填写：38585，然后点击“开启”按钮，就可以了。
　　将开发板断电重启，开发板自动连接到您指定的WIFI网络之后，**网络调试助手**中，会自动显示开发板的IP地址。（参见图右侧）

#####3. 通过WIFI路由器后台管理页面，获取开发板的IP地址
　　登录WIFI路由器的后台管理端，也可以查看到开发板的IP地址。具体方法与您的路由器品牌有关，这里就不展开了。
  
#####4. 通过开发板显示屏查看WIFI的IP地址
　　开发板上连接了显示屏时，也可以在显示屏中直接查看当前WIFI的IP地址：
  ![](快速入门/images/570f416e_6825b7e2a5a9a.png)
　　
#####注意事项

　　（1）获取开发板IP地址这个步骤，一般只用于产品开发阶段。产品开发完成向最终用户发行后，最终用户一般不需要关心开发板的IP地址。
　　（2）为了方便开发，您可以在WIFI路由器后台管理界面，将开发板的IP地址，分配为一个固定的地址（一般在路由器的DHCP选项中设置）。

---

<a name="配置开发板接口信息"></a>

### 配置开发板接口信息


　　获取到开发板的IP地址之后，您就可以在浏览器上输入以下地址，登录到开发板的后台管理界面了。比如，假设您的开发板IP地址是192.168.7.170，那么您可以在浏览器上输入以下地址：
  `http://192.168.7.170/mgr`
　　
> 注意：要确保您的电脑与您的设备处于同一个网段，否则无法登录设备后台。一般可以使用ping命令进行测试：
`ping 192.167.7.170`（ping命令的具体用法，请自行百度）。
如果您的电脑与开发板连入的是同一个WIFI热点，但通过IP仍然无法登录设备的后台页面，此类问题通常是：您的电脑连接的是WIFI路由器的5G网络，而设备连接的是2.4G网络，由于您的路由器设置的原因，5G网络与2.4G网络不能互通导致的。）

　　
　　输入以上地址，并按下回车键，浏览器会提示您输入**管理员用户名**与**管理密码**。开发板默认的**管理员用户名**是**admin**，默认的**管理密码**也是**admin**，如下图所示：
![](快速入门/images/ff02a9b3_63c0fbebb0f42.png)
　　
　　输入登录用户名、密码之后，点击“**登录**”按钮，将进入后台的**设备管理器页面**：
  
  ![](快速入门/images/0c501809_63ce320f027e8.png)
　　
　　
　　点击进入“**接口参数配置**”子页面。此页面内容稍多，作为入门操作，只需要关注前三个项目就可以了：
  ![](快速入门/images/f9760660_63ce32cf32821.png)
　　
  
- “**接口地址设置**”：这里填写您自己开发的HTTP接口地址 或 TCP服务器地址。
　　如果您对WEB开发比较熟悉，可以搭建一个HTTP Server接收数据，将接口的标准HTTP URL地址填写到**接口地址**框中就可以了。
　　如果您对C/S开发比较熟悉，也可以搭建一个TCP Server接收数据。将TCP Server的地址、端口号，按以下示例格式填写即可：`tcp://192.168.7.170:6888`

- “**接口请求方式**”：这里有GET/POST两种方式（只限HTTP方式填写）。一般在开发调试阶段，可以选用相对简单的GET方式。
- “**Content-Type**”：这里设置以什么方式打包数据（只限HTTP方式填写）。一般情况下选择**application/x-www-form-urlencode**就可以。当然，如果您喜欢的话，也可以选用**application/json**格式获取数据。

　　配置完基本的接口信息之后，点击页面最下方的“保存”按钮，完成最终的配置。

---

<a name="服务器端接收推送消息"></a>

### 服务器端接收推送消息


　　完成初步的用户接口信息配置之后，将开发板断电重启。
  
　　开发板重启后，首先会尝试连接您提供的WIFI热点信息。当开发板成功连入的WIFI热点之后，将向您的接口推送一条“**消息:100 - WIFI已联网**”的**推送消息**。
  
　　如果您选择的是以**HTTP接口的application/x-www-form-urlencode方式**接收数据的话，开发板将模拟HTTP页面的FORM表单提交，向您的接口推送第一条消息：
  ```
<form>
	<input name="devId" value="498060912345">
	<input name="type" value="100">
	<input name="ip" value="192.168.7.170">
	<input name="ssid" value="mywifi">
	<input name="dbm" value="61">
</form>
```
　　您可以在HTTP request对象中获取到上面的各项参数，参数的具体释义如下：
  
 | 参数名  | 参数值  |参数类型|说明|
| ------------ |:------------ |-----|--|
|devId |498060912345 |字符型|开发板唯一ID|
|type |100|数值型|消息ID|
|ip  | 192.168.7.170 |字符型|开发板当前IP地址|
|ssid |mywifi |字符型|开发板当前连入的WIFI名|
|dbm | 55  |数值型|开发板当前连的WIFI信号强度|

　　
　　如果您选择的是以**HTTP接口的application/json方式**接收数据的话，您将在HTTP request中获取到**JSON**格式的数据：

 ``` 
 {
  "devId": "498060912345",
  "type": 100,
  "ip": "192.168.7.170",
  "ssid": "mywifi",
  "dbm": 61
} 

 ```
 
　　如果您选择的是以**TCP接口**接收数据的话，将在您的TCP Server端中获取到**JSON**格式的数据：
```
{"devId":"498060912345","type":100,"ip":"192.168.7.170","ssid":"mywifi","dbm":61}\x11\x12
```

---


## 接入第三方平台

<a name="接入企业微信群"></a>

### 接入企业微信群


　　企业微信是腾讯微信团队为企业打造的专业办公管理工具。与微信一致的沟通体验，丰富免费的OA应用，并与微信消息、小程序、微信支付等互通，助力企业高效办公和管理。绿邮开发板通过简单的配置，即可接入企业微信群，无需二次开发。
　　
_
######企业微信群 的接入步骤：

　　（1）参照“快速入门”一节，先确保开发板正常连入WIFI，并可以登录到开发板后台页面。
　　
　　（2）在开发板后台页面中，点击进入“配置备份/恢复”页面，将以下的“配置信息”复制到“设备配置数据”的文本框中，然后点击“更新配置”按钮，**等待5秒后，重启开发板**。

**配置信息代码如下：**（复制以下黑框中的所有内容↓↓↓↓↓↓↓↓）
```json
{"wen":true,"wdb":99,"ecr":0,"lsben":true,"nsben":true,"srtmin":2,"ping":175,"ackMax":8000,"schr":4,"tz":8,"tca":15,"otat":3,"botm":[0,0],"amo":[1,1],"cim":[],"cims":[],"lss":[30,30],"sen":[false,false],"ord":[20,10],"str2":["SM","SM"],"sysArgs":null,"adName":"admin","uip":[{"url":"","method":1,"conType":1,"jcl":false,"reqFreq":true,"reqCnt":20,"reqOkLog":false,"reqErrLog":true,"allType":[100,101,102,204,205,209,501,603],"userArgs":{"0":{"un":"devName","uv":"{{devId}}","en":"0"},"2":{"un":"tail","uv":"★☆★☆短信小尾巴（不需要可以不填写）","us":"501","en":"0"}}}]}

~~--==~~--==
603
{
    "msgtype": "text",
    "text": {
        "content": "【来电提醒】{{LN}}设备有一个未接来电。{{LN}}→号码：{{phNum}}{{LN}}→时间：{{telStartTs|$ts2hhmmss(':')}} 至 {{telEndTs|$ts2hhmmss(':')}}{{LN}}{{LN}}↑↑来源：{{{devName}}}（卡{{slot}} {{msIsdn}}）{{LN}}→时间：{{YMDHMS}}"
    }
}
~~--==~~--==
501
{
    "msgtype": "text",
    "text": {
        "content": "{{smsBd}}{{LN}}→短信号码：{{phNum}}{{LN}}→短信时间：{{smsTs|$ts2yyyymmddhhmmss('-',':')}}{{LN}}↑↑来源：{{{devName}}}（卡{{slot}} {{msIsdn}}）{{LN}}→时间：{{YMDHMS}}{{LN}}{{{tail}}}"
    }
}
~~--==~~--==
209
{
    "msgtype": "text",
    "text": {
        "content": "“卡{{slot}}”存在故障，请将卡放入手机检查原因！{{LN}}{{LN}}SIM卡信息：{{LN}}→iccid：{{iccId}}{{LN}}→imsi：{{imsi}}{{LN}}→卡号：{{msIsdn}}{{LN}}{{LN}}↑↑来源：{{{devName}}}{{LN}}→时间：{{YMDHMS}}"
    }
}
~~--==~~--==
205
{
    "msgtype": "text",
    "text": {
        "content": "“卡{{slot}}”已从设备中取出！{{LN}}{{LN}}SIM卡信息：{{LN}}→iccid：{{iccId}}{{LN}}→imsi：{{imsi}}{{LN}}→卡号：{{msIsdn}}{{LN}}{{LN}}↑↑来源：{{{devName}}}{{LN}}→时间：{{YMDHMS}}"
    }
}
~~--==~~--==
204
{
    "msgtype": "text",
    "text": {
        "content": "“卡{{slot}}”已就绪！{{LN}}{{LN}}SIM卡信息：{{LN}}→iccid：{{iccId}}{{LN}}→imsi：{{imsi}}{{LN}}→卡号：{{msIsdn}}{{LN}}→信号强度：{{dbm}}%{{LN}}{{LN}}↑↑来源：{{{devName}}}{{LN}}→时间：{{YMDHMS}}"
    }
}
~~--==~~--==
102
{
    "msgtype": "text",
    "text": {
        "content": "【设备上线提醒】{{LN}}设备已通过 卡2 上线！{{LN}}{{LN}}SIM卡信息：{{LN}}→iccid：{{iccId}}{{LN}}→imsi：{{imsi}}{{LN}}→卡号：{{msIsdn}}{{LN}}→信号强度：{{dbm}}%{{LN}}{{LN}}↑↑来源：{{{devName}}}{{LN}}→时间：{{YMDHMS}}"
    }
}
~~--==~~--==
101
{
    "msgtype": "text",
    "text": {
        "content": "【设备上线提醒】{{LN}}设备已通过 卡1 上线！{{LN}}{{LN}}SIM卡信息：{{LN}}→iccid：{{iccId}}{{LN}}→imsi：{{imsi}}{{LN}}→卡号：{{msIsdn}}{{LN}}→信号强度：{{dbm}}%{{LN}}{{LN}}↑↑来源：{{{devName}}}{{LN}}→时间：{{YMDHMS}}"
    }
}
~~--==~~--==
100
{
    "msgtype": "text",
    "text": {
        "content": "【设备上线提醒】{{LN}}设备已通过 WiFi 上线！{{LN}}{{LN}}→本机IP：{{ip}}{{LN}}→WiFi热点：{{ssid}}{{LN}}→信号强度：{{dbm}}%{{LN}}{{LN}}↑↑来源：{{{devName}}}{{LN}}→时间：{{YMDHMS}}"
    }
}

```

**操作图示如下：**
![](接入第三方平台/images/ddd012ed_63be8adc3c6a0.jpg)

------------
> **注意：**
　　先将原有的“设备配置信息”全部清除，然后，再复制上面的配置信息，粘贴到“设备配置数据”的文本框中。
  
　　
　　（3）在企业微信中创建一个“群”，并添加“群机器人”。“群机器人”添加完成后，会有一个 webhook地址，请复制这个webhook地址，继续进行下一步。
  
**操作图示如下：**
![](接入第三方平台/images/5b0760f6_63c0d5c92dc13.png)
![](接入第三方平台/images/6eeb39e7_63c0d5edc891d.png)

------------

> **注意：**
　　截止2023年1月，企业微信群分为“内部群”与“外部群”，只有“内部群”支持添加“群机器人”。
　　将来，企业微信的功能可能会有调整，请以腾讯官方为准。

　　
　　（4）登录开发板后台页面，进入“接口信息配置”页面，将之前获取的 webhook地址 填写到“接口地址”文本框中，然后点击“保存页面配置”按钮。

**操作图示如下：**
![](接入第三方平台/images/3920238d_63c0db11b9ce3.png)

------------

> **注意：**
　　根据当前（23年1月）企业微信的规则，一个群机器人60秒内，最多只能发送20条消息。
　　您可以在群中多创建几个机器人（推荐2～3个），然后，将每一个的机器人webhook地址，都粘贴到“接口地址”文本框中，让每个机器人webhook地址单独占一行。这样，可以提升短信的转发速度。

　　
**填写多个webhook机器人地址时，操作图示如下：**
![](接入第三方平台/images/d7a69f1d_63c0dd13ad51f.png)
　　
　　（5）重启开发板，重启完成之后，开发板中的手机卡的短信以及未接来电提醒，会自动在您企业微信中显示。
  
**操作图示如下：**
![](接入第三方平台/images/48de15f1_63c0ddf4e071f.png)



　　
　　（6）为了便于您的使用，在我们示范的配置文件中，已经对部分事件进行了对接（见下图）。如果您不需要其中的某些事件，您可以手动将对应的事件勾选取消掉，然后点击保存就可以了。
  如果您需要对接新的事件，您需要参照开发文档独自完成对接。
![](接入第三方平台/images/86f1fe1b_683ad3b217c1f.png)

---

<a name="适配-绿微平台-普通web接口"></a>

### 适配“绿微平台”普通WEB接口


　　如果您之前针对“绿微转发服务平台”的“普通WEB接口转发”做过接口的开发，现在需要将设备的短信也对接到您的接口上。您可以按以下流程操作：
  
  ####绿微平台“普通ＷＥＢ接口转发” 的接入步骤：

　　（1）参照“快速入门”一节，先确保开发板正常连入WIFI，并可以登录到开发板后台页面。
　　
　　（2）在开发板后台页面中，点击进入“配置备份/恢复”页面，将以下的“配置信息”复制到“设备配置数据”的文本框中，然后点击“更新配置”按钮，**等待5秒后，重启开发板**。

**配置信息代码如下：**（复制以下黑框中的所有内容↓↓↓↓↓↓↓↓）
```json
{"wen":true,"wdb":99,"ecr":0,"lsben":true,"nsben":true,"srtmin":2,"ping":110,"ackMax":8000,"schr":4,"tz":8,"tca":15,"otat":3,"botm":[0,0],"amo":[1,1],"cim":[],"cims":[],"lss":[30,30],"sen":[false,false],"ord":[20,10],"str2":["SM","SM"],"sysArgs":null,"adName":"admin","uip":[{"url":"","method":1,"conType":0,"jcl":false,"reqFreq":false,"reqCnt":20,"reqOkLog":false,"reqErrLog":true,"allType":[501]}]}

~~--==~~--==
501
p={%22type%22:%22sms%22, %22bd%22:%22{{smsBd|$urlEncode()}}%22,%22ph%22:%22{{phNum|$urlEncode()}}%22,%22tm%22:%22{{smsTs}}%22,%22slt%22:%22{{slot}}%22,%22dId":%22{{devId}}%22}

```

　　（3）在“设备管理后台”---“接口信息配置”功能中，在“接口地址设置”中填入您接口地址，就可以了。图示如下：
  
  ![](接入第三方平台/images/6bfa7d7e_683912bacc959.png)
  
  
  **注意：**
  - 联网设置中的“联网卡槽”默认是全部禁止的状态，即默认不允许手机卡的流量联网。如果您的接口地址是公网IP，同时手机卡流量充足，可以根据需要选择开启手机卡的流量联网功能。
  - “HTTP接口设置”中，http请求方式默认是“POST”，您可以根据需要改为“GET”（一般不建议用GET）。
  - “Content-Type”一节，如果要兼容绿微平台的WEB接口，则必须要选则“application/x-www-form-urlencoded”。

---

<a name="接入bark-ios"></a>

### 接入Bark iOS


　　Bark iOS是一款苹果手机 （iOS）专用的APP，特点是免费、轻量，经过简单调用接口，即可给自己的iPhone发送推送信息，在苹果手机上有着绝佳的使用体验。（苹果手机用户，推荐使用！）
　　
_
######Bark iOS的接入步骤：

　　（1）参照“快速入门”一节，先确保开发板正常连入WIFI，并可以登录到开发板后台页面。
　　
　　（2）在开发板后台页面中，点击进入“配置备份/恢复”页面，将以下的“配置信息”复制到“设备配置数据”的文本框中，然后点击“更新配置”按钮，**等待5秒后，重启开发板**。

**配置信息代码如下：**（复制以下黑框中的所有内容↓↓↓↓↓↓↓↓）

```json
{"wen":true,"wdb":99,"ecr":0,"lsben":true,"nsben":true,"srtmin":2,"ping":110,"ackMax":8000,"schr":4,"tz":8,"tca":15,"otat":3,"botm":[0,0],"amo":[1,1],"cim":[],"cims":[],"lss":[30,30],"sen":[false,false],"ord":[20,10],"str2":["SM","SM"],"sysArgs":{"devSmsTs":{"en":"0"}},"adName":"admin","uip":[{"url":"http://api.day.app/push","method":1,"conType":1,"jcl":true,"reqFreq":false,"reqCnt":20,"reqOkLog":false,"reqErrLog":true,"allType":[100,101,102,204,205,209,501,603],"userArgs":{"0":{"un":"title","uv":"【绿芽推送】"},"1":{"un":"device_key","uv":"\"\""},"2":{"un":"device_key_more"},"3":{"un":"group","uv":"绿芽"},"4":{"un":"isArchive","uv":"1"},"5":{"un":"level","uv":"active"},"8":{"un":"devName","uv":"{{devId}}"},"9":{"un":"tail","uv":"★☆短信小尾巴（不需要可不填）"}}}]}

~~--==~~--==
204
{
"title":"{{{title}}}",
"subtitle":"【设备状态提醒】",
"body":"卡{{slot}}”已就绪！{{LN}}{{LN}}SIM卡信息：{{LN}}→iccid：{{iccId}}{{LN}}→imsi：{{imsi}}{{LN}}→卡号：{{msIsdn}}{{LN}}→信号强度：{{dbm}}%{{LN}}{{LN}}↑↑来源：{{{devName}}}{{LN}}→时间：{{YMDHMS}}",
"device_key":{{{device_key}}},
"device_keys":[ {{{device_key}}} {{{device_key_more|$nothingIfNotBlank(',')}}} {{{device_key_more}}}],
"level":"{{{level}}}",
"group":"{{{group}}}",
"isArchive":"{{{isArchive}}}"
}
~~--==~~--==
102
{
"title":"{{{title}}}",
"subtitle":"【设备上线提醒】",
"body":"设备已通过 卡2 上线！{{LN}}{{LN}}SIM卡信息：{{LN}}→iccid：{{iccId}}{{LN}}→imsi：{{imsi}}{{LN}}→卡号：{{msIsdn}}{{LN}}→信号强度：{{dbm}}%{{LN}}{{LN}}↑↑来源：{{{devName}}}{{LN}}→时间：{{YMDHMS}}",
"device_key":{{{device_key}}},
"device_keys":[ {{{device_key}}} {{{device_key_more|$nothingIfNotBlank(',')}}} {{{device_key_more}}}],
"level":"{{{level}}}",
"group":"{{{group}}}",
"isArchive":"{{{isArchive}}}"
}
~~--==~~--==
101
{
"title":"{{{title}}}",
"subtitle":"【设备上线提醒】",
"body":"设备已通过 卡1 上线！{{LN}}{{LN}}SIM卡信息：{{LN}}→iccid：{{iccId}}{{LN}}→imsi：{{imsi}}{{LN}}→卡号：{{msIsdn}}{{LN}}→信号强度：{{dbm}}%{{LN}}{{LN}}↑↑来源：{{{devName}}}{{LN}}→时间：{{YMDHMS}}",
"device_key":{{{device_key}}},
"device_keys":[ {{{device_key}}} {{{device_key_more|$nothingIfNotBlank(',')}}} {{{device_key_more}}}],
"level":"{{{level}}}",
"group":"{{{group}}}",
"isArchive":"{{{isArchive}}}"
}
~~--==~~--==
100
{
"title":"{{{title}}}",
"subtitle":"【设备上线提醒】",
"body":"设备已通过 WiFi 上线！{{LN}}{{LN}}→本机IP：{{ip}}{{LN}}→WiFi热点：{{ssid}}{{LN}}→信号强度：{{dbm}}%{{LN}}{{LN}}↑↑来源：{{{devName}}}{{LN}}→时间：{{YMDHMS}}",
"device_key":{{{device_key}}},
"device_keys":[ {{{device_key}}} {{{device_key_more|$nothingIfNotBlank(',')}}} {{{device_key_more}}}],
"level":"{{{level}}}",
"group":"{{{group}}}",
"isArchive":"{{{isArchive}}}"
}
~~--==~~--==
205
{
"title":"{{{title}}}",
"subtitle":"【设备状态提醒】",
"body":"卡{{slot}}”已从设备中取出！{{LN}}{{LN}}SIM卡信息：{{LN}}→iccid：{{iccId}}{{LN}}→imsi：{{imsi}}{{LN}}→卡号：{{msIsdn}}{{LN}}{{LN}}↑↑来源：{{{devName}}}{{LN}}→时间：{{YMDHMS}}",
"device_key":{{{device_key}}},
"device_keys":[ {{{device_key}}} {{{device_key_more|$nothingIfNotBlank(',')}}} {{{device_key_more}}}],
"level":"{{{level}}}",
"group":"{{{group}}}",
"isArchive":"{{{isArchive}}}"
}
~~--==~~--==
603
{
"title":"{{{title}}}",
"subtitle":"【来电提醒】",
"body":"设备有一个未接来电。{{LN}}→号码：{{phNum}}{{LN}}→时间：{{telStartTs|$ts2hhmmss(':')}} 至 {{telEndTs|$ts2hhmmss(':')}}{{LN}}{{LN}}↑↑来源：{{{devName}}}（卡{{slot}} {{msIsdn}}）{{LN}}→时间：{{YMDHMS}}",
"device_key":{{{device_key}}},
"device_keys":[ {{{device_key}}} {{{device_key_more|$nothingIfNotBlank(',')}}} {{{device_key_more}}}],
"level":"{{{level}}}",
"group":"{{{group}}}",
"isArchive":"{{{isArchive}}}"
}
~~--==~~--==
209
{
"title":"{{{title}}}",
"subtitle":"【设备状态提醒】",
"body":"卡{{slot}}”存在故障，请将卡放入手机检查原因！{{LN}}{{LN}}SIM卡信息：{{LN}}→iccid：{{iccId}}{{LN}}→imsi：{{imsi}}{{LN}}→卡号：{{msIsdn}}{{LN}}{{LN}}↑↑来源：{{{devName}}}{{LN}}→时间：{{YMDHMS}}",
"device_key":{{{device_key}}},
"device_keys":[ {{{device_key}}} {{{device_key_more|$nothingIfNotBlank(',')}}} {{{device_key_more}}}],
"level":"{{{level}}}",
"group":"{{{group}}}",
"isArchive":"{{{isArchive}}}"
}
~~--==~~--==
501
{
"title":"{{{title}}}",
"subtitle":"新短信提醒",
"body":"{{smsBd}}{{LN}}→短信号码：{{phNum}}{{LN}}→短信时间：{{smsTs|$ts2yyyymmddhhmmss('-',':')}}{{LN}}↑↑来源：{{{devName}}}（卡{{slot}} {{msIsdn}}）{{LN}}→时间：{{YMDHMS}}{{LN}}{{{tail}}}",
"device_key":{{{device_key}}},
"device_keys":[ {{{device_key}}} {{{device_key_more|$nothingIfNotBlank(',')}}} {{{device_key_more}}}],
"level":"{{{level}}}",
"group":"{{{group}}}",
"isArchive":"{{{isArchive}}}"
}
```

**操作图示如下：**
![](接入第三方平台/images/ddd012ed_63be8adc3c6a0.jpg)

------------

> **注意：**
　　先将原有的“设备配置信息”全部清除，然后，再复制上面的配置信息，粘贴到“设备配置数据”的文本框中。

　　
　　（3）打开您苹果手机上的app store，搜索并安装好Bark iOS。
  **操作图示如下：**

![](接入第三方平台/images/954ae784_63bf85e81e942.png)
　　
　　（4）Bark iOS安装成功后，点击运行。在Bark iOS的主界面中，点击下图所示的“复制”图标，获取到bark iOS提供的http地址。
  　　
**注意！Bark iOS首次运行时可能会弹出以下界面，请按图示操作即可：**.

![](接入第三方平台/images/34e1a6d6_63bf8c206e227.png)
　　
**复制http地址的操作图示如下：**

![](接入第三方平台/images/338beafd_63bf863518a18.png)
　
 
　　（5）登录开发板后台页面，进入“用户参数管理”页面，将之前复制的 http地址 仅保留KEY的部分，填写到参数“device_key”后面的“值”的文本框中，然后点击“保存页面配置”按钮。
  
> **注意：**
>　　Bark iOS点击“复制”按钮后，复制的数据可能为以下格式：
>　　　　https://api.day.app/qY3jxAJfxnABCDALSiekZ/这里改成你自己的推送内容
>　　只保留 qY3jxAJfxnABCDALSiekZ 这一段（两个/符号中间的字符），其它不要复制。

**操作图示如下：**
![](接入第三方平台/images/887a57bc_683ad08f86739.png)
> **再次注意：**
　　填写 qY3jxAJfxnABCDALSiekZ 时，两侧需要增加“半角的双引号”。
  
  
  当您需要将短信同时转发给多个Bark iOS客户端时，除了第一个 Bark iOS 的KEY之外， 其它Bark客户端的KEY，需要填写到“device_key_more”的值中，示例如下：
  ![](接入第三方平台/images/a3e5e4d2_683ad1945d32a.png)
　　
  > **注意：**
  这个例子时，同时将短信转发给3个Bark客户端，除了第1个客户端的KEY必需写在“device_key”中之外，其它2个客户端的KEY，需要填写到“device_key_more”中。
  同样的，每一个KEY都需要写“双引号”（半角），多个KEY之间用“半角逗号”分隔。


　　
　　（6）重启开发板，重启完成之后，开发板中的手机卡的短信以及未接来电提醒，会自动在您Bark中显示。
  
**操作图示如下：**
![](接入第三方平台/images/9c62f157_63bf919a67eb7.png)


　　
　　（7）为了便于您的使用，在我们示范的配置文件中，已经对部分事件进行了对接（见下图）。如果您不需要其中的某些事件，您可以手动将对应的事件勾选取消掉，然后点击保存就可以了。
  如果您需要对接新的事件，您需要参照开发文档独自完成对接。
![](接入第三方平台/images/86f1fe1b_683ad3b217c1f.png)

---

<a name="接入钉钉群"></a>

### 接入钉钉群


　　钉钉是阿里集团专为中小企业打造的通讯、协同的移动办公平台，帮助企业内部沟通和商务沟通更加高效安全。绿邮开发板通过简单的配置，即可接入钉钉群，无需二次开发。
　　
_
######钉钉群 的接入步骤：

　　（1）参照“快速入门”一节，先确保开发板正常连入WIFI，并可以登录到开发板后台页面。
　　
　　（2）在开发板后台页面中，点击进入“配置备份/恢复”页面，将以下的“配置信息”复制到“设备配置数据”的文本框中，然后点击“更新配置”按钮，**等待5秒后，重启开发板**。

**配置信息代码如下：**（复制以下黑框中的所有内容↓↓↓↓↓↓↓↓）
```json
{"wen":true,"wdb":99,"ecr":0,"lsben":true,"nsben":true,"srtmin":2,"ping":175,"ackMax":8000,"schr":4,"tz":8,"tca":15,"otat":3,"botm":[0,0],"amo":[1,1],"cim":[],"cims":[],"lss":[30,30],"sen":[false,false],"ord":[20,10],"str2":["SM","SM"],"sysArgs":null,"adName":"admin","uip":[{"url":"","method":1,"conType":1,"jcl":false,"reqFreq":true,"reqCnt":20,"reqOkLog":false,"reqErrLog":true,"allType":[100,101,102,204,205,209,501,603],"userArgs":{"0":{"un":"devName","uv":"{{devId}}","en":"0"},"1":{"un":"key","uv":"☆【绿芽转发】","en":"0"},"2":{"un":"tail","uv":"★☆★☆短信小尾巴（不需要可以不填写）","en":"0"}}}]}

~~--==~~--==
101
{
    "msgtype": "text",
    "text": {
        "content": "【设备上线提醒】{{LN}}设备已通过 卡1 上线！{{LN}}{{LN}}SIM卡信息：{{LN}}→iccid：{{iccId}}{{LN}}→imsi：{{imsi}}{{LN}}→卡号：{{msIsdn}}{{LN}}→信号强度：{{dbm}}%{{LN}}{{LN}}↑↑来源：{{{devName}}}{{LN}}→时间：{{YMDHMS}}{{LN}}{{{key}}}"
    }
}
~~--==~~--==
100
{
    "msgtype": "text",
    "text": {
        "content": "【设备上线提醒】{{LN}}设备已通过 WiFi 上线！{{LN}}{{LN}}→本机IP：{{ip}}{{LN}}→WiFi热点：{{ssid}}{{LN}}→信号强度：{{dbm}}%{{LN}}{{LN}}↑↑来源：{{{devName}}}{{LN}}→时间：{{YMDHMS}}{{LN}}{{{key}}}"
    }
}
~~--==~~--==
603
{
    "msgtype": "text",
    "text": {
        "content": "【来电提醒】{{LN}}设备有一个未接来电。{{LN}}→号码：{{phNum}}{{LN}}→时间：{{telStartTs|$ts2hhmmss(':')}} 至 {{telEndTs|$ts2hhmmss(':')}}{{LN}}{{LN}}↑↑来源：{{{devName}}}（卡{{slot}} {{msIsdn}}）{{LN}}→时间：{{YMDHMS}}{{LN}}{{{key}}}"
    }
}
~~--==~~--==
501
{
    "msgtype": "text",
    "text": {
        "content": "{{smsBd}}{{LN}}→短信号码：{{phNum}}{{LN}}→短信时间：{{smsTs|$ts2yyyymmddhhmmss('-',':')}}{{LN}}↑↑来源：{{{devName}}}（卡{{slot}} {{msIsdn}}）{{LN}}→时间：{{YMDHMS}}{{LN}}{{{tail}}}{{LN}}{{{key}}}"
    }
}
~~--==~~--==
209
{
    "msgtype": "text",
    "text": {
        "content": "“卡{{slot}}”存在故障，请将卡放入手机检查原因！{{LN}}{{LN}}SIM卡信息：{{LN}}→iccid：{{iccId}}{{LN}}→imsi：{{imsi}}{{LN}}→卡号：{{msIsdn}}{{LN}}{{LN}}↑↑来源：{{{devName}}}{{LN}}→时间：{{YMDHMS}}{{LN}}{{{key}}}"
    }
}
~~--==~~--==
205
{
    "msgtype": "text",
    "text": {
        "content": "“卡{{slot}}”已从设备中取出！{{LN}}{{LN}}SIM卡信息：{{LN}}→iccid：{{iccId}}{{LN}}→imsi：{{imsi}}{{LN}}→卡号：{{msIsdn}}{{LN}}{{LN}}↑↑来源：{{{devName}}}{{LN}}→时间：{{YMDHMS}}{{LN}}{{{key}}}"
    }
}
~~--==~~--==
204
{
    "msgtype": "text",
    "text": {
        "content": "“卡{{slot}}”已就绪！{{LN}}{{LN}}SIM卡信息：{{LN}}→iccid：{{iccId}}{{LN}}→imsi：{{imsi}}{{LN}}→卡号：{{msIsdn}}{{LN}}→信号强度：{{dbm}}%{{LN}}{{LN}}↑↑来源：{{{devName}}}{{LN}}→时间：{{YMDHMS}}{{LN}}{{{key}}}"
    }
}
~~--==~~--==
102
{
    "msgtype": "text",
    "text": {
        "content": "【设备上线提醒】{{LN}}设备已通过 卡2 上线！{{LN}}{{LN}}SIM卡信息：{{LN}}→iccid：{{iccId}}{{LN}}→imsi：{{imsi}}{{LN}}→卡号：{{msIsdn}}{{LN}}→信号强度：{{dbm}}%{{LN}}{{LN}}↑↑来源：{{{devName}}}{{LN}}→时间：{{YMDHMS}}{{LN}}{{{key}}}"
    }
}

```

**操作图示如下：**
![](接入第三方平台/images/ddd012ed_63be8adc3c6a0.jpg)

------------
> **注意：**
　　先将原有的“设备配置信息”全部清除，然后，再复制上面的配置信息，粘贴到“设备配置数据”的文本框中。

　　
　　（3）在钉钉中创建一个“群”，并添加“自定义机器人”。“自定义机器人”添加完成后，会有一个 webhook地址，请复制这个webhook地址，继续进行下一步。
  
**操作图示如下：**
![](接入第三方平台/images/0e55cd44_63c1f392e0625.png)
![](接入第三方平台/images/91e4e98b_63c1f3af233a9.png)
![](接入第三方平台/images/912d9380_63c1f3cbba5d2.png)
![](接入第三方平台/images/a998e998_63c1f3eb7a807.png)
![](接入第三方平台/images/5e3ca2db_63c1f3fd5fd79.png)
![](接入第三方平台/images/f160a7eb_63c1f416ba58c.png)
![](接入第三方平台/images/dd9bf65f_63c1f42ac4f19.png)
![](接入第三方平台/images/3c77dac8_63c1f43c04fda.png)

------------
> **注意：**
　　（a）　第（７）步中的“安全设置”一项，必须选中“自定义关键词”。
 　　　　 “自定义关键词”的内容示例中约定为“【新技术】”，您可以修改为任何您喜欢的其它词语。
　　（b）　“安全设置”中的“加签”和“IP地址段”，不能被勾选。
　　（c）　根据当前（23年1月）钉钉的规则，在钉钉群中添加机器人，必须在钉钉PC端版本中操作，手机APP端无法操作。

　　
　　（4）登录开发板后台页面，进入“接口信息配置”页面，将之前获取的 webhook地址 填写到“接口地址”文本框中，然后点击“保存页面配置”按钮。

**操作图示如下：**
![](接入第三方平台/images/3920238d_63c0db11b9ce3.png)

------------
> **注意：**
　　根据当前（23年1月）钉钉的规则，一个群机器人60秒内，最多只能发送20条消息。
　　您可以在群中多创建几个机器人（推荐2～3个），然后，将每一个的机器人webhook地址，都粘贴到“接口地址”文本框中，每个机器人webhook地址单独占一行。这样，可以提升短信的转发速度。

　　
**填写多个webhook机器人地址时，操作图示如下：**
![](接入第三方平台/images/d7a69f1d_63c0dd13ad51f.png)
　　
　　（5）登录开发板后台页面，进入“用户参数管理”页面，将之前在钉钉中设置的“自定义关键词”的文字内容，填写到开发板后面中的对应位置，然后点击“保存页面配置”按钮。
  
**操作图示如下：**
![](接入第三方平台/images/6f4ac9a2_6842a6b9d0979.png)


------------

> **说明：**
　　钉钉中设置的“自定义关键词”最多可以设置10个关键词，消息中至少包含其中1个关键词才可以发送成功。
　　例如添加了一个自定义关键词：监控报警，则这个机器人所发送的消息，必须包含监控报警这个词，才能发送成功。

>　　如果您希望所有的短信都能够转发到钉钉，可以把钉钉中的“自定义关键词”文字内容 与 开发板“用户参数管理”页面中的文字内容两边设置为完全一致的内容，这样开发板中的所有短信都会允许向钉钉群转发。

>　　反之，如果只希望只转发包含“特定关键词”的短信，比如只转发包含“验证码” 或者 “【监控报警】”这两个词语的短信，那么，可以先把开发板“用户参数管理”页面中“key”的 “值”内容清空（示例中对应的是去掉“☆【绿芽转发】”这个内容）并保存。然后把“验证码” 或者 “【监控报警】”这两个词语，添加到钉钉设置中的“自定义关键词”，就可以了。

>　　**操作图示如下：**

![](接入第三方平台/images/e0daeaf8_63c205310bd2b.png)
　　
　　（6）重启开发板，重启完成之后，开发板中的手机卡的短信以及未接来电提醒，会自动在您钉钉中显示。
  
**操作图示如下：**
![](接入第三方平台/images/662c4317_63c1fe7b2b899.png)



　　
　　（7）为了便于您的使用，在我们示范的配置文件中，已经对部分事件进行了对接（见下图）。如果您不需要其中的某些事件，您可以手动将对应的事件勾选取消掉，然后点击保存就可以了。
  如果您需要对接新的事件，您需要参照开发文档独自完成对接。
![](接入第三方平台/images/86f1fe1b_683ad3b217c1f.png)

---

<a name="接入飞书群"></a>

### 接入飞书群


　　飞书是字节跳动旗下先进企业协作与管理平台，一站式整合及时沟通、智能日历、音视频会议、飞书文档、云盘等办公协作套件。绿邮开发板通过简单的配置，即可接入飞书群，无需二次开发。
　　
_
######飞书群 的接入步骤：

　　（1）参照“快速入门”一节，先确保开发板正常连入WIFI，并可以登录到开发板后台页面。
　　
　　（2）在开发板后台页面中，点击进入“配置备份/恢复”页面，将以下的“配置信息”复制到“设备配置数据”的文本框中，然后点击“更新配置”按钮，**等待5秒后，重启开发板**。

**配置信息代码如下：**（复制以下黑框中的所有内容↓↓↓↓↓↓↓↓）
```json
{"wen":true,"wdb":99,"ecr":0,"lsben":true,"nsben":true,"srtmin":2,"ping":175,"ackMax":8000,"schr":4,"tz":8,"tca":15,"otat":3,"botm":[0,0],"amo":[1,1],"cim":[],"cims":[],"lss":[30,30],"sen":[false,false],"ord":[20,10],"str2":["SM","SM"],"sysArgs":null,"adName":"admin","uip":[{"url":"","method":1,"conType":1,"jcl":true,"reqFreq":true,"reqCnt":20,"reqOkLog":false,"reqErrLog":true,"allType":[100,101,102,204,205,209,501,603],"userArgs":{"0":{"un":"devName","uv":"{{devId}}","en":"0"},"1":{"un":"key","uv":"☆【绿芽转发】","en":"0"},"2":{"un":"tail","uv":"★☆★☆短信小尾巴（不需要可以不填写）","en":"0"}}}]}

~~--==~~--==
100
{
    "msg_type": "text",
    "content": {
        "text": "【设备上线提醒】{{LN}}设备已通过 WiFi 上线！{{LN}}{{LN}}→本机IP：{{ip}}{{LN}}→WiFi热点：{{ssid}}{{LN}}→信号强度：{{dbm}}%{{LN}}{{LN}}↑↑来源：{{{devName}}}{{LN}}→时间：{{YMDHMS}}{{LN}}{{{key}}}"
    }
}
~~--==~~--==
101
{
    "msg_type": "text",
    "content": {
        "text": "【设备上线提醒】{{LN}}设备已通过 卡1 上线！{{LN}}{{LN}}SIM卡信息：{{LN}}→iccid：{{iccId}}{{LN}}→imsi：{{imsi}}{{LN}}→卡号：{{msIsdn}}{{LN}}→信号强度：{{dbm}}%{{LN}}{{LN}}↑↑来源：{{{devName}}}{{LN}}→时间：{{YMDHMS}}{{LN}}{{{key}}}"
    }
}
~~--==~~--==
603
{
    "msg_type": "text",
    "content": {
        "text": "【来电提醒】{{LN}}设备有一个未接来电。{{LN}}→号码：{{phNum}}{{LN}}→时间：{{telStartTs|$ts2hhmmss(':')}} 至 {{telEndTs|$ts2hhmmss(':')}}{{LN}}{{LN}}↑↑来源：{{{devName}}}（卡{{slot}} {{msIsdn}}）{{LN}}→时间：{{YMDHMS}}{{LN}}{{{key}}}"
    }
}
~~--==~~--==
501
{
    "msg_type": "text",
    "content": {
        "text": "{{smsBd}}{{LN}}→短信号码：{{phNum}}{{LN}}→短信时间：{{smsTs|$ts2yyyymmddhhmmss('-',':')}}{{LN}}↑↑来源：{{{devName}}}（卡{{slot}} {{msIsdn}}）{{LN}}→时间：{{YMDHMS}}{{LN}}{{{tail}}}{{LN}}{{{key}}}"
    }
}
~~--==~~--==
209
{
    "msg_type": "text",
    "content": {
        "text": "“卡{{slot}}”存在故障，请将卡放入手机检查原因！{{LN}}{{LN}}SIM卡信息：{{LN}}→iccid：{{iccId}}{{LN}}→imsi：{{imsi}}{{LN}}→卡号：{{msIsdn}}{{LN}}{{LN}}↑↑来源：{{{devName}}}{{LN}}→时间：{{YMDHMS}}{{LN}}{{{key}}}"
    }
}
~~--==~~--==
205
{
    "msg_type": "text",
    "content": {
        "text": "“卡{{slot}}”已从设备中取出！{{LN}}{{LN}}SIM卡信息：{{LN}}→iccid：{{iccId}}{{LN}}→imsi：{{imsi}}{{LN}}→卡号：{{msIsdn}}{{LN}}{{LN}}↑↑来源：{{{devName}}}{{LN}}→时间：{{YMDHMS}}{{LN}}{{{key}}}"
    }
}
~~--==~~--==
204
{
    "msg_type": "text",
    "content": {
        "text": "“卡{{slot}}”已就绪！{{LN}}{{LN}}SIM卡信息：{{LN}}→iccid：{{iccId}}{{LN}}→imsi：{{imsi}}{{LN}}→卡号：{{msIsdn}}{{LN}}→信号强度：{{dbm}}%{{LN}}{{LN}}↑↑来源：{{{devName}}}{{LN}}→时间：{{YMDHMS}}{{LN}}{{{key}}}"
    }
}
~~--==~~--==
102
{
    "msg_type": "text",
    "content": {
        "text": "【设备上线提醒】{{LN}}设备已通过 卡2 上线！{{LN}}{{LN}}SIM卡信息：{{LN}}→iccid：{{iccId}}{{LN}}→imsi：{{imsi}}{{LN}}→卡号：{{msIsdn}}{{LN}}→信号强度：{{dbm}}%{{LN}}{{LN}}↑↑来源：{{{devName}}}{{LN}}→时间：{{YMDHMS}}{{LN}}{{{key}}}"
    }
}

```

**操作图示如下：**
![](接入第三方平台/images/ddd012ed_63be8adc3c6a0.jpg)

------------
> **注意：**
　　先将原有的“设备配置信息”全部清除，然后，再复制上面的配置信息，粘贴到“设备配置数据”的文本框中。

　　
　　（3）在飞书中创建一个“群”，并添加“自定义机器人”。“自定义机器人”添加完成后，会有一个 webhook地址，请复制这个webhook地址，继续进行下一步。
  
**操作图示如下：**
![](接入第三方平台/images/c35ac4c1_63c22e8bd6261.png)
![](接入第三方平台/images/e1e645a5_63c22ea182eb6.png)
![](接入第三方平台/images/bc5d5aba_63c22eac72aca.png)
![](接入第三方平台/images/b6da39e4_63c22ebb35318.png)
![](接入第三方平台/images/d680322a_63c22ec676704.png)
![](接入第三方平台/images/50b4a6eb_63c22ed36ee1f.png)

------------
> **注意：**
　　（a）　第（７）步中的“安全设置”一项，必须选中“自定义关键词”。
  　　　　　“自定义关键词”的内容示例中约定为“【新技术】”，您可以修改为任何您喜欢的其它词语。
　　（b）“安全设置”中的“加签”和“IP地址段”，不能被勾选。
　　（c）　根据当前（23年1月）飞书的规则，在飞书群中添加自定义机器人，必须在飞书PC端版本中操作，手机APP端无法操作。

　　
　　（4）登录开发板后台页面，进入“接口信息配置”页面，将之前获取的 webhook地址 填写到“接口地址”文本框中，然后点击“保存页面配置”按钮。

**操作图示如下：**
![](接入第三方平台/images/3920238d_63c0db11b9ce3.png)

------------
> **注意：**
　　根据当前（23年1月）飞书的规则，一个群机器人60秒内，最多只能发送100条消息。
　　如有必要，您可以在群中多创建几个机器人（推荐2个），然后，将每一个的机器人webhook地址，都粘贴到“接口地址”文本框中，每个机器人webhook地址单独占一行。这样，可以提升短信的转发速度。

　　
**填写多个webhook机器人地址时，操作图示如下：**
![](接入第三方平台/images/d7a69f1d_63c0dd13ad51f.png)
　　
　　（5）登录开发板后台页面，进入“用户参数管理”页面，将之前在飞书中设置的“自定义关键词”的文字内容，填写到开发板后面中的对应位置，然后点击“保存页面配置”按钮。
  
**操作图示如下：**
![](接入第三方平台/images/6f4ac9a2_6842a6b9d0979.png)

------------
> **说明：**
　　飞书中设置的“自定义关键词”最多可以设置10个关键词，消息中至少包含其中1个关键词才可以发送成功。
　　例如添加了一个自定义关键词：监控报警，则这个机器人所发送的消息，必须包含监控报警这个词，才能发送成功。

>　　如果您希望所有的短信都能够转发到飞书，可以把飞书中的“自定义关键词”文字内容 与 开发板“用户参数管理”页面中的文字内容两边设置为完全一致的内容，这样开发板中的所有短信都会允许向飞书群转发。

>　　反之，如果只希望只转发包含“特定关键词”的短信，比如只转发包含“验证码” 或者 “【监控报警】”这两个词语的短信，那么，可以先把开发板“用户参数管理”页面中“key”的 “值”内容清空（示例中对应的是去掉“【新技术】”这个内容）并保存。然后把“验证码” 或者 “【监控报警】”这两个词语，添加到飞书设置中的“自定义关键词”，就可以了。

>　　**操作图示如下：**

![](接入第三方平台/images/9bdc4c29_63c22f8b0142d.png)
　　
　　（6）重启开发板，重启完成之后，开发板中的手机卡的短信以及未接来电提醒，会自动在您飞书群中显示。
  
**操作图示如下：**
![](接入第三方平台/images/14789dee_63c230308c8f1.png)

　　
　　（7）为了便于您的使用，在我们示范的配置文件中，已经对部分事件进行了对接（见下图）。如果您不需要其中的某些事件，您可以手动将对应的事件勾选取消掉，然后点击保存就可以了。
  如果您需要对接新的事件，您需要参照开发文档独自完成对接。
![](接入第三方平台/images/86f1fe1b_683ad3b217c1f.png)

---

<a name="接入server酱turbo"></a>

### 接入Server酱Turbo


　　「Server酱Turbo」，英文名「ServerChan」，是一款「手机」和「服务器」、「智能设备」之间的通信软件。绿邮开发板通过简单的配置，即可接入Server酱Turbo，无需二次开发。
　　Server酱Turbo官网：https://sct.ftqq.com/
　　
_
######Server酱的接入步骤：

　　（1）参照“快速入门”一节，先确保开发板正常连入WIFI，并可以登录到开发板后台页面。
　　
　　（2）在开发板后台页面中，点击进入“配置备份/恢复”页面，将以下的“配置信息”复制到“设备配置数据”的文本框中，然后点击“更新配置”按钮，**等待5秒后，重启开发板**。

**配置信息代码如下：**（复制以下黑框中的所有内容↓↓↓↓↓↓↓↓）

```json
{"wen":true,"wdb":99,"ecr":0,"lsben":true,"nsben":true,"srtmin":2,"ping":175,"ackMax":8000,"schr":4,"tz":8,"tca":15,"otat":3,"botm":[0,0],"amo":[1,1],"cim":[],"cims":[],"lss":[30,30],"sen":[false,false],"ord":[20,10],"str2":["SM","SM"],"sysArgs":null,"adName":"admin","uip":[{"url":"https://sctapi.ftqq.com/{{{sendkey}}}.send","method":1,"conType":0,"jcl":false,"reqFreq":false,"reqCnt":20,"reqOkLog":false,"reqErrLog":true,"allType":[100,101,102,204,205,209,501,603],"userArgs":{"0":{"un":"devName","uv":"{{devId}}","en":"0"},"1":{"un":"sendkey","uv":"","en":"0"},"2":{"un":"tail","uv":"★☆★☆短信小尾巴（不需要可以不填写）","us":"501","en":"0"}}}]}

~~--==~~--==
100
title=【设备上线提醒】{{{devName}}}&desp=设备已通过 WiFi 上线！{{LN}}{{LR}}→本机IP：{{ip}}{{LN}}{{LR}}→WiFi热点：{{ssid}}{{LN}}{{LR}}→信号强度：{{dbm}}%{{LN}}{{LR}}↑↑来源：{{{devName}}}{{LN}}{{LR}}→时间：{{YMDHMS}}
~~--==~~--==
603
title=【来电提醒】{{phNum}}&desp=→号码：{{phNum}}{{LN}}{{LR}}→时间：{{telStartTs|$ts2hhmmss(':')}} 至 {{telEndTs|$ts2hhmmss(':')}}{{LN}}{{LR}}↑↑来源：{{{devName}}}（卡{{slot}} {{msIsdn}}）{{LN}}{{LR}}→时间：{{YMDHMS}}
~~--==~~--==
501
title=【新短信提醒】{{phNum}}&desp={{smsBd}}{{LN}}{{LR}}→短信号码：{{phNum}}{{LN}}{{LR}}→短信时间：{{smsTs|$ts2yyyymmddhhmmss('-',':')}}{{LN}}{{LR}}↑↑来源：{{{devName}}}（卡{{slot}} {{msIsdn}}）{{LN}}{{LR}}→时间：{{YMDHMS}}{{LN}}{{LR}}{{{tail}}}
~~--==~~--==
209
title=【设备提醒】{{phNum}}&desp=“卡{{slot}}”存在故障，请将卡放入手机检查原因！{{LN}}{{LR}}SIM卡信息：{{LN}}{{LR}}→iccid：{{iccId}}{{LN}}{{LR}}→imsi：{{imsi}}{{LN}}{{LR}}→卡号：{{msIsdn}}{{LN}}{{LR}}↑↑来源：{{{devName}}}{{LN}}{{LR}}→时间：{{YMDHMS}}
~~--==~~--==
205
title=【设备提醒】{{phNum}}&desp=“卡{{slot}}”已从设备中取出！{{LN}}{{LR}}SIM卡信息：{{LN}}{{LR}}→iccid：{{iccId}}{{LN}}{{LR}}→imsi：{{imsi}}{{LN}}{{LR}}→卡号：{{msIsdn}}{{LN}}{{LR}}↑↑来源：{{{devName}}}{{LN}}{{LR}}→时间：{{YMDHMS}}
~~--==~~--==
204
title=【设备提醒】{{phNum}}&desp=“卡{{slot}}”已就绪！{{LN}}{{LR}}SIM卡信息：{{LN}}{{LR}}→iccid：{{iccId}}{{LN}}{{LR}}→imsi：{{imsi}}{{LN}}{{LR}}→卡号：{{msIsdn}}{{LN}}{{LR}}→信号强度：{{dbm}}%{{LN}}{{LR}}↑↑来源：{{{devName}}}{{LN}}{{LR}}→时间：{{YMDHMS}}
~~--==~~--==
title=【设备上线提醒】{{{devName}}}&desp=设备已通过 卡2 上线！{{LN}}{{LR}}SIM卡信息：{{LN}}{{LR}}→iccid：{{iccId}}{{LN}}{{LR}}→imsi：{{imsi}}{{LN}}{{LR}}→卡号：{{msIsdn}}{{LN}}{{LR}}→信号强度：{{dbm}}%{{LN}}{{LR}}↑↑来源：{{{devName}}}{{LN}}{{LR}}→时间：{{YMDHMS}}
~~--==~~--==
101
title=【设备上线提醒】{{{devName}}}&desp=设备已通过 卡1 上线！{{LN}}{{LR}}SIM卡信息：{{LN}}{{LR}}→iccid：{{iccId}}{{LN}}{{LR}}→imsi：{{imsi}}{{LN}}{{LR}}→卡号：{{msIsdn}}{{LN}}{{LR}}→信号强度：{{dbm}}%{{LN}}{{LR}}↑↑来源：{{{devName}}}{{LN}}{{LR}}→时间：{{YMDHMS}}

```

**操作图示如下：**
![](接入第三方平台/images/ddd012ed_63be8adc3c6a0.jpg)

------------

> **注意：**
　　先将原有的“设备配置信息”全部清除，然后，再复制上面的配置信息，粘贴到“设备配置数据”的文本框中。

　　
　　（3）登录 Server酱 网站（新用户可能需要先完成注册），Server酱 登录地址为：https://sct.ftqq.com/login
　　
　　（4）Server酱 网站成功后，点击“KEY&API”功能获取`sendKey`。

**操作图示如下：**

![](接入第三方平台/images/247911d2_63beae94ddbdf.png)
　
 
　　（5）登录开发板后台页面，进入“用户参数管理”页面，将之前获取的 sendkey 填写到指定位置，然后点击“保存页面配置”按钮。

**操作图示如下：**
![](接入第三方平台/images/2ce8b246_63beaf2d32e92.png)


　　
　　（6）重启开发板，重启完成之后，开发板中的手机卡的短信以及未接来电提醒，会自动在您微信的 Server酱 的公众号中显示。
  
**操作图示如下：**
![](接入第三方平台/images/c65b5933_63beaf805541f.png)

---

<a name="接入server酱3"></a>

### 接入Server酱3


　　「Server酱3」专注于APP推送，大部分手机无需驻留后台亦可收信。绿邮开发板通过简单的配置，Server酱3，无需二次开发。
　　Server酱3官网：https://sc3.ft07.com/client
_
######Server酱3的接入步骤：

　　（1）参照“快速入门”一节，先确保开发板正常连入WIFI，并可以登录到开发板后台页面。
　　
　　（2）在开发板后台页面中，点击进入“配置备份/恢复”页面，将以下的“配置信息”复制到“设备配置数据”的文本框中，然后点击“更新配置”按钮，**等待5秒后，重启开发板**。

**配置信息代码如下：**（复制以下黑框中的所有内容↓↓↓↓↓↓↓↓）

```json
{"wen":true,"wdb":99,"ecr":0,"lsben":true,"nsben":true,"srtmin":2,"ping":175,"ackMax":8000,"schr":4,"tz":8,"tca":15,"otat":3,"botm":[0,0],"amo":[1,1],"cim":[],"cims":[],"lss":[30,30],"sen":[false,false],"ord":[20,10],"str2":["SM","SM"],"sysArgs":null,"adName":"admin","uip":[{"url":"","method":1,"conType":0,"jcl":false,"reqFreq":false,"reqCnt":20,"reqOkLog":false,"reqErrLog":true,"allType":[100,101,102,204,205,209,501,603],"userArgs":{"0":{"un":"devName","uv":"{{devId}}","en":"0"},"2":{"un":"tail","uv":"★☆★☆短信小尾巴（不需要可以不填写）","us":"501","en":"0"}}}]}

~~--==~~--==
100
title=【设备上线提醒】{{{devName}}}&desp=设备已通过 WiFi 上线！{{LN}}{{LR}}→本机IP：{{ip}}{{LN}}{{LR}}→WiFi热点：{{ssid}}{{LN}}{{LR}}→信号强度：{{dbm}}%{{LN}}{{LR}}↑↑来源：{{{devName}}}{{LN}}{{LR}}→时间：{{YMDHMS}}
~~--==~~--==
603
title=【来电提醒】{{phNum}}&desp=→号码：{{phNum}}{{LN}}{{LR}}→时间：{{telStartTs|$ts2hhmmss(':')}} 至 {{telEndTs|$ts2hhmmss(':')}}{{LN}}{{LR}}↑↑来源：{{{devName}}}（卡{{slot}} {{msIsdn}}）{{LN}}{{LR}}→时间：{{YMDHMS}}
~~--==~~--==
501
title=【新短信提醒】&desp={{smsBd}}{{LN}}{{LR}}→短信号码：{{phNum}}{{LN}}{{LR}}→短信时间：{{smsTs|$ts2yyyymmddhhmmss('-',':')}}{{LN}}{{LR}}↑↑来源：{{{devName}}}（卡{{slot}} {{msIsdn}}）{{LN}}{{LR}}→时间：{{YMDHMS}}{{LN}}{{LR}}{{{tail}}}
~~--==~~--==
209
title=【设备提醒】{{phNum}}&desp=“卡{{slot}}”存在故障，请将卡放入手机检查原因！{{LN}}{{LR}}SIM卡信息：{{LN}}{{LR}}→iccid：{{iccId}}{{LN}}{{LR}}→imsi：{{imsi}}{{LN}}{{LR}}→卡号：{{msIsdn}}{{LN}}{{LR}}↑↑来源：{{{devName}}}{{LN}}{{LR}}→时间：{{YMDHMS}}
~~--==~~--==
205
title=【设备提醒】{{phNum}}&desp=“卡{{slot}}”已从设备中取出！{{LN}}{{LR}}SIM卡信息：{{LN}}{{LR}}→iccid：{{iccId}}{{LN}}{{LR}}→imsi：{{imsi}}{{LN}}{{LR}}→卡号：{{msIsdn}}{{LN}}{{LR}}↑↑来源：{{{devName}}}{{LN}}{{LR}}→时间：{{YMDHMS}}
~~--==~~--==
204
title=【设备提醒】{{phNum}}&desp=“卡{{slot}}”已就绪！{{LN}}{{LR}}SIM卡信息：{{LN}}{{LR}}→iccid：{{iccId}}{{LN}}{{LR}}→imsi：{{imsi}}{{LN}}{{LR}}→卡号：{{msIsdn}}{{LN}}{{LR}}→信号强度：{{dbm}}%{{LN}}{{LR}}↑↑来源：{{{devName}}}{{LN}}{{LR}}→时间：{{YMDHMS}}
~~--==~~--==
title=【设备上线提醒】{{{devName}}}&desp=设备已通过 卡2 上线！{{LN}}{{LR}}SIM卡信息：{{LN}}{{LR}}→iccid：{{iccId}}{{LN}}{{LR}}→imsi：{{imsi}}{{LN}}{{LR}}→卡号：{{msIsdn}}{{LN}}{{LR}}→信号强度：{{dbm}}%{{LN}}{{LR}}↑↑来源：{{{devName}}}{{LN}}{{LR}}→时间：{{YMDHMS}}
~~--==~~--==
101
title=【设备上线提醒】{{{devName}}}&desp=设备已通过 卡1 上线！{{LN}}{{LR}}SIM卡信息：{{LN}}{{LR}}→iccid：{{iccId}}{{LN}}{{LR}}→imsi：{{imsi}}{{LN}}{{LR}}→卡号：{{msIsdn}}{{LN}}{{LR}}→信号强度：{{dbm}}%{{LN}}{{LR}}↑↑来源：{{{devName}}}{{LN}}{{LR}}→时间：{{YMDHMS}}

```

**操作图示如下：**
![](接入第三方平台/images/ddd012ed_63be8adc3c6a0.jpg)

------------

> **注意：**
　　先将原有的“设备配置信息”全部清除，然后，再复制上面的配置信息，粘贴到“设备配置数据”的文本框中。

　　
　　（3）登录 Server酱3 网站（新用户可能需要先完成注册），Server酱3 登录地址为：https://sc3.ft07.com/sendkey
　　
　　（4）Server酱3 网站成功后，点击“SendKey”功能获取`sendKey`。

**操作图示如下：**

![](接入第三方平台/images/2d92e529_684c2607acf0f.png)
　
 
　　（5）登录开发板后台页面，进入“接口信息配置”页面，将之前获取的 API URL 填写到接口地址设置文本框中，然后点击“保存页面配置”按钮。

**操作图示如下：**
![](接入第三方平台/images/f65bf10f_684c269fb85cc.png)


　　
　　（6）重启开发板，重启完成之后，开发板中的手机卡的短信以及未接来电提醒，会自动在您的 Server酱 APP中显示。
  
**操作图示如下：**
![](接入第三方平台/images/89a7bb77_684c274457952.jpg)

---


## 控制命令

<a name="什么是控制命令"></a>

### 什么是控制命令


#####什么是控制命令？
　　**控制命令**是由您（或接口）主动发送给开发板，通知开发板执行对应的操作。相应的，开发板收到“命令”并执行，执行的结果以“消息”的方式反馈给您（或接口）。
```seq
您的接口-开发板:&rarr;　　　　　控制命令　　　　　&rarr;
开发板--您的接口:&larr;　　　　　推送消息　　　　　&larr;
```

#####控制指令的示例
　　以获取**开发板当前状态(stat)**的命令为例，说明控制命令的构成：
  ```
  http://192.168.7.170/ctrl?token=3f4bffa77257d243875d0a5a80635934&cmd=stat
  ```
 　　`http://192.168.7.170/ctrl`这是控制命令的固定开头。其中`192.168.7.170`是开发板的当前IP地址，实际使用中需要替换成您的开发板真实的IP地址。
 　　`:38585`是开发板固定的WEB端口号。
 　　`?token=3f4bffa77257d243875d0a5a80635934`**token**所有控制命令的所必须的一个参数，具体**token**的获取方法，请参阅**安全模型与token机制**的相关章节。
 　　`&cmd=stat`**cmd**是控制命令所必须的另一个参数。用于指明开发板具体执行什么动作。
   
 　　这条**控制命令**的作用是，获取开发板当前的各项状态，您可以尝试在浏览器上输入这个URL，之后开发板会以JSON格式返回当前自身的状态信息，示例如下：
   
 ``` 
 {
  "devId": "498060912345",　　//当前开发板唯一ＩＤ
  "schRstHour": 4,			//开发板每日定时重启时间，默认凌晨4点
  "pingSec": 110,			//开发板主动推送PING消息（998）的间隔秒数
  "wifi": {
    "ssid": "mywifi",		//当前连入的WIFI热点名
    "ip": "192.168.7.170",	//当前开发板的IP地址
    "dbm": 21				//当前WIFI的信号强度
  },
  "slot": {
    "slot1_sta": "ERR",		//卡槽1通信模组状态：异常（不可识别）
    "slot2_sta": "POWON",	//卡槽2通信模组状态：正常开机
    "sim2_op": "T",			//卡槽2中SIM卡所属运营商：中国电信
    "sim2_dbm": "99",		//卡槽2中SIM卡的信号强度：99%
    "sim2iccId": "89860321745322212345",	//卡槽2中SIM卡的ICCID
    "sim2_sta": "OK"		 //卡槽2中SIM卡的当前状态：正常就绪
  },
  "time":"220618101522"		//开发板当前时间yymmddhhmmss
} 

 ```
 　　如果您使用TCP接口与设备通信，可以用下面的消息获取设备状态：
   ```
   {"cmd":"stat", "tid":"1234"}\x11\x12
   ```
 　　注意：TCP接口通信时，每一条消息最后都必须附加2个字节的结束符，用于表示消息的结束。2个字节的结束符必须是0x11 0x12。即结束符第一个字节是0x11，第二个字节是0x12。
   ```
   注意：
   0x11 0x12 分别代表2个字节，不要写成字符串。
   ```

---

<a name="安全模型与token机制"></a>

### 安全模型与token机制


#####安全模型概要
　　绿邮&reg;开发板支持二层权限管理体系，即管理员权限 和 用户权限。管理员权限高于用户权限，例如，通过管理员权限可以修改用户密码。
  
　　管理员权限主要用于登录开发板后台WEB页面，进行开发板底层的用户接口、运行参数等相关配置；用户权限主要是对开发板的日常运行进行查询维护，如查询开发板的运行状态、添加新的WiFi热点信息、重启开发板等。
  
　　管理员用户名固定为admin，密码出厂默认为admin，后续可以通过开发板的后台WEB页面进行修改。用户权限不允许登录后台WEB页面，用户权限也没有默认的用户名，只有用户密码。用户密码出厂默认为000000。
  
#####token机制
　　通过HTTP向开发板发送**控制指令**时，必须携带token参数。token参数的取值一般可以在登录WEB后台页面，进入“密码管理”子页面中查询：
![](控制命令/images/f9c9a6c7_63c0fcd07c529.png)
　　除了通过后台页面查询token之外，您可以自行计算token的取值。token的计算方法如下：
　　1. 将管理员名、密码拼接为字符串，中间以竖线“|”分隔。例如：`admin|admin`
　　2. 计算拼接字符串的MD5值转为16进制，即可获得token。

---


### OTA升级命令

<a name="dailyota-设置每日ota升级时间"></a>

#### dailyota - 设置每日OTA升级时间


######“命令:dailyOTA - 设置每日自动OTA升级的时间”使用说明
######命令的作用
　　使用 dailyOTA 命令，可以让开发板在每天的固定时段，自动完成一次OTA升级。
　　默认值是3，表示每天3点自动重启。参数中只能指定小时，分钟随机。
　　如果开发板发现了新的固件版本，则会自动完成升级。升级成功后，开发板自动重启。
　　如果开发板未发现新的固件版本，则不执行任何操作。
######命令的格式（示例）
```
http://192.168.7.170/ctrl?token=3f4bffa77257d243875d0a5a80635934&cmd=dailyota&p1=3
```
######命令的格式（TCP方式示例）
```
{"cmd":"dailyota", "p1":3, "tid":"1234"}\x11\x12
```
######命令参数说明
 | 参数名  | 参数值（示例）  |参数类型|说明|
| ------------ |:------------ |-----|--|
|token |3f4bffa77257d243875d0a5a80635934 |字符型|管理员Token|
|cmd  | dailyota |字符型|控制命令名称|
|p1 |3 |数值型|开发板每天自动OTA升级的时间。0~23表示时段。取值大于23（如25）则表示关闭每日升级|
|tid (可选)  | 任意值 |字符型|仅TCP接口方式可用。如省略，则命令执行后，不反馈命令执行结果。|
######命令反馈结果
成功时返回：
```
{
  "code": 0
}
```

失败时返回：
```
{
  "code": 101,
  "msg": "Invalid arguments."
}
```

######命令反馈结果说明
无

---

<a name="otanow-立即执行ota升级"></a>

#### otanow- 立即执行OTA升级


######“命令:otanow - 立即执行OTA升级”使用说明
######命令的作用
　　使用 otanow 命令，可以让设备执行一次在线自动升级。
　　使用时注意以下事项：
　　(1) 发出 otanow 命令后，开发板在**90秒内不能断电**，否则会导致升级失败，无法开机。
　　(2) 开发板升级完成后，会自动重启。您可以登录开发板后台的首页面，查看当前固件版本号。
　　(3) 开发板已经连入的WIFI热点，必须能正常访问互联网。

######命令的格式（示例）
```
http://192.168.7.170/ctrl?token=3f4bffa77257d243875d0a5a80635934&cmd=otanow
```
######命令的格式（TCP方式示例）
```
{"cmd":"otanow", "tid":"1234"}\x11\x12
```
######命令参数说明
 | 参数名  | 参数值（示例）  |参数类型|说明|
| ------------ |:------------ |-----|--|
|token |3f4bffa77257d243875d0a5a80635934 |字符型|管理员Token|
|cmd  | otanow |字符型|控制命令名称|
|tid (可选)  | 任意值 |字符型|仅TCP接口方式可用。如省略，则命令执行后，不反馈命令执行结果。|
######命令反馈结果
成功时返回：
```
{
  "code": 0
}
```

失败时返回：
```
{
  "code": 101,
  "msg": "Invalid arguments."
}
```

######命令反馈结果说明
无

---


### WiFi控制命令

<a name="wf-打开或关闭wifi"></a>

#### wf - 打开或关闭wifi


######“命令：wf - 打开或关闭wifi”使用说明
######命令的作用
　　使用 wf 命令，可以打开或关闭开发板的WIFI，也可以查询当前开发板的WIFI状态及信号强度。
　　**注意：** 只推荐在TCP模式中使用这个控制命令。TCP模式中，开发板支持手机卡网络与WIFI网络双通道，所以，当通过本命令关闭了开发板的WIFI功能之后，开发板会自动尝试通过手机卡网络连接到您的后台接口。
　　由于HTTP模式仅支持WIFI联网，所以如果在HTTP模式中发送本命令，开发板会立即处于断网的状态，从而导致无法与后台接口正常通信。
　　遇到这种情况时，您可以通过发送“短信命令”，重新开启开发板的WIFI功能。或者尝试将开发板恢复为“出厂设置”也可以。
  
######命令的格式（打开WIFI示例）
```
http://192.168.7.170/ctrl?token=3f4bffa77257d243875d0a5a80635934&cmd=wf&p1=on
```
######命令的格式（打开WIFI TCP方式示例）
```
{"cmd":"wf", "p1":"on", "tid":"1234"}\x11\x12
```
######命令参数说明
 | 参数名  | 参数值（示例）  |参数类型|说明|
| ------------ |:------------ |-----|--|
|token |3f4bffa77257d243875d0a5a80635934 |字符型|管理员Token|
|cmd  | wf |字符型|控制命令名称|
|p1 |wifi功能状态 |字符型|on:表示开启WIFI；off:表示关闭WIFI|
|tid (可选)  | 任意值 |字符型|仅TCP接口方式可用。如省略，则命令执行后，不反馈命令执行结果。|

######命令反馈结果
成功时返回：
```
{
  "code": 0
}
```

失败时返回：
```
{
  "code": 101,
  "msg": "Invalid arguments."
}
```

######命令反馈结果说明
无

---

<a name="addwf-增加wifi热点信息"></a>

#### addwf - 增加wifi热点信息


######“命令：addwf - 增加可连入的wifi热点信息”使用说明
######命令的作用
　　使用 addwf 命令，可以为开发板增加可以连入的WIFI热点信息。
　　您可以为开发板指定多个WIFI热点信息，开发板会根据附近的WIFI热点清单，自动选择信号最佳的热点进行连接。
　　开发板中可以存储多组WIFI热点信息，数量一般没有上限。
　　**注意，WIFI热点必须是2.4G制式。**
  
######命令的格式（示例）
```
http://192.168.7.170/ctrl?token=3f4bffa77257d243875d0a5a80635934&cmd=addwf&p1=wifi热点名&p2=wifi热点密码
```
######命令的格式（TCP方式示例）
```
{"cmd":"addwf", "p1":"wifi热点名", "p2":"wifi热点密码", "tid":"1234"}\x11\x12
```
######命令参数说明
 | 参数名  | 参数值（示例）  |参数类型|说明|
| ------------ |:------------ |-----|--|
|token |3f4bffa77257d243875d0a5a80635934 |字符型|管理员Token|
|cmd  | addwf |字符型|控制命令名称|
|p1 |wifi热点名 |字符型|可连入的WIFI热点名|
|p2 |wifi热点密码 |字符型|可连入的WIFI热点密码|
|tid (可选)  | 任意值 |字符型|仅TCP接口方式可用。如省略，则命令执行后，不反馈命令执行结果。|

######命令反馈结果
成功时返回：
```
{
  "code": 0
}
```

失败时返回：
```
{
  "code": 101,
  "msg": "Invalid arguments."
}
```

######命令反馈结果说明
无

---

<a name="delwf-删除wifi热点信息"></a>

#### delwf - 删除wifi热点信息


######“命令：delwf - 删除可连入的wifi热点信息”使用说明
######命令的作用
　　使用 delwf 命令，可以将开发板中可以连入的WIFI热点信息删除掉。
　　您可以为开发板指定多个WIFI热点信息，开发板会根据附近的WIFI热点清单，自动选择信号最佳的热点进行连接。
　　开发板中可以存储多组WIFI热点信息，数量一般没有上限。
　　**注意，WIFI热点必须是2.4G制式。**
  
######命令的格式（示例）
```
http://192.168.7.170/ctrl?token=3f4bffa77257d243875d0a5a80635934&cmd=delwf&p1=wifi热点名
```
######命令的格式（TCP方式示例）
```
{"cmd":"delwf", "p1":"wifi热点名", "tid":"1234"}\x11\x12
```
######命令参数说明
 | 参数名  | 参数值（示例）  |参数类型|说明|
| ------------ |:------------ |-----|--|
|token |3f4bffa77257d243875d0a5a80635934 |字符型|管理员Token|
|cmd  | delwf |字符型|控制命令名称|
|p1 |wifi热点名 |字符型|可连入的WIFI热点名|
|tid (可选)  | 任意值 |字符型|仅TCP接口方式可用。如省略，则命令执行后，不反馈命令执行结果。|

######命令反馈结果
成功时返回：
```
{
  "code": 0
}
```

失败时返回：
```
{
  "code": 101,
  "msg": "Invalid arguments."
}
```

######命令反馈结果说明
无

---


### 卡槽控制命令

<a name="slotoff-指定卡槽关机"></a>

#### slotoff - 指定卡槽关机


######“命令：slotoff - 指定卡槽停机”使用说明
######命令的作用
　　使用 slotoff 命令，可以让开发板上的某个卡槽进入关机状态。
　　卡槽关机之后，会执行运营商基站的完整“注销”流程。向已经被关机的卡槽拨入电话时，提示音通常是：您所拨打的电话已关机 或 您所拨打的电话暂时无法接通。
  
　　当您把手机卡重新插入到卡槽后，已经被关机的卡槽将被自动唤醒，并重新进入工作状态。
  
>注意：
　　当设备重启时，已经关机的卡槽也将被唤醒，并重新进入开机工作状态。需要特别注意的是设备每日的自动重启设置，当设备触发了每日自动重启后，所有已经关机的卡槽都将被唤醒。
　　如果需要使用卡槽关机的功能，请务必将每日重启的设置调整到合理的时间段，或关闭每日自动重启功能。

######命令的格式（示例）
```
http://192.168.7.170/ctrl?token=3f4bffa77257d243875d0a5a80635934&cmd=slotoff&p1=1
```
######命令的格式（TCP方式示例）
```
{"cmd":"slotoff", "p1":"1", "tid":"1234"}\x11\x12
```
######命令参数说明
 | 参数名  | 参数值（示例）  |参数类型|说明|
| ------------ |:------------ |-----|--|
|token |3f4bffa77257d243875d0a5a80635934 |字符型|管理员Token|
|cmd  | slotoff |字符型|控制命令名称|
|p1 |1 |数值型|卡槽号。1表示卡槽1；2表示卡槽2|
|tid (可选)  | 任意值 |字符型|仅TCP接口方式可用。如省略，则命令执行后，不反馈命令执行结果。|
######命令反馈结果
成功时返回：
```
{
  "code": 0
}
```

失败时返回：
```
{
  "code": 101,
  "msg": "Invalid arguments."
}
```

######命令反馈结果说明
无

---

<a name="slotrst-指定卡槽重启"></a>

#### slotrst - 指定卡槽重启


######“命令：slotrst - 指定卡槽重启”使用说明
######命令的作用
　　使用 slotrst 命令，可以让开发板上的某个卡槽重新启动。重新启动过程，一般需要60秒左右的时间。命令发出后，相当于用户手动将开发板上的SIM卡弹出后，又重新插入SIM卡。
  
　　正常情况下，您接口会在卡槽重启的过程中，陆续接收到开发板推送的202、203、204推送消息。
######命令的格式（示例）
```
http://192.168.7.170/ctrl?token=3f4bffa77257d243875d0a5a80635934&cmd=slotrst&p1=1
```
######命令的格式（TCP方式示例）
```
{"cmd":"slotrst", "p1":"1", "tid":"1234"}\x11\x12
```
######命令参数说明
 | 参数名  | 参数值（示例）  |参数类型|说明|
| ------------ |:------------ |-----|--|
|token |3f4bffa77257d243875d0a5a80635934 |字符型|管理员Token|
|cmd  | slotrst |字符型|控制命令名称|
|p1 |1 |数值型|卡槽号。1表示卡槽1；2表示卡槽2|
|tid (可选)  | 任意值 |字符型|仅TCP接口方式可用。如省略，则命令执行后，不反馈命令执行结果。|
######命令反馈结果
成功时返回：
```
{
  "code": 0
}
```

失败时返回：
```
{
  "code": 101,
  "msg": "Invalid arguments."
}
```

######命令反馈结果说明
无

---

<a name="slotplmn-指定卡注册的运营商"></a>

#### slotplmn - 指定卡注册的运营商


######“命令：slotplmn - 指定卡槽注册的运营商代码”使用说明
######命令的作用
　　此命令一般用于境外卡。境外卡在国内落地时，通常可以选择多个运营商，比如有的境外卡允许在国内通过中国移动落地，也可以通过中国联通落地。
  
　　多数情况下，开发板会“自动”完成运营商的落地注册。比如某张卡自动落地为中国移动，有些时间我们希望卡注册到其它运营商（比如中国联通），而非“自动”注册的中国移动。这种情况下，我们可以通过本命令手动指定卡槽落地时的运营商代码。
  
　　常见的落地代码是：46000（中国移动）、46001（中国联通）、46003（中国电信）
  
>注意：
　　1）通过slotplmn设置完落地代码后，重启方可生效。
　　2）此处指定的是卡槽的落地代码，不是SIM卡的落地代码。如果您指定了卡槽1的落地代码，务必将需要特殊落地的手机卡，插到对应的卡槽1中。
　　3）落地代码是做SIM卡注册时的“优先尝试”，而非唯一尝试。比如：如果您指定为：46000，表示落地时优先尝试中国移动，但是在注册的过程中，中国移动无法接受您的卡注册，则开发板会自动重新搜索其它运营商进行注册。

######命令的格式（示例）
```
http://192.168.7.170/ctrl?token=3f4bffa77257d243875d0a5a80635934&cmd=slotplmn&p1=1&p2=46000
```
######命令的格式（TCP方式示例）
```
{"cmd":"slotplmn", "p1":"1", "p2":"46000", "tid":"1234"}\x11\x12
```
######命令参数说明
 | 参数名  | 参数值（示例）  |参数类型|说明|
| ------------ |:------------ |-----|--|
|token |3f4bffa77257d243875d0a5a80635934 |字符型|管理员Token|
|cmd  | slotplmn |字符型|控制命令名称|
|p1 |1 |数值型|卡槽号。1表示卡槽1；2表示卡槽2|
|p2 |46000 |字符型|指定的运营商代码。0：表示恢复为“自动”|
|tid (可选)  | 任意值 |字符型|仅TCP接口方式可用。如省略，则命令执行后，不反馈命令执行结果。|
######命令反馈结果
成功时返回：
```
{
  "code": 0
}
```

失败时返回：
```
{
  "code": 101,
  "msg": "Invalid arguments."
}
```

######命令反馈结果说明
无

---


### 短信命令

<a name="sendsms-外发短信"></a>

#### sendsms - 外发短信


######“命令：sendsms - 控制SIM卡外发短信”使用说明
######命令的作用
　　使用 sendsms 命令，可以控制开发板的某个卡槽中的SIM卡，向外发送短信。
  
　　如果您的接口需要获取**短信发外成功报告**，那么您需要在控制命令中增加tid参数，并为其添加一个唯一ID（一般推荐使用timestamp即可）。
　　当短信外发成功后，您的接口将接收到开发板推送的501消息。501消息中tid参数，与您在控制命令中提供的tid参数一致。

```plantuml
@startuml
用户接口 -> 开发板:　控制命令:sendsms (tid=123456)
用户接口 <-- 开发板 : 　　推送消息:501 (tid=123456)
@enduml
```
　　
　　sendsms控制消息中，tid参数不可以省略。
  
######命令的格式（示例）
```
http://192.168.7.170/ctrl?token=3f4bffa77257d243875d0a5a80635934&cmd=sendsms&tid=1647344840&p1=2&p2=10001&p3=查话费
```
######命令的格式（TCP方式示例）
```
{"cmd":"sendsms", "p1":2, "p2":"10001", "p3":"查话费", "tid":"1647344840"}\x11\x12
```
######命令参数说明
 | 参数名  | 参数值（示例）  |参数类型|说明|
| ------------ |:------------ |-----|--|
|token |3f4bffa77257d243875d0a5a80635934 |字符型|管理员Token|
|cmd  | sendsms |字符型|控制命令名称|
|p1 |2 |数值型|外发短信的卡槽号|
|p2 |10001 |字符型|短信号码|
|p3 |查话费 |字符型|短信内容|
|tid   | 任意值 |字符型|不可省略。控制命令的唯一标识，用于接收501消息（短信外发成功报告）|
######命令反馈结果
成功时返回：
```
{
  "code": 0
}
```

失败时返回：
```
{
  "code": 101,
  "msg": "Invalid arguments."
}
```

######命令反馈结果说明
无

---

<a name="querysms-查询本地短信库"></a>

#### querysms - 查询本地短信库


######“命令：querysms - 查询本地短信库”使用说明
######命令的作用
　　开发板本身可以滚动存储最近的100条短信。通过 querysms 命令，可以查询开发板本地存储的最近100条短信记录。
  
######命令的格式（示例）
```
http://192.168.7.170/ctrl?token=3f4bffa77257d243875d0a5a80635934&cmd=querysms&p1=1&p2=10
```
######命令的格式（TCP方式示例）
```
{"cmd":"querysms", "p1":1, "p2":10}\x11\x12
```
######命令参数说明
 | 参数名  | 参数值（示例）  |参数类型|说明|
| ------------ |:------------ |-----|--|
|token |3f4bffa77257d243875d0a5a80635934 |字符型|管理员Token|
|cmd  | querysms |字符型|控制命令名称|
|p1 |1 |数值型|从第几条短信开始查询（offset）|
|p2 |10 |数值型|共查询多少条（rows On Page）|
|p3 |话费余额 |字符型|限制查询的短信内容关键字（省略查所有）|
######命令反馈结果
成功时返回：
```
{
  "subType": 30,
  "code": 0,
  "qkey": "",
  "offset": "1",
  "limit": "10",
  "results": [
    {
      "slot": 1,
      "dir": 0,
      "phNum": "10691021560051",
      "smsBd": "【火山引擎】尊敬的用户，…………",
      "smsTs": 1751453195
    },
    {
      "slot": 1,
      "dir": 0,
      "phNum": "10691009096368",
      "smsBd": "【河北银行】您尾号7525的信用卡…………",
      "smsTs": 1751428444
    },
    {
      "slot": 1,
      "dir": 0,
      "phNum": "95555",
      "smsBd": "【招商银行】张三于07月02日07:56向贵账户7524发起2121.00元的转账，请注意查收.",
      "smsTs": 1751417021
    },
    {
      "slot": 1,
      "dir": 0,
      "phNum": "10680786600000009587",
      "smsBd": "【贝锐】您正在验证向日葵帐号的登录操作，验证码：502519。",
      "smsTs": 1751360771
    },
    {
      "slot": 1,
      "dir": 0,
      "phNum": "106305792292",
      "smsBd": "【深度求索】验证码：517351，有效期 5 分钟，如非本人操作，请忽略。",
      "smsTs": 1751359963
    }
  ],
  "devId": "e51e9881265a3c8",
  "type": 402,
  "netCh": 0,
  "msgTs": 1751460187
}
```

失败时返回：
```
{
  "code": 101,
  "msg": "Invalid arguments."
}
```

######命令反馈结果说明
　　1）查询的短信结果，保存在results字段（集合）中。
  
　　2）p1参数指定从短信库的第几条开始查询（最值是1）， p2参数指定共查询多少条。
　　比如：当您需要分页查询，每页5条短信记录。查询第1页时，需要发送参数：
  ```p1=1(从第1条开始查询)；p2=5(共查询5条) ```
　　查询第2页时，需要发送参数：
    ```p1=6(从第1条开始查询)；p2=5(共查询5条) ```
　　依次类推。
  
　　3）当results字段中返回的记录数大于p2指定的查询条数时，表示后面还有更多记录可以查询。
　　比如：指定参数：p1=1, p2=5。返回的查询结果中results的记录数是6，表示本页查询完成后，后面还有更多的短信记录，可以继续查询。
　　同样的，如果指定参数：p1=1, p2=5。返回的查询结果中results的记录数是5 或 小于5。则表示本页面已经是最后一页了。后面没有更多短信记录了。
  
　　4）本地短信库是按短信时间“降序保存”的，即最后收到的短信，总是出现在短信库的第1页的第1条。如果您需要查询短信库中最近的5条记录，则指定的参数总是：
  ```p1=1(从第1条开始查询)；p2=5(共查询5条) ```
　　这样的话，querysms命令总是返回开发板最近收到的5条短信记录。
  
　　5）返回记录的结果的各字段意义解释：
```json
  "results": [
    {
      "slot": 1,	//卡槽号。1表示卡槽一
      "dir": 1,		//短信方向。 0表示收到的短信；1表示发出的短信
      "phNum": "053256894747",		//短信号码
      "smsBd": "【河北银行】您尾号7525的信用卡…………",
      "smsTs": 1751428444		//短信时间戳
    }]
```

---


### 设备控制类命令

<a name="chpwduser-修改用户密码"></a>

#### chpwduser - 修改用户密码


######“命令：chpwduser - 修改用户密码”使用说明
######命令的作用
　　使用chpwduser指令，可以修改用户密码。
######命令的格式（HTTP方式示例）
```
http://192.168.7.170/ctrl?token=3f4bffa77257d243875d0a5a80635934&cmd=chpwduser&p1=000000
```
######命令的格式（TCP方式示例）
```
{"cmd":"chpwduser", "p1":"000000", "tid":"1234"}\x11\x12
```
######命令参数说明
 | 参数名  | 参数值（示例）  |参数类型|说明|
| ------------ |:------------ |-----|--|
|token |3f4bffa77257d243875d0a5a80635934 |字符型|管理员Token|
|cmd  | chpwduser |字符型|控制命令名称|
|p1 |000000 |字符型|新用户密码（不能少于4个字符）|
|tid (可选)  | 任意值 |字符型|仅TCP接口方式可用。如省略，则命令执行后，不反馈命令执行结果。|
######命令反馈结果
成功时返回：
```
{
  "code": 0
}
```

失败时返回：
```
{
  "code": 101,
  "msg": "Invalid arguments."
}
```

######命令反馈结果说明
无

---

<a name="now-设置开发板时间"></a>

#### now - 设置开发板时间


######“命令：now  - 为开发板设置时间”使用说明
######命令的作用
　　使用now命令，可以为开发板设置当前时间。

　　为开发板设置时间，一般有二种途径：
  
　　1、接口端向开发板发出“now”命令，并在“p1”参数中携带当前时间。开发板收到接口下发的时间后，会立即以“p1”参数中的时间，重新校准自身的时间。
  
　　2、如果接口下发的“now”命令中，没有携带“p1”参数时，由根据开发板的默认设置，开发板如果已经连入WIFI，则会通过WIFi向NTP服务器（全球时间校准服务器）请求当前时间。如果开发板未连入WIFI，则开发板会通过通讯模组向运营商请求当前时间。
  
　　注意：开发板默认当前时区为北京时间（+8时区），如需更改时区，可在“now”中指定“p3”参数，以对开发板的时区进行校准。
  
######命令的格式（示例）
```
http://192.168.7.170/ctrl?token=3f4bffa77257d243875d0a5a80635934&cmd=now&p1=20221015103005&p2=15&p3=8
```
######命令的格式（TCP方式示例）
```
{"cmd":"now", "p1":"20221015103005", "p2":15, "p3":8, "tid":"1234"}\x11\x12
```
######命令参数说明
 | 参数名  | 参数值（示例）  |参数类型|说明|
| ------------ |:------------ |-----|--|
|token |3f4bffa77257d243875d0a5a80635934 |字符型|管理员Token|
|cmd  | now |字符型|控制命令名称|
|p1  | 20221015103005 |字符型|当前时间。格式：年年年年月月日日时时分分秒秒（省略时由开发板自动获取时间）|
|p2| 15 |数值型|是否允许开发板自动校准时间。0：不允许自动校时；15：允许自动校时（默认）；（一般无需给出p2参数）
|p3| 8 |数值型|当前时区。8：中国时区（默认）；（中国使用时，无需给出p3参数）
|tid   | 任意值 |字符型|仅TCP接口方式可用。可为任意值，但不可省略|
######命令反馈结果
成功时返回：
无

失败时返回：
```
{
  "code": 101,
  "msg": "Invalid arguments."
}
```

######命令反馈结果说明
无

---

<a name="stat-获取开发板状态"></a>

#### stat - 获取开发板状态


######“命令：stat  - 获取开发板当前状态”使用说明
######命令的作用
　　使用stat命令，可以获取到开发板的当前所有的状态信息。
######命令的格式（示例）
```
http://192.168.7.170/ctrl?token=3f4bffa77257d243875d0a5a80635934&cmd=stat
```
######命令的格式（TCP方式示例）
```
{"cmd":"stat", "tid":"1234"}\x11\x12
```
######命令参数说明
 | 参数名  | 参数值（示例）  |参数类型|说明|
| ------------ |:------------ |-----|--|
|token |3f4bffa77257d243875d0a5a80635934 |字符型|管理员Token|
|cmd  | stat |字符型|控制命令名称|
|tid   | 任意值 |字符型|仅TCP接口方式可用。可为任意值，但不可省略|
######命令反馈结果
成功时返回：
 ```
 {
  "devId": "498060912345",
  "hwVer": "Y57v671",
  "dailyRst": 4,
  "dailyOTA": 3,
  "pingSec": 110,
  "netCh": 0,
  "wifi": {
    "ssid": "mywifi",
    "ip": "192.168.7.170",
    "dbm": 24
  },
  "slot": {
    "netOrder":[1,2],
    "slot1_sta": "ERR",
    "slot2_sta": "POWON",
    "slot2_ati": "EC600NCNLAR03A11M08",
    "sim2_op": "T",
    "sim2_dbm": "78",
    "sim2_iccId": "89860321745322288888",
    "sim2_imsi": "46007337111234",
    "sim2_msIsdn": "+8613206411822",
    "sim2_sta": "OK"
  }
  "devTime": "220420184724",
  "type": 999,
} 

 ```

失败时返回：
```
{
  "code": 101,
  "msg": "Invalid arguments."
}
```

######命令反馈结果说明
| 参数名  | 参数值（示例）  |参数类型|说明|
| ------------ |------------ |-----|--|
|devId |498060912345 |字符型|开发板的唯一ID|
|hwVer| Y57v671 |字符型|开发板的固件版本号|
|dailyRst  | 4 |数值型|开发板每日定时自动重启的时间。默认值4，有效值0~23。|
|dailyOTA  | 3 |数值型|开发板每日定时自动OTA升级的时间。默认值3，有效值0~23。|
|pingSec  | 110 |数值型|向接口循环推送消息998的周期间隔（秒）。默认值110，最小值10。|
|netCh  | 0 |数值型|本消息由开发板的哪个网络通道推送。0:WIFI; 1:SIM1; 2:SIM2|
|netOrder  | [1,2] |数值数组型|TCP接口方式中，如未连入WIFI，则根据本参数指定的卡槽顺序，尝试使用手机卡网络。|
|wifi -> ssid  | mywifi |字符型|开发板已经连入的WIFI热点名称。|
|wifi -> ip  | 192.168.7.170 |字符型|开发板当前的IP地址。|
|wifi -> dbm  | 24 |数值型|开发板当前连入WIFI热点的信号强度（百分比）。|
|slot -> slot1_sta  | ERR |字符型|卡槽1的当前状态。参见下方的参数说明。|
|slot -> slot2_sta  | POWON |字符型|卡槽2的当前状态。|
|slot -> slot2_ati  | EC600NCNLAR03A11M08 |字符型|卡槽2通信模组的固件版本号。|
|slot -> sim2_op  | T|字符型|卡槽2中SIM卡，所属的运营商。|
|slot -> sim2_dbm  | 78 |数值型|卡槽2中SIM卡的信号强度（百分比）。|
|slot -> sim2_iccId  | 89860321745322288888 |字符型|卡槽2中SIM卡的ICCID。|
|slot -> sim2_imsi  | 46007337111234 |字符型|卡槽2中SIM卡的IMSI。|
|slot -> sim2_msIsdn  | +8613206411822 |字符型|卡槽2中SIM卡的电话号码。|
|slot -> sim2_sta  | OK |字符型|卡槽2中SIM卡的当前状态。参见下方的参数说明。|
|devTime|220420184724|数值型|开发板的当前时间（年年月月日日时时分分秒秒）
|type|999|数值型|消息分类（应答类消息）

######关于slot[1|2]_sta参数的说明
| 参数值  |说明|
| -------- |---------- |
|ERR |卡槽识别错误。可能的原因：1、通信模组未插入；2、通信模组损坏；3、通信模组未获支持。|
|NOSIM |卡槽正常开机，但卡槽中没有插入有效的SIM卡。|
|POWON |卡槽正常开机，SIM卡正常可用。|
|POWOFF |卡槽没有开机。|

######关于sim[1|2]_sta参数的说明
| 参数值  |说明|
| -------- |---------- |
|OK |SIM卡工作正常。|
|PUK |SIM卡上有PUK密码。|
|NS |SIM卡无服务。|
|LT |SIM卡已被限制服务。|

######关于sim[1|2]_op参数的说明
| 参数值  |说明|
| -------- |---------- |
|C |中国移动|
|U |中国联通|
|T |中国电信
|X |境外卡？|
|N |识别失败|

---

<a name="restart-重启开发板"></a>

#### restart - 重启开发板


######“命令：restart - 重启开发板”使用说明
######命令的作用
　　使用 restart 命令，可以重启开发板。
######命令的格式（示例）
```
http://192.168.7.170/ctrl?token=3f4bffa77257d243875d0a5a80635934&cmd=restart
```
######命令的格式（TCP方式示例）
```
{"cmd":"restart", "tid":"1234"}\x11\x12
```
######命令参数说明
 | 参数名  | 参数值（示例）  |参数类型|说明|
| ------------ |:------------ |-----|--|
|token |3f4bffa77257d243875d0a5a80635934 |字符型|管理员Token|
|cmd  | restart |字符型|控制命令名称|
|tid (可选)  | 任意值 |字符型|仅TCP接口方式可用。如省略，则命令执行后，不反馈命令执行结果。|
######命令反馈结果
成功时返回：
无

失败时返回：
```
{
  "code": 101,
  "msg": "Invalid arguments."
}
```

######命令反馈结果说明
无

---

<a name="pingsec-修改ping间隔秒数"></a>

#### pingsec - 修改ping间隔秒数


######“命令：pingsec - 修改ping间隔秒数”使用说明
######命令的作用
　　使用 pingsec 命令，可以修改PING消息（推送消息998）的周期间隔秒数。此值修改后，需要重启开发板后方能生效。
　　在HTTP接口方式中，此命令可以在WEB控制台上禁止推送。
　　在TCP接口方式中，为了维持网络连接，此命令强制必须推送。
######命令的格式（示例）
```
http://192.168.7.170/ctrl?token=3f4bffa77257d243875d0a5a80635934&cmd=pingsec&p1=60
```
######命令的格式（TCP方式示例）
```
{"cmd":"pingsec", "p1":60, "tid":"1234"}\x11\x12
```
######命令参数说明
 | 参数名  | 参数值（示例）  |参数类型|说明|
| ------------ |:------------ |-----|--|
|token |3f4bffa77257d243875d0a5a80635934 |字符型|管理员Token|
|cmd  | pingsec |字符型|控制命令名称|
|p1 |60 |数值型|间隔秒数，最小值10。|
|tid (可选)  | 任意值 |字符型|仅TCP接口方式可用。如省略，则命令执行后，不反馈命令执行结果。|
######命令反馈结果
成功时返回：
```
{
  "code": 0
}
```

失败时返回：
```
{
  "code": 101,
  "msg": "Invalid arguments."
}
```

######命令反馈结果说明
无

---

<a name="dailyrst-设置每日重启时间"></a>

#### dailyrst - 设置每日重启时间


######“命令：dailyrst - 设置每日重启时间”使用说明
######命令的作用
　　使用 dailyrst 命令，可以让开发板在每天的固定时段自动重启一次。
　　默认值是4，表示每天4点自动重启。参数中只能指定小时，分钟随机。
>注意
　　一般来说，我们强烈不建议关闭设备的每日自动重启功能。因为，允许设备每日在空闲时段自动重启一次，将有利于设备的长期稳定运行。

######命令的格式（示例）
```
http://192.168.7.170/ctrl?token=3f4bffa77257d243875d0a5a80635934&cmd=dailyrst&p1=4
```
######命令的格式（TCP方式示例）
```
{"cmd":"dailyrst", "p1":4, "tid":"1234"}\x11\x12
```
######命令参数说明
 | 参数名  | 参数值（示例）  |参数类型|说明|
| ------------ |:------------ |-----|--|
|token |3f4bffa77257d243875d0a5a80635934 |字符型|管理员Token|
|cmd  | dailyrst |字符型|控制命令名称|
|p1 |4 |数值型|开发板每天自动重启的时间。0~23表示时段。取值大于23（如25）则表示关闭每日重启|
|tid (可选)  | 任意值 |字符型|仅TCP接口方式可用。如省略，则命令执行后，不反馈命令执行结果。|
######命令反馈结果
成功时返回：
```
{
  "code": 0
}
```

失败时返回：
```
{
  "code": 101,
  "msg": "Invalid arguments."
}
```

######命令反馈结果说明
无

---


### 通话命令

<a name="通话指令概述"></a>

#### 通话指令概述


######开发板可以实现互联网通话（Voice over Internet Protocol / VoIP）吗？
　　不能。受法律法规的限制，开发板不提供VoIP相关的开发接口。这意味着您无法通过开发，实现将电话卡的通话语音，通过网络进行传递，从而实现网络接打电话的功能。
  
######开发板提供“通话指令”的目的是什么？
　　开发板提供了完整的通话接口，包括电话拨打、电话接听、电话挂断，以及通话中播放机器语音内容的相关开发接口。通过这些开发接口，您可以实现类似于“电话机器人”的功能。一般典型的应用包括：
  - IVR语音导航：
　　类似于您拨打10086号，由移动公司提供的自动语音导航功能： 按（1）查询话费余额； 按（2）查询流量…… 等。并由此扩展，您可以定制自己的IVR语音导航机器人，从而实现类似于自动订单查询、自动业务数据查询等类似的应用。

  - 自动语音报警机器人：
　　类似于您后台自动检测某些报警数据，当发生严重警情时，您可以通过设备的电话语音功能，实现自动的电话报警。比如：当机房中的温度传感器大于65度，则自动拨打管理员的报警手机，管理员接听后，由开发板自动向管理员手机播放当前警情信息。

---

<a name="teldial-电话拨号"></a>

#### teldial - 电话拨号


######“命令:teldial - 控制卡槽向外拨打电话”使用说明
######命令的作用
　　使用 teldial 命令，可以控制设备的某个卡槽，向外拨打电话。
######命令的格式（示例）
```
http://192.168.7.170/ctrl?token=3f4bffa77257d243875d0a5a80635934&cmd=teldial&p1=1&p2=13206411822&p3=55&p4=拨通后播放的TTS语音内容&p5=2&p6=1&p7=1
```
######命令的格式（TCP方式示例）
```
{"cmd":"teldial", "p1":1, "p2":"13206411822", "p3":55, "p4":"拨通后播放的TTS语音内容", "p5":2, "p6":1, "p7":1, "tid":"1234"}\x11\x12
```
######命令参数说明
 | 参数名  | 参数值（示例）  |参数类型|说明|
| ------------ |:------------ |-----|--|
|token |3f4bffa77257d243875d0a5a80635934 |字符型|管理员Token|
|cmd  | teldial |字符型|控制命令名称|
|p1 |1 |数值型|拨号的卡槽号。（1：卡一；2：卡二）|
|p2 | 13206411822 | 字符型 | 拨打的电话号码 |
|p3 | 55 | 数值型 | 通话总时长（秒）。到达后，主动挂断电话。默认值：175秒|
|p4 | 拨通后播放的TTS语音内容 | 字符型 | 电话拨通后向对方播放的TTS语音内容 |
|p5 | 2 | 数值型 | TTS语音播放的次数。（标识TTS共播放几轮）|
|p6 | 1 | 数值型 | 暂停时间。一轮TTS播放完成后，暂停多少秒，再开始下一轮播放|
|p7 | 1 | 数值型 | TTS全部播放完成后的动作。（0：无操作；1：挂断电话）
|tid (可选)  | 任意值 |字符型|仅TCP接口方式可用。如省略，则命令执行后，不反馈命令执行结果。|
######命令反馈结果
成功时返回：
```
{
  "code": 0
}
```

失败时返回：
```
{
  "code": 101,
  "msg": "Invalid arguments."
}
```

######命令反馈结果说明
无

---

<a name="telanswer-接听来电"></a>

#### telanswer - 接听来电


######“命令:telanswer - 控制卡槽接听来电”使用说明
######命令的作用
　　使用 telanswer 命令，可以控制设备的某个卡槽，接听正在响铃中的来电。
######命令的格式（示例）
```
http://192.168.7.170/ctrl?token=3f4bffa77257d243875d0a5a80635934&cmd=telanswer&p1=1&p2=55&p3=拨通后播放的TTS语音内容&p4=2&p5=1&p6=1
```
######命令的格式（TCP方式示例）
```
{"cmd":"telanswer", "p1":1, "p2":55, "p3":"拨通后播放的TTS语音内容", "p4":2, "p5":1, "p6":1, "tid":"1234"}\x11\x12
```
######命令参数说明
 | 参数名  | 参数值（示例）  |参数类型|说明|
| ------------ |:------------ |-----|--|
|token |3f4bffa77257d243875d0a5a80635934 |字符型|管理员Token|
|cmd  | telanswer |字符型|控制命令名称|
|p1 |1 |数值型|接听来电的卡槽号。（1：卡一；2：卡二）|
|p2 | 55 | 数值型 | 通话总时长（秒）。到达后，主动挂断电话。默认值：175秒|
|p3 | 拨通后播放的TTS语音内容 | 字符型 | 电话接通后向对方播放的TTS语音内容 |
|p4 | 2 | 数值型 | TTS语音播放的次数。（标识TTS共播放几轮）|
|p5 | 1 | 数值型 | 暂停时间。一轮TTS播放完成后，暂停多少秒，再开始下一轮播放|
|p6 | 1 | 数值型 | TTS全部播放完成后的动作。（0：无操作；1：挂断电话）
|tid (可选)  | 任意值 |字符型|仅TCP接口方式可用。如省略，则命令执行后，不反馈命令执行结果。|
######命令反馈结果
成功时返回：
```
{
  "code": 0
}
```

失败时返回：
```
{
  "code": 101,
  "msg": "Invalid arguments."
}
```

######命令反馈结果说明
无

---

<a name="telhangup-电话挂机"></a>

#### telhangup - 电话挂机


######“命令:telhangup - 控制卡槽挂断当前通话”使用说明
######命令的作用
　　使用 telhangup 命令，可以控制设备的某个卡槽，立即挂断当前的通话。
######命令的格式（示例）
```
http://192.168.7.170/ctrl?token=3f4bffa77257d243875d0a5a80635934&cmd=telhangup&p1=1
```
######命令的格式（TCP方式示例）
```
{"cmd":"telhangup", "p1":1, "tid":"1234"}\x11\x12
```
######命令参数说明
 | 参数名  | 参数值（示例）  |参数类型|说明|
| ------------ |:------------ |-----|--|
|token |3f4bffa77257d243875d0a5a80635934 |字符型|管理员Token|
|cmd  | telhangup |字符型|控制命令名称|
|p1 |1 |数值型|执行挂机的卡槽号。（1：卡一；2：卡二）|
|tid (可选)  | 任意值 |字符型|仅TCP接口方式可用。如省略，则命令执行后，不反馈命令执行结果。|
######命令反馈结果
成功时返回：
```
{
  "code": 0
}
```

失败时返回：
```
{
  "code": 101,
  "msg": "Invalid arguments."
}
```

######命令反馈结果说明
无

---

<a name="telstarttts-播放tts语音"></a>

#### telstarttts - 播放TTS语音


######“命令:telstarttts - 通话中向对方播放TTS语音”使用说明
######命令的作用
　　使用 telstarttts 命令，当某个卡槽处于通话中的状态时，可以通过本命令向对方播放指定的TTS语音内容。
######命令的格式（示例）
```
http://192.168.7.170/ctrl?token=3f4bffa77257d243875d0a5a80635934&cmd=telstarttts&p1=1&p2=拨通后播放的TTS语音内容&p3=2&p4=1&p5=0
```
######命令的格式（TCP方式示例）
```
{"cmd":"telstarttts", "p1":1, "p2":"拨通后播放的TTS语音内容", "p3":2, "p4":1, "p5":0, "tid":"1234"}\x11\x12
```
######命令参数说明
 | 参数名  | 参数值（示例）  |参数类型|说明|
| ------------ |:------------ |-----|--|
|token |3f4bffa77257d243875d0a5a80635934 |字符型|管理员Token|
|cmd  | telstarttts |字符型|控制命令名称|
|p1 | 1 |数值型|播放语音的卡槽号。（1：卡一；2：卡二）|
|p2 | 拨通后播放的TTS语音内容 | 字符型 | 电话拨通后向对方播放的TTS语音内容 |
|p3 | 2 | 数值型 | TTS语音播放的次数。默认值：0（不限次数）|
|p4 | 1 | 数值型 | 暂停时间。一轮TTS播放完成后，暂停多少秒，再开始下一轮播放|
|p5 | 0 | 数值型 | TTS全部播放完成后的动作。（0：无操作；1：挂断电话）
|tid (可选)  | 任意值 |字符型|仅TCP接口方式可用。如省略，则命令执行后，不反馈命令执行结果。|
######命令反馈结果
成功时返回：
```
{
  "code": 0
}
```

失败时返回：
```
{
  "code": 101,
  "msg": "Invalid arguments."
}
```

######命令反馈结果说明
无

---

<a name="telstoptts-停止播放tts语音"></a>

#### telstoptts- 停止播放TTS语音


######“命令:telstoptts - 通话中停止正在播放的TTS语音”使用说明
######命令的作用
　　使用 telstoptts 命令，当某个卡槽处于通话中的状态时，可以通过本命令停止正在播放的TTS语音内容。
######命令的格式（示例）
```
http://192.168.7.170/ctrl?token=3f4bffa77257d243875d0a5a80635934&cmd=telstoptts&p1=1&p2=0
```
######命令的格式（TCP方式示例）
```
{"cmd":"stoptts", "p1":1, "p2":0, "tid":"1234"}\x11\x12
```
######命令参数说明
 | 参数名  | 参数值（示例）  |参数类型|说明|
| ------------ |:------------ |-----|--|
|token |3f4bffa77257d243875d0a5a80635934 |字符型|管理员Token|
|cmd  | telstoptts |字符型|控制命令名称|
|p1 | 1 |数值型|拨号的卡槽号。（1：卡一；2：卡二）|
|p2 | 0 | 数值型 | TTS停止播放后的动作。（0：无操作；1：挂断电话）
|tid (可选)  | 任意值 |字符型|仅TCP接口方式可用。如省略，则命令执行后，不反馈命令执行结果。|
######命令反馈结果
成功时返回：
```
{
  "code": 0
}
```

失败时返回：
```
{
  "code": 101,
  "msg": "Invalid arguments."
}
```

######命令反馈结果说明
无

---

<a name="querytel-查询本地通话记录"></a>

#### querytel - 查询本地通话记录


######“命令：querytel - 查询本地通话记录”使用说明
######命令的作用
　　开发板本身可以滚动存储最近的50条通话记录。通过 querytel 命令，可以查询开发板本地存储的最近50条通话记录。
  
######命令的格式（示例）
```
http://192.168.7.170/ctrl?token=3f4bffa77257d243875d0a5a80635934&cmd=querytel&p1=1&p2=10&p3=0
```
######命令的格式（TCP方式示例）
```
{"cmd":"querytel", "p1":1, "p2":10, "p3":0}\x11\x12
```
######命令参数说明
 | 参数名  | 参数值（示例）  |参数类型|说明|
| ------------ |:------------ |-----|--|
|token |3f4bffa77257d243875d0a5a80635934 |字符型|管理员Token|
|cmd  | querysms |字符型|控制命令名称|
|p1 |1 |数值型|从第几条短信开始查询（offset）|
|p2 |10 |数值型|共查询多少条（rows On Page）|
|p3 |10 |数值型|查询的通话类型。（0：所有；1：仅来电；2：仅外呼电话；3：仅漏接来电）|
|p4 |132 |字符型|限制查询的通话号码关键字（省略查所有）|
######命令反馈结果
成功时返回：
```json
{
  "subType": 31,
  "code": 0,
  "offset": "1",
  "limit": "3",
  "callType": 0,
  "qkey": "",
  "results": [
    {
      "slot": 1,
      "dir": 1,
      "phNum": "053256894747",
      "telStartTs": 1751421911,
      "telEndTs": 1751421941,
      "conn": 1
    },
    {
      "slot": 2,
      "dir": 0,
      "phNum": "13855668899",
      "telStartTs": 1751267248,
      "telEndTs": 1751267251,
      "conn": 0
    },
    {
      "slot": 2,
      "dir": 1,
      "phNum": "8613316582441",
      "telStartTs": 1751266780,
      "telEndTs": 1751266787,
      "conn": 0
    },
    {
      "slot": 1,
      "dir": 0,
      "phNum": "anonymous",
      "telStartTs": 1751017174,
      "telEndTs": 1751017202,
      "conn": 0
    }
  ],
  "devId": "e51e9881265a3c8",
  "type": 402,
  "netCh": 0,
  "msgTs": 1751461200
}
```

失败时返回：
```json
{
  "code": 101,
  "msg": "Invalid arguments."
}
```

######命令反馈结果说明
　　1）查询的通话记录，保存在results字段（集合）中。
  
　　2）p1参数指定从通话记录库的第几条开始查询（最值是1）， p2参数指定共查询多少条。
　　比如：当您需要分页查询，每页5条通话记录。查询第1页时，需要发送参数：
  ```p1=1(从第1条开始查询)；p2=5(共查询5条) ```
　　查询第2页时，需要发送参数：
    ```p1=6(从第1条开始查询)；p2=5(共查询5条) ```
　　依次类推。
  
　　3）当results字段中返回的记录数大于p2指定的查询条数时，表示后面还有更多记录可以查询。
　　比如：指定参数：p1=1, p2=5。返回的查询结果中results的记录数是6，表示本页查询完成后，后面还有更多的通话记录，可以继续查询。
　　同样的，如果指定参数：p1=1, p2=5。返回的查询结果中results的记录数是5 或 小于5。则表示本页面已经是最后一页了。后面没有更多通话记录了。
  
　　4）本地通话记录库是按通话时间“降序保存”的，即最后进行的通话，总是出现在通话记录库的第1页的第1条。如果您需要查询通话记录库中最近的5条记录，则指定的参数总是：
  ```p1=1(从第1条开始查询)；p2=5(共查询5条) ```
　　这样的话，querytel命令总是返回开发板最近记录的5条通话记录。
  
　　5）返回记录的结果的各字段意义解释：
```json
  "results": [
    {
      "slot": 1,	//卡槽号。1表示卡槽一
      "dir": 1,		//通话方向。 0表示呼入通话；1表示呼出通话
      "phNum": "053256894747",		//通话号码
      "telStartTs": 1751421911,		//通话开始时间戳
      "telEndTs": 1751421941,		//通话结束时间戳
      "conn": 1		//电话是否接通。0：未接通；1：已接通
    }]
```

---

<a name="telkeypress-本地电话按键"></a>

#### telkeypress - 本地电话按键


######“命令:telkeypress - 默认本机电话按键”使用说明
######命令的作用
　　使用 telkeypress 命令，可以模拟本机的电话按键。
　　比如当您控制开发板拨打10086时，对方语音提示：按1查余额，按2查账单。此时，您可以控制开发板发送本机按键 1 或 2，进入10086语音导航的其它环节。
>注意：
　　（1）有效的按键包括：0-9, A, B, C, D, *, #
　　（2）多个按键序列之间，可以插入暂停符。暂停符一共有4个，分别是：p、 P、 m、 M
　　　　p (小写）表示：暂停1000毫秒（1秒）；
　　　　P (大写）表示：暂停5000毫秒（5秒）；
　　　　m (小写) 表示：暂停100毫秒（0.1秒）；
　　　　M (大写) 表示：暂停500毫秒（0.5秒）；
　　　　比如发送按键序列：http:// ... cmd=telkeypress&p1=1&p2=13255668899P1pp2mM3
　　　　表示控制开发板向对方发送以下按键：
　　　　　按键：13255668899
　　　　　　（1个P，暂停5秒后）
　　　　　按键：1
　　　　　　（2个p，暂停2秒后）
　　　　　按键：2
　　　　　　（mM两个暂停符，暂停0.6秒后）
　　　　　按键：3

######命令的格式（示例）
```
http://192.168.7.170/ctrl?token=3f4bffa77257d243875d0a5a80635934&cmd=telkeypress&p1=1&p2=1
```
######命令的格式（TCP方式示例）
```
{"cmd":"telkeypress", "p1":1, "p2":"1", "tid":"1234"}\x11\x12
```
######命令参数说明
 | 参数名  | 参数值（示例）  |参数类型|说明|
| ------------ |:------------ |-----|--|
|token |3f4bffa77257d243875d0a5a80635934 |字符型|管理员Token|
|cmd  | telkeypress |字符型|控制命令名称|
|p1 |1 |数值型|拨号的卡槽号。（1：卡一；2：卡二）|
|p2 | 1 | 字符型 | 模拟本地按键的按键序列（可以是多个字符） |
|p3 | 200 | 数值型 | 按键音时长（毫秒）。默认值：200毫秒|
|p4 | 100 | 数值型 | 多个按键音之间间隔毫秒数。默认值：100毫秒 |
|tid (可选)  | 任意值 |字符型|仅TCP接口方式可用。如省略，则命令执行后，不反馈命令执行结果。|
######命令反馈结果
成功时返回：
```
{
  "code": 0
}
```

失败时返回：
```
{
  "code": 101,
  "msg": "Invalid arguments."
}
```

######命令反馈结果说明
无

---


## 推送消息

<a name="什么是推送消息"></a>

### 什么是推送消息


#####什么是推送消息？
　　开发板在完成特定的动作（比如收到了短信、成功连入了WIFI等）之后，主动向您的接口推送的数据，称为：“**推送消息**”。
  
　　推送消息支持**HTTP GET、POST** 或 **TCP自有协议** 两种推送方式。如果您选择了HTTP推送，在最终产品发行时，推荐使用HTTP POST方式。
  
　　基于HTTP的推送消息支持**FORM、JSON**两种数据格式；基于TCP的推送消息，仅支持**JSON**一种数据格式，您可以根据需要自行选择。
  
```seq
开发板-您的接口:&rarr;　　　　　推送消息　　　　　&rarr;
```

#####基于HTTP推送消息的示例　　
　　以**消息:100 - WIFI已联网**为例，进行分析说明：
  
###### （1）以 “HTTP GET + FORM格式” 的推送示例：

　　此种配置下，开发板向您的接口推送数据时，开发板底层实际上是模拟了HTTP URL的GET访问，将需要推送的数据，以参数的形式，放在了您的接口地址后面，例如：  
```
http://www.yoursinf.com/sms?devId=498060912345&type=100&ip=192.168.7.170&ssid=mywifi&dbm=63
```
　　其中，`http://www.yoursinf.com/sms`是您自己定义的接口地址。
  
　　而`?devId=498060912345&type=100&ip=192.168.7.170&ssid=mywifi&dbm=63`是由开发板自动附加的参数信息。
　　
　　在多数的高级语言中，通过读取request对象可以获取到url中的参数信息。比如，在JAVA语言中，如需获取request中的开发板硬件序号，可以通过：`request.getParameter("devId");`获取到对应的信息。
&dash;
&dash;
######（2）以  “HTTP GET + JSON格式” 的推送示例：
　　此种配置下，开发板向您的接口推送数据时，开发板的底层实际上是模拟了HTTP URL的GET访问，将需要推送的数据打包成了JSON格式，放在了名称为“**p**”的参数中，例如：
```
http://www.yoursinf.com/sms?p={"devId":"498060912345","type":100,"ip":"192.168.7.170","ssid":"mywifi","dbm":61}
```
　　其中，`http://www.yoursinf.com/sms`是您自己定义的接口地址。
  
　　而`?p={"devId":"498060912345","type":100,"ip":"192.168.7.170","ssid":"mywifi","dbm":61}`是由开发板自动附加的JSON格式的参数信息。

　　注意，此时开发板推送的JSON数据，被放在了固定的参数名称 **“p”** 中。
　　
　　在多数的高级语言中，通过读取request对象可以获取到url中的参数信息。比如，在JAVA语言中，如需获取JSON数据，可以通过：`request.getParameter("p");`获取到对应的JSON信息。
　　
  　　
**HTTP GET方式请注意：由于某些特殊字符（+、&、?等）是不能直接在URL中传递的，开发析参传递前，会对参数内容进行Url Encode，对应的，您的接口收到数据后，需要对数据进行反向的Url Decode。**
&dash;
&dash;
######（3）以  “HTTP POST + FORM格式” 的推送示例：
　　此种配置下，开发板向您的接口推送数据时，开发板的底层实际上是模拟了HTTP FORM表单的POST提交，例如：
```
  <form action="http://www.yoursinf.com/sms" method="post">
		<input name="devId" value="498060912345">
		<input name="type" value="100">
		<input name="ip" value="192.168.7.170">
		<input name="ssid" value="mywifi">
		<input name="dbm" value="61">
  </form>
```
  
　　在多数的高级语言中，通过读取request对象可以获取到表单参数信息。比如，在JAVA语言中，如需获取form表单中的开发板硬件序号，可以通过：`request.getParameter("devId");`获取到对应的信息。
&dash;
&dash;

######（4）以  “HTTP POST + JSON格式” 的推送示例：
　　此种配置下，开发板向您的接口推送数据时，开发板的底层实际上是模拟了HTTP二进制流的POST数据提交，例如：
```
Host:www.yoursinf.com
Content-Length:85
Content-Type:application/json;charset=UTF-8
{
	  "devId": "498060912345",
	  "type": 100,
	  "ip": "192.168.7.170",
	  "ssid": "mywifi",
	  "dbm": 60
}
```
 
　　在多数的高级语言中，通过读取request中的“二进制流”，可以直接读取到JSON数据。比如在JAVA语言中，可以参考以下方式：
  
```
BufferedReader r = null;
  try {
	r = new BufferedReader(new InputStreamReader(request.getInputStream(), "UTF-8"));
	StringBuilder sb = new StringBuilder();
	String s;
	while ((s = r.readLine()) != null) {
		sb.append(s);
	}
	System.out.println("json params:" + sb.toString());
} catch (Exception e) {
	e.printStackTrace();
} finally {
	if (r != null) r.close();
}
```
　　
#####基于HTTP的几种数据推送方式的总结
　　选用HTTP GET方式接收数据时，接口一侧的开发相对简单，便于快速开发调试。但选用HTTP GET方式的缺点主要有以下两点：
  1. GET方式传递复杂数据时（比如开发板向您的接口传递“新短信”消息时），接口一侧必须对接收到的数据进行URL Decode操作。
  2. GET方式所能传递的数据长度有限。超长的数据采用HTTP GET传递时，会出现**推送失败**的情况。比如，开发板向接口推送一条包括了较多字数的新短信消息等。
  
　　基于上述原因，原则了HTTP GET一般只推荐于开发调试阶段使用，最终产品中都推荐使用HTTP POST方式。

　　
#####基于TCP的推送消息示例：
　　以**消息:100 - WIFI已联网**为例，进行示例说明：
`{"devId":"498060912345","type":100,"ip":"192.168.7.170","ssid":"mywifi","dbm":76}\x11\x12`
　　基于TCP的推送消息格式与基于HTTP JSON的格式是完全一样的。唯一不同的是，基于TCP的每一条推送消息的最后以 0x11 0x12 两个ascii字符为固定的结束符。也就是说您的TCP Server收到0x11 0x12固定结束符时，表示一条推送消息已经发送完成。

---

<a name="消息推送的顺序"></a>

### 消息推送的顺序


#####推送消息的时序说明

######（1）推送消息：100
这是开发板通电开机，在成功连入了WIFI热点后，向您的接口推送的第一个消息，表示开发板已经联网成功。
**接口返回**：接口收到100消息后，可以向接口反馈14位纯文字时间，给开发板设置时钟**（可选）**。
```plantuml
@startuml
开发板 -> 用户接口:　　　　　　　消息：100（WIFI已连网）
用户接口 --> 开发板 : 　　返回当前时间(14位格式：yyyyMMddHHmmss)　　
@enduml
```
14位时间格式为：年年年年月月日日时时分分秒秒，比如：20220218150605。

######请注意：
- 如果您的接口是HTTP方式，开发板向您的接口推送100消息时，您的HTTP接口Response可以不返回数据（此时开发板时间将是1970年1月1日）。但是，接口的WEB服务器返回的HTTP CODE值，必须为200，否则，开发板会自动尝试连接其它WIFI热点（如有），并重新推送100消息，直到HTTP CODE能够正确返回200。

- 如果您的接口是TCP方式，开发板向您的接口推送100消息时，您的接口 **必须** 返回以下格式的应答：
```
{"cmd":"now", "p1":"20220330184700", "tid":"1234"}\x11\x12
```
即，您的接口必须返回14位的当前时间做为应答。此应答必须在5秒内完成，否则将视为TCP链接建立失败。正常情况下，您的接口给出上述应答之后，开发板将再次回复一个“应答已收到”的消息给您的接口，格式如下：
```
{"code":0, "type":999, "netCh":0, "tid":"1234"}\x11\x12
```
至此，开发板与您的接口之间TCP网络建立成功。

　
######（2）推送消息：301
开发板开机并成功连入WIFI后，首先对开发板所搭载的通讯模组进行识别。
如果搭载的通讯模组识别未成功（比如开发板上未接入通讯模组，或通讯模组规格不能识别等），开发板会向接口推送301消息。
**接口返回**：无
```plantuml
@startuml
开发板 -> 用户接口:　　消息：301（设备卡槽模组异常）
@enduml
```

　
######（3）推送消息：209
开发板对板载的通讯模组识别完成后，会对卡槽中的SIM卡进行识别。
如果SIM卡识别未成功（比如SIM卡损坏、SIM卡未插好等），开发板会向接口推送209消息。
**接口返回**：无
```plantuml
@startuml
开发板 -> 用户接口:　　消息：209（SIM卡错误）
@enduml
```
　
######（4）推送消息：202、203、204
开发板对卡槽中的SIM卡识别成功后，会对SIM卡进行一系列的初始化处理。
SIM的初始化过程中，开发板会根据初始化的进度，逐一向您的接口推送多个消息，对当前进度进行报告。
当所有初始化处理完成后，最终会推送204消息，表示SIM已经就绪。此时，SIM已经可以的正常接打电话、收发短信。
**接口返回**：无
```plantuml
@startuml
开发板 -> 用户接口:　　消息：202（SIM卡准备初始化）
开发板 -> 用户接口:　　消息：203（SIM卡ICCID上报）
开发板 -> 用户接口:　　消息：204（SIM卡已就绪）
@enduml
```


　
######（5）推送消息：501、502、603、998、999
当SIM已就绪之后，开发板在正常运行的过程中，如开发板收到新短信等事件时，会主动向您的接口推送消息。
- 501消息表示开发板收到了新短信。
- 502消息表示开发板外发短信成功。
- 603消息表示开发板收到新来电。
- 998消息表示开发板主动推送的周期PING消息，报告网络链接正常。
- 999消息表示开发板对执行**控制消息**的结果反馈。
**接口返回**：无

```plantuml
@startuml
开发板 -> 用户接口:　　消息：501、503、603、998、999　　
@enduml
```

　
######（6）推送消息：205
当SIM已就绪之后，开发板在正常运行的过程中，用户主动取出了卡槽中的SIM卡时，开发板向接口报告205消息。
**接口返回**：无
```plantuml
@startuml
开发板 -> 用户接口:　　消息：205（SIM卡已被取出）
@enduml
```
　
######（7）开发中的注意事项
您的接口并不需要对每一种消息，都进行接收。实际上，您只需要接收您关心的消息就可以了。您的接口处理的消息**越少越好**。举例：如果您只关心接收短信的话，您只需要接收501一种消息就可以了。

---


### 其它消息

<a name="998-设备ping消息"></a>

#### 998 - 设备PING消息


######“消息：998 - 设备PING消息” 使用说明

######消息的作用
开发板正确连入WIFI之后，根据用户在WEB管理页面的设置，开发板可以在规定的时间（默认为110秒），循环向您的接口推送998消息。998推送消息一般有两个用途：
1、您的接口可以基于此判断开发板是否处于正常的开机状态。
2、在TCP Server的方式下，维持网络连接，避免因长时间无通信导致TCP连接中断。实际上，在TCP Server的方式下，998消息总是会被定时的推送到您的接口上。

>【提示】:
　　一般而言，接口端如果需要判断开发板是否“在线”，主要有两种方式：
　　1）假设开发板每60秒向接口上报一次PING消息，一般来说，接口端如果连续3次（相当于60秒*3+15秒缓冲时间=195秒），都没有按时收到开发板上报的PING消息，就可以判定开发板已经“离线”了。
　　这种判断方法，以接口端“被动”接收PING消息，来判断开发板是否“在线”。
　　2）TCP接口模式中，接口也可以“主动”向开发板发送 stat 请求`{"cmd":"stat", "tid":123}`，开发板在收到接口的请求后，会主动上报开发板的状态信息。这样，也可以判断开发板是否“在线”。
　　当然，也可以将方法（1）、方法（2）组合起来，更有效的判断开发板是否“在线”。

－
######消息参数说明
 | 参数名  | 参数值（示例）  |参数类型|说明|
| ------------ |:------------ |-----|--|
|devId |498060912345 |字符型|开发板唯一ID|
|type |998|数值型|消息ID|
|netCh  | 0 |数值型|本消息由开发板的哪个网络通道推送。0:WIFI; 1:SIM1; 2:SIM2|
|cnt |1|数值型|PING消息中的自增字段，每上报一次数值自动加 1。|
　
######消息内容（FORM)
FORM格式时，开发板自动模拟的HTML表单提交，将数据推送到您的接口。
模拟样式如下：
```
<form>
	<input name="devId" value="498060912345">
	<input name="type" value="998">
	<input name="netCh" value="0">
	<input name="cnt" value="1">
</form>
```
　
######消息内容（JSON)
JSON格式时，开发板向您的接口推送的JSON样式如下：
 ``` 
 {
  "devId": "498060912345",
  "type": 998,
  "netCh": 0,
  "cnt": 1
} 

 ```

---


### 短信消息

<a name="501-新短信消息"></a>

#### 501 - 新短信消息


######“消息：501 - 新短信报告消息” 使用说明

######消息的作用
当SIM卡已经完成初始化，处于就绪状态之后，如果SIM卡收到了新短信，则开发板会向您的接口推送501消息。
－
######消息参数说明
 | 参数名  | 参数值（示例）  |参数类型|说明|
| ------------ |:------------ |-----|:--|
|devId |498060912345 |字符型|开发板唯一ID|
|type |501|数值型|消息ID|
|slot  | 1 |字符型|卡槽号。1表示卡槽1；2表示卡槽2|
|imsi  | 46007337111234 |字符型|SIM卡的IMSI|
|iccId  | 898607D3161990212345 |字符型|SIM卡的ICCID|
|msIsdn  | +8613206411822 |字符型|SIM卡的电话号码（*需发卡时运营商已预存）|
|phNum | 10086  |字符型|短信号码|
|smsBd | 您的话费余额是100元。【中国移动】  |字符型|短信内容|
|charset | utf8  |字符型|phNum、smsBd字段的编码方式。**（*注1）**|
|smsTm | 1647344840456  |timestamp|短信时间戳（13位，精确到毫秒）|
|netCh  | 0 |数值型|本消息由开发板的哪个网络通道推送。0:WIFI; 1:SIM1; 2:SIM2|
**注1：**phNum、smsBd两个字段目前的编码方式是：utf8。charset字段目前也是固定值：utf8。

-
######消息内容（FORM)
FORM格式时，开发板自动模拟的HTML表单提交，将数据推送到您的接口。
模拟样式如下：
```
<form>
	<input name="devId" value="498060912345">
	<input name="type" value="501">
	<input name="slot" value="1">
	<input name="imsi" value="46007337111234">
	<input name="iccId" value="898607D3161990212345">
	<input name="msIsdn" value="+8613206411822">
	<input name="phNum" value="10086">
	<input name="smsBd" value="您的话费余额是100元。【中国移动】">
	<input name="charset" value="utf8">
	<input name="smsTm" value="1647344840456">
	<input name="netCh" value="0">
</form>
```
　
######消息内容（JSON)
JSON格式时，开发板向您的接口推送的JSON样式如下：

 ``` 
 {
  "devId": "498060912345",
  "type": 501,
  "slot": 1,
  "imsi": "46007337111234",
  "iccId": "898607D3161990212345",
  "msIsdn": "+8613206411822",
  "phNum": "10086",
  "smsBd": "您的话费余额是100元。【中国移动】",
  "charset":"utf8",
  "smsTm": 1647344840456,
  "netCh": 0
} 
```
　
######补充说明
如果您使用的是TCP接口时，使用**网络调试助手**工具进行调试时，建议将工具设置为UTF8模式，否则开发板上报的中文短信会显示为乱码字符。
设置方法为：点击**网络调试助手**右侧的**数据日志**文本框，点击鼠标右键，在弹出的菜单中设置即可。
![](http://www.lvyatech.com/img/lu/netass2.png)

---

<a name="502-外发短信成功消息"></a>

#### 502 - 外发短信成功消息


######“消息：502 - 外发短信成功消息” 使用说明

######消息的作用
当开发板接收到您的**sendsms控制指令**后，会根据您的指令，控制SIM卡向外发送短信。如果SIM卡成功发送了短信，则会向您的接口推送502消息。
－
######消息参数说明
 | 参数名  | 参数值（示例）  |参数类型|说明|
| ------------ |:------------ |-----|:--|
|devId |498060912345 |字符型|开发板唯一ID|
|type |502|数值型|消息ID|
|slot  | 1 |字符型|卡槽号。1表示卡槽1；2表示卡槽2|
|tid | 1647344840  |字符型|sendsms控制消息中给出的tid，此处原样回送|
|netCh  | 0 |数值型|本消息由开发板的哪个网络通道推送。0:WIFI; 1:SIM1; 2:SIM2|
 **对tid参数的进一步说明：** tid参数是在**控制指令**中，由您的接口主动提供的一个参数，这个参数可以是任意的值。这个参数的目的是，用于对应您之前的发出的**控制指令**。比如，您之前控制指令是：
```
http://192.168.7.170/ctrl?cmd=sendsms&tid=1647344840&slot=2&p1=10001&p2=查话费
```
（注意：为了便于理解，上述是简化了的控制指令。关于指令的细节以控制指令一节的文档为准。）

根据上述**控制指令**，开发板会控制卡槽2中的SIM卡，给号码为10001发短信，内容为：查话费。
当本条短信外发成功之后，开发板会向接口推送502指令。在502指令中，会将tid=1647344840的参数内容**原样送回**，用于通知您的接口，具体是哪一条短信，外发已经完成了。

由于外发短信是“异步”操作，如果您同时向开发板发送了多条“**sendsms控制指令**”时，接口获得的502消息无法保证前后顺序的一致性。所以，您需要为每一条“**sendsms控制指令**”都赋予一个唯一的tid参数，用于区分具体是哪一条外发短信已经成功完成了。
 －
######消息内容（FORM)
FORM格式时，开发板自动模拟的HTML表单提交，将数据推送到您的接口。
模拟样式如下：
```
<form>
	<input name="devId" value="498060912345">
	<input name="type" value="502">
	<input name="slot" value="1">
	<input name="tid" value="1647344840">
	<input name="netCh" value="0">
</form>
```
　
######消息内容（JSON)
JSON格式时，开发板向您的接口推送的JSON样式如下：

 ``` 
 {
  "devId": "498060912345",
  "type": 502,
  "slot": 1,
  "tid": "1647344840",
  "netCh": 0
} 

 ```

---


### 设备状态消息

<a name="100-wifi已联网"></a>

#### 100 - WIFI已联网


######“消息：100 - WIFI已联网” 使用说明

######消息的作用
100消息，是开发板向接口推送的第1个消息。表示开发板已经正确连入了WIFI网络。
－
######消息参数说明
 | 参数名  | 参数值（示例）  |参数类型|说明|
| ------------ |:------------ |-----|--|
|devId |498060912345 |字符型|开发板唯一ID|
|type |100|数值型|消息ID|
|hwVer |107|字符型|开发板版本号|
|netCh  | 0 |数值型|本消息由开发板的哪个网络通道推送。0:WIFI; 1:SIM1; 2:SIM2|
|msgTs  | 1750044391 |数值型| 当前消息的时间戳|
|ssid |mywifi |字符型|开发板连入的WIFI名|
|charset |mywifi |字符型（*注1）|WIFI名的编码方式|
|ip  | 192.168.7.170 |字符型|开发板当前IP地址|
|dbm | utf8  |数值型|ssid的信号强度（越高越好）|

**注1**：ssid字段的默认编码，目前是固定值：utf8
　
######消息内容（FORM)
FORM格式时，开发板自动模拟的HTML表单提交，将数据推送到您的接口。
模拟样式如下：
```
<form>
	<input name="devId" value="498060912345">
	<input name="type" value="100">
	<input name="hwVer" value="X31v107">
	<input name="netCh" value="0">
	<input name="msgTs" value="1750044391">
	<input name="ssid" value="mywifi">
	<input name="charset" value="utf8">
	<input name="ip" value="192.168.7.170">
	<input name="dbm" value="61">
</form>
```
　
######消息内容（JSON)
JSON格式时，开发板向您的接口推送的JSON样式如下：
 ``` 
{
  "devId": "498060912345",
  "type": 100,
  "hwVer": "X31v107",
  "netCh": 0,
  "msgTs": 1750044391,
  "ssid": "mywifi",
  "charset": "utf8",
  "ip": "192.168.7.170",
  "dbm": 61
} 
```
　
 ####请注意：
- 如果您的接口是HTTP方式，开发板向您的接口推送100消息时，您的HTTP接口可以不返回数据。但是，接口的WEB服务器返回HTTP CODE值必须为200，否则，开发板会自动尝试连接其它WIFI热点（如有），并重新推送100消息，直到HTTP CODE能够返回200。
- 如果您的接口是TCP方式，开发板向您的接口推送100消息时，您的接口 **必须** 返回以下格式的应答：
```json
{"cmd":"now", "p1":"20220330184700", "tid":"1234"}\x11\x12
```
即，返回14位当前时间做为应答。此应答必须在5秒内完成，否则将视为TCP链接建立失败。正常情况下，您的接口给出上述应答之后，开发板将再次回复一个“应答已收到”的消息给您的接口，格式如下：
```json
{"code":0, "type":999, "netCh":0, "tid":"1234"}\x11\x12
```
至此，开发板与您的接口之间TCP网络建立成功。

- 如果您的开发板连入的WIFI热点可以正常访问Internet，您的TCP接口在接收到100消息时也可以不返回具体的时间戳，而是让开发板自身通过全球公共NTP服务自主校准时间。这种情况下，您的接口收到开发板上报的100消息时，可以按以下格式进行应答：
```json
{"cmd":"now", "p2":15, "p3":8}
```
此处，P2=15 表示允许开发板自身通过各种可能的途径进行时间校准；p3=8表示校准后的时区是+8（北京时间）。

---

<a name="101-sim1已联网"></a>

#### 101 - SIM1已联网


######“消息：101 - SIM1已联网” 使用说明

######消息的作用
101消息，是开发板向接口推送的第1个消息。表示开发板中的SIM1（卡槽1）已经正确连入了网络。
－
######消息参数说明
 | 参数名  | 参数值（示例）  |参数类型|说明|
| ------------ |:------------ |-----|--|
|devId |498060912345 |字符型|开发板唯一ID|
|type |101|数值型|消息ID|
|netCh  | 1 |数值型|本消息由开发板的哪个网络通道推送。0:WIFI; 1:SIM1; 2:SIM2|
|msgTs |1750044391|数值型|当前消息的推送时间戳|
|slot |1 |数值型|开发板的卡槽1|
|dbm | 61  |数值型|SIM卡1的信号强度|
|imsi  | 46007337111234 |字符型|SIM卡的IMSI|
|iccId  | 898607D3161990212345 |字符型|SIM卡的ICCID|
|msIsdn  | +8613206411822 |字符型|SIM卡的电话号码（*需发卡时运营商已预存）|

　
######消息内容（FORM)
FORM格式时，开发板自动模拟的HTML表单提交，将数据推送到您的接口。
模拟样式如下：
```
<form>
	<input name="devId" value="498060912345">
	<input name="type" value="101">
	<input name="netCh" value="1">
	<input name="msgTs" value="1750044391">
	<input name="slot" value="1">
	<input name="dbm" value="61">
	<input name="imsi" value="46007337111234">
	<input name="iccId" value="898607D3161990212345">
	<input name="msIsdn" value="+8613206411822">
</form>
```
　
######消息内容（JSON)
JSON格式时，开发板向您的接口推送的JSON样式如下：
 ``` 
{
  "devId": "498060912345",
  "type": 101,
  "netCh": 1,
  "msgTs": 1750044391,
  "slot": 1,
  "dbm": 61,
  "imsi": "46007337111234",
  "iccId": "898607D3161990212345",
  "msIsdn": "+8613206411822"
} 
```
　
 ####请注意：
- 如果您的接口是HTTP方式，开发板向您的接口推送101消息时，您的HTTP接口可以不返回数据。但是，接口的WEB服务器返回HTTP CODE值必须为200，否则，开发板会自动尝试连接其它WIFI热点（如有），并重新推送101消息，直到HTTP CODE能够返回200。
- 如果您的接口是TCP方式，开发板向您的接口推送101消息时，您的接口 **必须** 返回以下格式的应答：
```
{"cmd":"now", "p1":"20220330184700", "tid":"1234"}\x11\x12
```
即，返回14位当前时间做为应答。此应答必须在5秒内完成，否则将视为TCP链接建立失败。正常情况下，您的接口给出上述应答之后，开发板将再次回复一个“应答已收到”的消息给您的接口，格式如下：
```
{"code":0, "type":999, "netCh":1, "tid":"1234"}\x11\x12
```
至此，开发板与您的接口之间TCP网络建立成功。

- 如果您的开发板连入的WIFI热点可以正常访问Internet，您的TCP接口在接收到101消息时也可以不返回具体的时间戳，而是让开发板自身通过全球公共NTP服务自主校准时间。这种情况下，您的接口收到开发板上报的101消息时，可以按以下格式进行应答：
```json
{"cmd":"now", "p2":15, "p3":8}
```
此处，P2=15 表示允许开发板自身通过各种可能的途径进行时间校准；p3=8表示校准后的时区是+8（北京时间）。

---

<a name="102-sim2已联网"></a>

#### 102 - SIM2已联网


######“消息：102 - SIM2已联网” 使用说明

######消息的作用
102消息，是开发板向接口推送的第1个消息。表示开发板中的SIM2（卡槽2）已经正确连入了网络。
－
######消息参数说明
 | 参数名  | 参数值（示例）  |参数类型|说明|
| ------------ |:------------ |-----|--|
|devId |498060912345 |字符型|开发板唯一ID|
|type |101|数值型|消息ID|
|netCh  | 2 |数值型|本消息由开发板的哪个网络通道推送。0:WIFI; 1:SIM1; 2:SIM2|
|msgTs |1750044391|数值型|当前消息的推送时间戳|
|slot |2 |数值型|开发板的卡槽1|
|dbm | 61  |数值型|SIM卡1的信号强度|
|imsi  | 46007337111234 |字符型|SIM卡的IMSI|
|iccId  | 898607D3161990212345 |字符型|SIM卡的ICCID|
|msIsdn  | +8613206411822 |字符型|SIM卡的电话号码（*需发卡时运营商已预存）|

　
######消息内容（FORM)
FORM格式时，开发板自动模拟的HTML表单提交，将数据推送到您的接口。
模拟样式如下：
```
<form>
	<input name="devId" value="498060912345">
	<input name="type" value="102">
	<input name="netCh" value="2">
	<input name="msgTs" value="1750044391">
	<input name="slot" value="2">
	<input name="dbm" value="61">
	<input name="imsi" value="46007337111234">
	<input name="iccId" value="898607D3161990212345">
	<input name="msIsdn" value="+8613206411822">
</form>
```
　
######消息内容（JSON)
JSON格式时，开发板向您的接口推送的JSON样式如下：
 ``` 
{
  "devId": "498060912345",
  "type": 102,
  "netCh": 2,
  "msgTs": 1750044391,
  "slot": 2,
  "dbm": 61,
  "imsi": "46007337111234",
  "iccId": "898607D3161990212345",
  "msIsdn": "+8613206411822"
} 
```
　
 ####请注意：
- 如果您的接口是HTTP方式，开发板向您的接口推送102消息时，您的HTTP接口可以不返回数据。但是，接口的WEB服务器返回HTTP CODE值必须为200，否则，开发板会自动尝试连接其它WIFI热点（如有），并重新推送102消息，直到HTTP CODE能够返回200。
- 如果您的接口是TCP方式，开发板向您的接口推送101消息时，您的接口 **必须** 返回以下格式的应答：
```
{"cmd":"now", "p1":"20220330184700", "tid":"1234"}\x11\x12
```
即，返回14位当前时间做为应答。此应答必须在5秒内完成，否则将视为TCP链接建立失败。正常情况下，您的接口给出上述应答之后，开发板将再次回复一个“应答已收到”的消息给您的接口，格式如下：
```
{"code":0, "type":999, "netCh":2, "tid":"1234"}\x11\x12
```
至此，开发板与您的接口之间TCP网络建立成功。

- 如果您的开发板连入的WIFI热点可以正常访问Internet，您的TCP接口在接收到102消息时也可以不返回具体的时间戳，而是让开发板自身通过全球公共NTP服务自主校准时间。这种情况下，您的接口收到开发板上报的102消息时，可以按以下格式进行应答：
```json
{"cmd":"now", "p2":15, "p3":8}
```
此处，P2=15 表示允许开发板自身通过各种可能的途径进行时间校准；p3=8表示校准后的时区是+8（北京时间）。

---

<a name="202-sim卡基站注册"></a>

#### 202 - SIM卡基站注册


######“消息：202 - SIM卡准备基站注册” 使用说明

######消息的作用
开发板上对应的卡槽正确的插入了SIM时，开发板会尝试对SIM卡进行初始化，并在初始化处理开始时，先向您的接口推送本消息。
－
######消息参数说明
 | 参数名  | 参数值（示例）  |参数类型|说明|
| ------------ |:------------ |-----|--|
|devId |498060912345 |字符型|开发板唯一ID|
|type |202|数值型|消息ID|
|slot  | 1 |字符型|卡槽号。1表示卡槽1；2表示卡槽2|
|netCh  | 0 |数值型|本消息由开发板的哪个网络通道推送。0:WIFI; 1:SIM1; 2:SIM2|
　
######消息内容（FORM)
FORM格式时，开发板自动模拟的HTML表单提交，将数据推送到您的接口。
模拟样式如下：
```
<form>
	<input name="devId" value="498060912345">
	<input name="type" value="202">
	<input name="slot" value="1">
	<input name="netCh" value="0">
</form>
```
　
######消息内容（JSON)
JSON格式时，开发板向您的接口推送的JSON样式如下：
 ``` 
 {
  "devId": "498060912345",
  "type": 202,
  "slot": 1,
  "netCh": 0
} 

 ```

---

<a name="203-sim卡imsi上报"></a>

#### 203 - SIM卡IMSI上报


######“消息：203 - SIM卡IMSI上报” 使用说明

######消息的作用
开发板对SIM卡进行初始化的过程中，会尝试读取SIM卡的IMSI。如果IMSI取读成功，则通过203消息向您的接口推送。

**说明**：
- 每一张SIM卡，都有一个全球唯一的IMSI，补换卡后IMSI也不会变化。SIM卡的IMSI可以理解为是手机号的另一种表示形式。您可以通过IMSI来唯一标识一张SIM卡。

- 每一张SIMI卡，都有一个全球唯的ICCID，但补换卡后ICCID会变化。ICCID通常也会印刷在SIM卡的背面。

－
######消息参数说明
 | 参数名  | 参数值（示例）  |参数类型|说明|
| ------------ |:------------ |-----|:--|
|devId |498060912345 |字符型|开发板唯一ID|
|type |203|数值型|消息ID|
|slot  | 1 |字符型|卡槽号。1表示卡槽1；2表示卡槽2|
|imsi  | 46007337111234 |字符型|SIM卡的IMSI|
|iccId  | 898607D3161990212345 |字符型|SIM卡的ICCID|
|msIsdn  | +8613206411822 |字符型|SIM卡的电话号码（*需发卡时运营商已预存）|
|dbm | 61  |数值型|当前SIM卡的信号强度。-1表示尚未取得信号强度数据|
|netCh  | 0 |数值型|本消息由开发板的哪个网络通道推送。0:WIFI; 1:SIM1; 2:SIM2|
　
######消息内容（FORM)
FORM格式时，开发板自动模拟的HTML表单提交，将数据推送到您的接口。
模拟样式如下：
```
<form>
	<input name="devId" value="498060912345">
	<input name="type" value="203">
	<input name="slot" value="1">
	<input name="imsi" value="46007337111234">
	<input name="iccId" value="898607D3161990212345">
	<input name="msIsdn" value="+8613206411822">
	<input name="dbm" value="61">
	<input name="netCh" value="0">
</form>
```
　
######消息内容（JSON)
JSON格式时，开发板向您的接口推送的JSON样式如下：
 ``` 
 {
  "devId": "498060912345",
  "type": 203,
  "slot": 1,
  "imsi": "46007337111234",
  "iccId": "898607D3161990212345",
  "msIsdn": "+8613206411822",
  "dbm": 61,
  "netCh": 0
} 
 ```

---

<a name="204-sim卡已就绪"></a>

#### 204 - SIM卡已就绪


######“消息：204 - SIM卡已就绪” 使用说明

######消息的作用
开发板完成了SIM卡的全部初始化处理之后，会向您的接口推送204消息。此消息表示SIM卡已经处于正常待机状态，此时SIM卡已经可以正常的进行收发短信、接打电话等操作。

一般情况下，可以忽略203消息，只读取204消息即可。
－
######消息参数说明
 | 参数名  | 参数值（示例）  |参数类型|说明|
| ------------ |:------------ |-----|:--|
|devId |498060912345 |字符型|开发板唯一ID|
|type |204|数值型|消息ID|
|slot  | 1 |字符型|卡槽号。1表示卡槽1；2表示卡槽2|
|imsi  | 46007337111234 |字符型|SIM卡的IMSI|
|iccId  | 898607D3161990212345 |字符型|SIM卡的ICCID|
|msIsdn  | +8613206411822 |字符型|SIM卡的电话号码（*需发卡时运营商已预存）|
|dbm | 61  |数值型|当前SIM卡的信号强度。-1表示尚未取得信号强度数据|
|netCh  | 0 |数值型|本消息由开发板的哪个网络通道推送。0:WIFI; 1:SIM1; 2:SIM2|
　
######消息内容（FORM)
FORM格式时，开发板自动模拟的HTML表单提交，将数据推送到您的接口。
模拟样式如下：
```
<form>
	<input name="devId" value="498060912345">
	<input name="type" value="204">
	<input name="slot" value="1">
	<input name="imsi" value="46007337111234">
	<input name="iccId" value="898607D3161990212345">
	<input name="msIsdn" value="+8613206411822">
	<input name="dbm" value="61">
	<input name="netCh" value="0">
</form>
```
　
######消息内容（JSON)
JSON格式时，开发板向您的接口推送的JSON样式如下：
 ``` 
 {
  "devId": "498060912345",
  "type": 204,
  "slot": 1,
  "imsi": "46007337111234",
  "iccId": "898607D3161990212345",
  "msIsdn": "+8613206411822",
  "dbm": 61,
  "netCh": 0
} 
 ```

---

<a name="205-sim卡已弹出"></a>

#### 205 - SIM卡已弹出


######“消息：205 - SIM卡已被弹出” 使用说明

######消息的作用
当SIM卡进入了就绪状态之后，如果用户主动取出了SIM卡，此时开发板会向您的接口推送205消息。
－
######消息参数说明
 | 参数名  | 参数值（示例）  |参数类型|说明|
| ------------ |:------------ |-----|--|
|devId |498060912345 |字符型|开发板唯一ID|
|type |205|数值型|消息ID|
|slot  | 1 |字符型|卡槽号。1表示卡槽1；2表示卡槽2|
|netCh  | 0 |数值型|本消息由开发板的哪个网络通道推送。0:WIFI; 1:SIM1; 2:SIM2|
　
######消息内容（FORM)
FORM格式时，开发板自动模拟的HTML表单提交，将数据推送到您的接口。
模拟样式如下：
```
<form>
	<input name="devId" value="498060912345">
	<input name="type" value="205">
	<input name="slot" value="1">
	<input name="netCh" value="0">
</form>
```
　
######消息内容（JSON)
JSON格式时，开发板向您的接口推送的JSON样式如下：
 ``` 
 {
  "devId": "498060912345",
  "type": 205,
  "slot": 1,
  "netCh": 0
} 

 ```

---

<a name="209-sim卡错误"></a>

#### 209 - SIM卡错误


######“消息：209 - SIM卡错误” 使用说明

######消息的作用
当SIM卡在初始化过程中发现了异常，开发板会向您的接口推送209消息。通常，产生209消息一般有以下几种原因：
- SIM卡 已损坏 或 未插好
- SIM卡欠费停机
- SIM卡有PUK开机密码
- 在4G单频全网通通讯模组中，插入了2G单频SIM卡（如长城移动、五三互联等虚商的SIM卡。此种卡的特点是不能上网，这类卡都通常是2G单频卡。针对这类卡，通常建议搭配2G通讯模组使用）。

######消息参数说明
 | 参数名  | 参数值（示例）  |参数类型|说明|
| ------------ |:------------ |-----|--|
|devId |498060912345 |字符型|开发板唯一ID|
|type |209|数值型|消息ID|
|slot  | 1 |字符型|卡槽号。1表示卡槽1；2表示卡槽2|
|netCh  | 0 |数值型|本消息由开发板的哪个网络通道推送。0:WIFI; 1:SIM1; 2:SIM2|
　
######消息内容（FORM)
FORM格式时，开发板自动模拟的HTML表单提交，将数据推送到您的接口。
模拟样式如下：
```
<form>
	<input name="devId" value="498060912345">
	<input name="type" value="209">
	<input name="slot" value="1">
	<input name="netCh" value="0">
</form>
```
　
######消息内容（JSON)
JSON格式时，开发板向您的接口推送的JSON样式如下：
 ``` 
 {
  "devId": "498060912345",
  "type": 209,
  "slot": 1,
  "netCh": 0
} 

 ```

---

<a name="301-通信模组异常"></a>

#### 301 - 通信模组异常


######“消息：301 - 通信模组异常” 使用说明

######消息的作用
当开发板在尝试侦测板载的通信模组时失败，开发板会向您的接口推送301消息。通常，产生301消息，一般有以下几种原因：
- 板载的通信模组已损坏
- 板载的通信模组尚未被支持
-

######消息参数说明
 | 参数名  | 参数值（示例）  |参数类型|说明|
| ------------ |:------------ |-----|--|
|devId |498060912345 |字符型|开发板唯一ID|
|type |301|数值型|消息ID|
|slot  | 1 |字符型|卡槽号。1表示卡槽1；2表示卡槽2|
|netCh  | 0 |数值型|本消息由开发板的哪个网络通道推送。0:WIFI; 1:SIM1; 2:SIM2|
　
######消息内容（FORM)
FORM格式时，开发板自动模拟的HTML表单提交，将数据推送到您的接口。
模拟样式如下：
```
<form>
	<input name="devId" value="498060912345">
	<input name="type" value="301">
	<input name="slot" value="1">
	<input name="netCh" value="0">
</form>
```
　
######消息内容（JSON)
JSON格式时，开发板向您的接口推送的JSON样式如下：
 ``` 
 {
  "devId": "498060912345",
  "type": 301,
  "slot": 1,
  "netCh": 0
} 

 ```

---


### 通话消息

<a name="601-来电振铃消息"></a>

#### 601 - 来电振铃消息


######“消息：601 - 来电振铃消息” 使用说明

######消息的作用
当SIM卡已经完成初始化，并处于就绪状态之后，此时如果SIM卡收到了来电，开发板会向您的接口推送601来电振铃消息。
我们以手机接到来电为例：601消息相当于，您的手机收到了来电，此时，您即没有接听，也没有挂断，手机正在响铃的状态。
－
######消息参数说明
 | 参数名  | 参数值（示例）  |参数类型|说明|
| ------------ |:------------ |-----|:--|
|devId |498060912345 |字符型|开发板唯一ID|
|type |601|数值型|消息ID|
|slot  | 1 |字符型|卡槽号。1表示卡槽1；2表示卡槽2|
|imsi  | 46007337111234 |字符型|SIM卡的IMSI|
|iccId  | 898607D3161990212345 |字符型|SIM卡的ICCID|
|msIsdn  | +8613206411822 |字符型|SIM卡的电话号码（*需发卡时运营商已预存）|
|phNum | 10086  |字符型|来电号码|
|startTm | 1647344540   |timestamp|来电起始时间戳|
|netCh  | 0 |数值型|本消息由开发板的哪个网络通道推送。0:WIFI; 1:SIM1; 2:SIM2|
　
######消息内容（FORM)
FORM格式时，开发板自动模拟的HTML表单提交，将数据推送到您的接口。
模拟样式如下：
```
<form>
	<input name="devId" value="498060912345">
	<input name="type" value="601">
	<input name="slot" value="1">
	<input name="imsi" value="46007337111234">
	<input name="iccId" value="898607D3161990212345">
	<input name="msIsdn" value="+8613206411822">
	<input name="phNum" value="10086">
	<input name="startTm" value="1647344540">
	<input name="netCh" value="0">
</form>
```
　
######消息内容（JSON)
JSON格式时，开发板向您的接口推送的JSON样式如下：

 ``` 
 {
  "devId": "498060912345",
  "type": 601,
  "slot": 1,
  "imsi": "46007337111234",
  "iccId": "898607D3161990212345",
  "msIsdn": "+8613206411822",
  "phNum": "10086",
  "startTm": 1647344540,
  "netCh": 0
} 

 ```

---

<a name="602-来电接通消息"></a>

#### 602 - 来电接通消息


######“消息：602 - 来电接通消息” 使用说明

######消息的作用
当开发板上的SIM卡收到了来电，此时可以通过控制指令“telanswer”遥控开发板的SIM卡接听来电。来电接通之后，开发板会向您的接口推送602来电接通消息。
我们以手机接到来电为例：602消息相当于，您的手机收到了来电，您点击了接听按键，通话处于被接通了的状态。
－
######消息参数说明
 | 参数名  | 参数值（示例）  |参数类型|说明|
| ------------ |:------------ |-----|:--|
|devId |498060912345 |字符型|开发板唯一ID|
|type |602|数值型|消息ID|
|slot  | 1 |字符型|卡槽号。1表示卡槽1；2表示卡槽2|
|imsi  | 46007337111234 |字符型|SIM卡的IMSI|
|iccId  | 898607D3161990212345 |字符型|SIM卡的ICCID|
|msIsdn  | +8613206411822 |字符型|SIM卡的电话号码（*需发卡时运营商已预存）|
|phNum | 10086  |字符型|来电号码|
|startTm | 1647344540   |timestamp|来电起始时间戳|
|netCh  | 0 |数值型|本消息由开发板的哪个网络通道推送。0:WIFI; 1:SIM1; 2:SIM2|
　
######消息内容（FORM)
FORM格式时，开发板自动模拟的HTML表单提交，将数据推送到您的接口。
模拟样式如下：
```
<form>
	<input name="devId" value="498060912345">
	<input name="type" value="603">
	<input name="slot" value="1">
	<input name="imsi" value="46007337111234">
	<input name="iccId" value="898607D3161990212345">
	<input name="msIsdn" value="+8613206411822">
	<input name="phNum" value="10086">
	<input name="startTm" value="1647344540">
	<input name="netCh" value="0">
</form>
```
　
######消息内容（JSON)
JSON格式时，开发板向您的接口推送的JSON样式如下：

 ``` 
 {
  "devId": "498060912345",
  "type": 603,
  "slot": 1,
  "imsi": "46007337111234",
  "iccId": "898607D3161990212345",
  "msIsdn": "+8613206411822",
  "phNum": "10086",
  "startTm": 1647344540,
  "netCh": 0
} 

 ```

---

<a name="603-来电挂断消息"></a>

#### 603 - 来电挂断消息


######“消息：603 - 来电挂断消息” 使用说明

######消息的作用
开发板正在处于通话状态中，此时如果对方挂机，或者是向开发板发送telhangup控制指令主动挂机之后，开发板会向您的接口推送603来电挂断消息。
－
######消息参数说明
 | 参数名  | 参数值（示例）  |参数类型|说明|
| ------------ |:------------ |-----|:--|
|devId |498060912345 |字符型|开发板唯一ID|
|type |603|数值型|消息ID|
|slot  | 1 |字符型|卡槽号。1表示卡槽1；2表示卡槽2|
|imsi  | 46007337111234 |字符型|SIM卡的IMSI|
|iccId  | 898607D3161990212345 |字符型|SIM卡的ICCID|
|msIsdn  | +8613206411822 |字符型|SIM卡的电话号码（*需发卡时运营商已预存）|
|phNum | 10086  |字符型|来电号码|
|startTm | 1647344540   |timestamp|来电起始时间戳|
|endTm | 1647344840  |timestamp|来电结束时间戳。|
|netCh  | 0 |数值型|本消息由开发板的哪个网络通道推送。0:WIFI; 1:SIM1; 2:SIM2|
　
######消息内容（FORM)
FORM格式时，开发板自动模拟的HTML表单提交，将数据推送到您的接口。
模拟样式如下：
```
<form>
	<input name="devId" value="498060912345">
	<input name="type" value="603">
	<input name="slot" value="1">
	<input name="imsi" value="46007337111234">
	<input name="iccId" value="898607D3161990212345">
	<input name="msIsdn" value="+8613206411822">
	<input name="phNum" value="10086">
	<input name="startTm" value="1647344540">
	<input name="endTm" value="1647344840">
	<input name="netCh" value="0">
</form>
```
　
######消息内容（JSON)
JSON格式时，开发板向您的接口推送的JSON样式如下：

 ``` 
 {
  "devId": "498060912345",
  "type": 603,
  "slot": 1,
  "imsi": "46007337111234",
  "iccId": "898607D3161990212345",
  "msIsdn": "+8613206411822",
  "phNum": "10086",
  "startTm": 1647344540,
  "endTm": 1647344840,
  "netCh": 0
} 

 ```

---

<a name="620-去电拨号消息"></a>

#### 620 - 去电拨号消息


######“消息：620 - 去电拨号消息” 使用说明

######消息的作用
当SIM卡已经完成初始化，并处于就绪状态之后，此时您通过控制指令“teledial”遥控开发板的某个卡槽，向指定号码拨打电话时，开发板会首先检测电话卡是否有正常的拨号音，如果检测到拨号音，开发板会自动进行电话拨号，拨号成功后向您的接口推送620去电拨号消息。
我们以手机向外拨打电话为例：您在手机上输入了拨打的电话号码，并点击了“拨号按键”，电话执行拨号动作，并确认拨号成功之后，您的接口就会收到620消息。
－
######消息参数说明
 | 参数名  | 参数值（示例）  |参数类型|说明|
| ------------ |:------------ |-----|:--|
|devId |498060912345 |字符型|开发板唯一ID|
|type |620|数值型|消息ID|
|slot  | 1 |字符型|卡槽号。1表示卡槽1；2表示卡槽2|
|imsi  | 46007337111234 |字符型|SIM卡的IMSI|
|iccId  | 898607D3161990212345 |字符型|SIM卡的ICCID|
|msIsdn  | +8613206411822 |字符型|SIM卡的电话号码（*需发卡时运营商已预存）|
|phNum | 10086  |字符型|来电号码|
|startTm | 1647344540   |timestamp|来电起始时间戳|
|netCh  | 0 |数值型|本消息由开发板的哪个网络通道推送。0:WIFI; 1:SIM1; 2:SIM2|
　
######消息内容（FORM)
FORM格式时，开发板自动模拟的HTML表单提交，将数据推送到您的接口。
模拟样式如下：
```
<form>
	<input name="devId" value="498060912345">
	<input name="type" value="620">
	<input name="slot" value="1">
	<input name="imsi" value="46007337111234">
	<input name="iccId" value="898607D3161990212345">
	<input name="msIsdn" value="+8613206411822">
	<input name="phNum" value="10086">
	<input name="startTm" value="1647344540">
	<input name="netCh" value="0">
</form>
```
　
######消息内容（JSON)
JSON格式时，开发板向您的接口推送的JSON样式如下：

 ``` 
 {
  "devId": "498060912345",
  "type": 620,
  "slot": 1,
  "imsi": "46007337111234",
  "iccId": "898607D3161990212345",
  "msIsdn": "+8613206411822",
  "phNum": "10086",
  "startTm": 1647344540,
  "netCh": 0
} 

 ```

---

<a name="621-去电振铃消息"></a>

#### 621 - 去电振铃消息


######“消息：621 - 去电振铃消息” 使用说明

######消息的作用
您通过控制指令“teledial”向指定号码拨打电话时，开发板会首先进行电话拨号，拨号成功后，对方电话会响铃，提醒对方接听。对方电话正在响铃中的时刻，开发板会向您的接口推送621去电振铃消息。
我们以手机向外拨打电话为例：您在手机上拨打对方电话之后，对方电话一旦开始响铃，您的接口就会收到621消息。
－
######消息参数说明
| 参数名  | 参数值（示例）  |参数类型|说明|
| ------------ |:------------ |-----|:--|
|devId |498060912345 |字符型|开发板唯一ID|
|type |621|数值型|消息ID|
|slot  | 1 |字符型|卡槽号。1表示卡槽1；2表示卡槽2|
|imsi  | 46007337111234 |字符型|SIM卡的IMSI|
|iccId  | 898607D3161990212345 |字符型|SIM卡的ICCID|
|msIsdn  | +8613206411822 |字符型|SIM卡的电话号码（*需发卡时运营商已预存）|
|phNum | 10086  |字符型|来电号码|
|startTm | 1647344540   |timestamp|来电起始时间戳|
|netCh  | 0 |数值型|本消息由开发板的哪个网络通道推送。0:WIFI; 1:SIM1; 2:SIM2|
　
######消息内容（FORM)
FORM格式时，开发板自动模拟的HTML表单提交，将数据推送到您的接口。
模拟样式如下：
```
<form>
	<input name="devId" value="498060912345">
	<input name="type" value="621">
	<input name="slot" value="1">
	<input name="imsi" value="46007337111234">
	<input name="iccId" value="898607D3161990212345">
	<input name="msIsdn" value="+8613206411822">
	<input name="phNum" value="10086">
	<input name="startTm" value="1647344540">
	<input name="netCh" value="0">
</form>
```
　
######消息内容（JSON)
JSON格式时，开发板向您的接口推送的JSON样式如下：

 ``` 
 {
  "devId": "498060912345",
  "type": 621,
  "slot": 1,
  "imsi": "46007337111234",
  "iccId": "898607D3161990212345",
  "msIsdn": "+8613206411822",
  "phNum": "10086",
  "startTm": 1647344540,
  "netCh": 0
} 

 ```

---

<a name="622-去电接通报告"></a>

#### 622 - 去电接通报告


######“消息：622 - 去电接通消息” 使用说明

######消息的作用
您通过控制指令“teledial”向指定号码拨打电话时，开发板会自动呼叫对方号码，对方接听后，开发板会向您的接口推送622去电接通消息。
我们以手机向外拨打电话为例：您在手机上拨打对方电话，对方接听后（此时电话已接通），您的接口就会收到622消息。
－
######消息参数说明
| 参数名  | 参数值（示例）  |参数类型|说明|
| ------------ |:------------ |-----|:--|
|devId |498060912345 |字符型|开发板唯一ID|
|type |622|数值型|消息ID|
|slot  | 1 |字符型|卡槽号。1表示卡槽1；2表示卡槽2|
|imsi  | 46007337111234 |字符型|SIM卡的IMSI|
|iccId  | 898607D3161990212345 |字符型|SIM卡的ICCID|
|msIsdn  | +8613206411822 |字符型|SIM卡的电话号码（*需发卡时运营商已预存）|
|phNum | 10086  |字符型|来电号码|
|startTm | 1647344540   |timestamp|来电起始时间戳|
|netCh  | 0 |数值型|本消息由开发板的哪个网络通道推送。0:WIFI; 1:SIM1; 2:SIM2|
　
######消息内容（FORM)
FORM格式时，开发板自动模拟的HTML表单提交，将数据推送到您的接口。
模拟样式如下：
```
<form>
	<input name="devId" value="498060912345">
	<input name="type" value="622">
	<input name="slot" value="1">
	<input name="imsi" value="46007337111234">
	<input name="iccId" value="898607D3161990212345">
	<input name="msIsdn" value="+8613206411822">
	<input name="phNum" value="10086">
	<input name="startTm" value="1647344540">
	<input name="netCh" value="0">
</form>
```
　
######消息内容（JSON)
JSON格式时，开发板向您的接口推送的JSON样式如下：

 ``` 
 {
  "devId": "498060912345",
  "type": 622,
  "slot": 1,
  "imsi": "46007337111234",
  "iccId": "898607D3161990212345",
  "msIsdn": "+8613206411822",
  "phNum": "10086",
  "startTm": 1647344540,
  "netCh": 0
} 

 ```

---

<a name="623-去电挂断报告"></a>

#### 623 - 去电挂断报告


######“消息：623 - 去电挂断消息” 使用说明

######消息的作用
您通过控制指令“teledial”向指定号码拨打电话时，开发板会自动呼叫对方号码，双方的通话结束后（对方挂机，或者向开发板发送telhangup控制指令，主动挂机），开发板会向您的接口推送623去电挂断消息。
我们以手机向外拨打电话为例：您在手机上拨打对方电话，电话接通后开始通话，当通话结束时（任意一端挂断电话），您的接口就会收到623消息。
－
######消息参数说明
| 参数名  | 参数值（示例）  |参数类型|说明|
| ------------ |:------------ |-----|:--|
|devId |498060912345 |字符型|开发板唯一ID|
|type |623|数值型|消息ID|
|slot  | 1 |字符型|卡槽号。1表示卡槽1；2表示卡槽2|
|imsi  | 46007337111234 |字符型|SIM卡的IMSI|
|iccId  | 898607D3161990212345 |字符型|SIM卡的ICCID|
|msIsdn  | +8613206411822 |字符型|SIM卡的电话号码（*需发卡时运营商已预存）|
|phNum | 10086  |字符型|来电号码|
|startTm | 1647344540   |timestamp|来电起始时间戳|
|netCh  | 0 |数值型|本消息由开发板的哪个网络通道推送。0:WIFI; 1:SIM1; 2:SIM2|
　
######消息内容（FORM)
FORM格式时，开发板自动模拟的HTML表单提交，将数据推送到您的接口。
模拟样式如下：
```
<form>
	<input name="devId" value="498060912345">
	<input name="type" value="623">
	<input name="slot" value="1">
	<input name="imsi" value="46007337111234">
	<input name="iccId" value="898607D3161990212345">
	<input name="msIsdn" value="+8613206411822">
	<input name="phNum" value="10086">
	<input name="startTm" value="1647344540">
	<input name="netCh" value="0">
</form>
```
　
######消息内容（JSON)
JSON格式时，开发板向您的接口推送的JSON样式如下：

 ``` 
 {
  "devId": "498060912345",
  "type": 623,
  "slot": 1,
  "imsi": "46007337111234",
  "iccId": "898607D3161990212345",
  "msIsdn": "+8613206411822",
  "phNum": "10086",
  "startTm": 1647344540,
  "netCh": 0
} 

 ```

---

<a name="641-通话本地按键"></a>

#### 641 - 通话本地按键


######“消息：641 - 通话本地按键消息” 使用说明

######消息的作用
开发板与对方进入到通话中的状态之后，向开发板发送“按键命令”，相当于自己的电话上按下了某个按键，开发板会向您的接口推送641通话按键消息。
我们拨打联通10010号码为例：当您拨通10010号码时，首先会听到自动语音提示，类似于：
> 您好，感谢致电中国联通，按1查询话费余额， 按2查询流量余额， 按3进入……等等的提示音。

在开发板的通话中，此时您在电话上按下“1”，则开发板会向您的接口上报641消息。
注意：如果您在电话上按下了一串按键，比如连续按下了“123#”，此时，开发板会向您的接口顺序上报四个641的通话按键消息，分别是： 按键1；按键2；按键3；按键#
－
######消息参数说明
| 参数名  | 参数值（示例）  |参数类型|说明|
| ------------ |:------------ |-----|:--|
|devId |498060912345 |字符型|开发板唯一ID|
|type |641|数值型|消息ID|
|slot  | 1 |字符型|卡槽号。1表示卡槽1；2表示卡槽2|
|imsi  | 46007337111234 |字符型|SIM卡的IMSI|
|iccId  | 898607D3161990212345 |字符型|SIM卡的ICCID|
|msIsdn  | +8613206411822 |字符型|SIM卡的电话号码（*需发卡时运营商已预存）|
|phNum | 10086  |字符型|来电号码|
|startTm | 1647344540   |timestamp|来电起始时间戳|
|reason| 1 | 字符型 | 通话按键，一般包括：0-9 *# 等
|netCh  | 0 |数值型|本消息由开发板的哪个网络通道推送。0:WIFI; 1:SIM1; 2:SIM2|
　
######消息内容（FORM)
FORM格式时，开发板自动模拟的HTML表单提交，将数据推送到您的接口。
模拟样式如下：
```
<form>
	<input name="devId" value="498060912345">
	<input name="type" value="623">
	<input name="slot" value="1">
	<input name="imsi" value="46007337111234">
	<input name="iccId" value="898607D3161990212345">
	<input name="msIsdn" value="+8613206411822">
	<input name="phNum" value="10086">
	<input name="startTm" value="1647344540">
	<input name="reason" value="1">
	<input name="netCh" value="0">
</form>
```
　
######消息内容（JSON)
JSON格式时，开发板向您的接口推送的JSON样式如下：

 ``` 
 {
  "devId": "498060912345",
  "type": 623,
  "slot": 1,
  "imsi": "46007337111234",
  "iccId": "898607D3161990212345",
  "msIsdn": "+8613206411822",
  "phNum": "10086",
  "startTm": 1647344540,
  "reason": "1",
  "netCh": 0
} 

 ```

---

<a name="642-通话远程按键"></a>

#### 642 - 通话远程按键


######“消息：642 - 通话远程按键消息” 使用说明

######消息的作用
开发板与对方进入到通话中的状态之后，如果对方在自己的电话上按下了某个按键，开发板会向您的接口推送642通话按键消息。
比如需要实现类似于电话外卖订餐的业务场景，在与客户的通话过程中，通过TTS语音提示客户：
> 您好，请输入您购买套餐的数字编号，按#号键结束

此时客户在电话上按下“1#”，则开发板会向您的接口上报642消息。
注意：如果您在电话上按下了一串按键，比如连续按下了“12#”，此时，开发板会向您的接口顺序上报三个641的通话按键消息，分别是： 按键1；按键2；按键#
－
######消息参数说明
| 参数名  | 参数值（示例）  |参数类型|说明|
| ------------ |:------------ |-----|:--|
|devId |498060912345 |字符型|开发板唯一ID|
|type |642|数值型|消息ID|
|slot  | 1 |字符型|卡槽号。1表示卡槽1；2表示卡槽2|
|imsi  | 46007337111234 |字符型|SIM卡的IMSI|
|iccId  | 898607D3161990212345 |字符型|SIM卡的ICCID|
|msIsdn  | +8613206411822 |字符型|SIM卡的电话号码（*需发卡时运营商已预存）|
|phNum | 10086  |字符型|来电号码|
|startTm | 1647344540   |timestamp|来电起始时间戳|
|reason| 1 | 字符型 | 通话按键，一般包括：0-9 *# 等
|netCh  | 0 |数值型|本消息由开发板的哪个网络通道推送。0:WIFI; 1:SIM1; 2:SIM2|
　
######消息内容（FORM)
FORM格式时，开发板自动模拟的HTML表单提交，将数据推送到您的接口。
模拟样式如下：
```
<form>
	<input name="devId" value="498060912345">
	<input name="type" value="623">
	<input name="slot" value="1">
	<input name="imsi" value="46007337111234">
	<input name="iccId" value="898607D3161990212345">
	<input name="msIsdn" value="+8613206411822">
	<input name="phNum" value="10086">
	<input name="startTm" value="1647344540">
	<input name="reason" value="1">
	<input name="netCh" value="0">
</form>
```
　
######消息内容（JSON)
JSON格式时，开发板向您的接口推送的JSON样式如下：

 ``` 
 {
  "devId": "498060912345",
  "type": 623,
  "slot": 1,
  "imsi": "46007337111234",
  "iccId": "898607D3161990212345",
  "msIsdn": "+8613206411822",
  "phNum": "10086",
  "startTm": 1647344540,
  "reason": "1",
  "netCh": 0
} 

 ```

---


## 短信指令

<a name="什么是短信指令"></a>

### 什么是短信指令


#####什么是短信指令？
　　本质上，**短信指令**是一条由用户主动发送到开发板上的短信，用于通知开发板执行相应的动作。
　　短信可以发送到开发板中的任意一个卡槽上，只要SIM卡能够正常接收到短信就可以识别，并执行预期动作。
```seq
短信-开发板:&rarr;　　　　　短信指令　　　　　&rarr;
```
　　短信指令的目的是让用户能够通过短信，对开发板进行一些基本的设置，比如，让开发板连接到附近的WIFI热点、获取开发板当前的IP地址、获取开发板基本状态信息、控制开发板重启等。
  
　　与**控制指令**不同的是，短信指令只需要验证最基础的**用户密码**，不需要管理token。

#####控制指令的示例
　　以通知**开发板增加WIFI热点信息(addwifi)**的短信指令为例，说明短信指令的构成：
  ```
  *#addwifi#000000#mywifi#12345678
  ```
 　　`*#addwifi#`这是短信指令的固定开头，表示此短信用于通知开发板，附近可以连入的WIFI热点信息。
 　　`000000`是所有短信指令的所必须的一个参数，用于验证用户密码。
 　　`#mywifi#12345678`用于指明开发板附近可以连入的WIFI热点名称、密码。
   
 　　这条**短信指令**的作用是，给开发板增加一个可以连入的WIFI热点信息，此时如果开发板还没有连接任何WIFI，则短信发出后，开发板会自动尝试连接短信中提供的WIFI热点。
   
#####什么是管理员短信指令？
　　“管理员短信指令”是一组保留给管理员使用的特殊短信指令，通过“管理员短信指令”无需通过登录开发板的后台WEB页面，而是以短信的方式，直接操纵开发板的底层设置。“管理员短信指令”的主要特点是：
　　1、短信以pm99开头；
　　2、短信不需要验证“用户密码”，而是直接验证管理员密码的token。

---


### 用户短信指令

<a name="pwd-修改用户密码"></a>

#### pwd - 修改用户密码


######“短信指令:pwd - 修改用户密码”使用说明
######指令的作用
　　给开发板中的任意一张SIM卡发送 *#pwd# 指令，可以修改用户密码。
######指令的格式（示例）
```
*#pwd#000000#123456
```
######指令参数说明
 | 参数（示例） |说明|
| ------------  |--|
|*#pwd#   |短信指令名称|
|000000 |旧用户密码（不能少于4个字符）|
|123456 |变更后的新用户密码（不能少于4个字符）|

######指令反馈结果
成功时开发板回复短信：
```
设备 498060912345 的用户密码已经变更成功。
```

失败时开发板回复短信：
```
设备 498060912345 的用户密码变更失败！
```

######指令反馈结果说明
无

---

<a name="stat-查询开发板当前状态"></a>

#### stat - 查询开发板当前状态


######“短信指令:stat - 查询开发板当前状态”使用说明
######指令的作用
　　给开发板中的任意一张SIM卡发送 *#stat# 指令，可以查询开发板的当前状态。
######指令的格式（示例）
```
*#stat#000000
```
######指令参数说明
 | 参数（示例） |说明|
| ------------  |--|
|*#stat#   |短信指令名称|
|000000 |用户密码（不能少于4个字符）|

######指令反馈结果
成功时开发板回复短信：
```
Y5-416
卡槽：移动96%；移动63%
联网：WIFI
498060912345
```

失败时开发板回复短信：
```
用户密码不正确！
```

######指令反馈结果说明
无

---

<a name="wf-打开关闭wifi及查询状态"></a>

#### wf - 打开关闭wifi及查询状态


######“短信指令:wf - 打开关闭wifi及查询状态”使用说明
######指令的作用
　　给开发板中的任意一张SIM卡发送 *#wf# 指令，可以查询开发板当前连接WIFI的状态。当开发板始终无法正常连入WIFI时，发送此短信，可以查询未成功连入WIFI的原因。
　　您也可以通过本短信指令，打开或关闭开发板上的WIFI功能。
  
　　注意！在HTTP接口模式中，开发板的WIFI功能，必须是要处于开启状态。只有在TCP接口模式中，尝试关闭开发板的WIFI功能后，开发板会尝试通过手机卡网络进行联网通信。
  
######指令的格式（示例）
```
*#wf#000000#off
```
######指令参数说明
 | 参数（示例） |说明|
| ------------  |--|
|*#wf#   |短信指令名称|
|000000 |用户密码（不能少于4个字符）|
|on 或 off   |on:打开开发板的WIFI; off:关闭开发板的WIFI; 不写此参数时，表示查询当前WIFI状态|

######指令反馈结果
查询开发板WIFI状态（*#wf#000000）时，开发板成功连入WIFI的回复短信：
```
设备498060912345已经连接至:mywifi,IP:192.168.7.170,信号:56%
```

开发板未能成功连入WIFI的回复短信：
```
用户密码不正确！
或
设备498060912345连接至:mywifi的最后连接状态是：密码错。
```

关闭开发板WIFI时（*#wf#000000#off）的回复短信：
```
设备498060912345的WIFI已经关闭。
```

######指令反馈结果说明
无

---

<a name="addwf-增加wifi热点信息"></a>

#### addwf - 增加wifi热点信息


######“短信指令:addwf - 增加wifi热点信息”使用说明
######指令的作用
　　给开发板中的任意一张SIM卡发送 *#addwf# 指令，可以向开发板增加一条可连入的WIFI热点信息。开发板如果最终需要发行给用户使用，通常用户收到后，至少需要发送一条本短信，让开发板连入WIFI。
######指令的格式（示例）
```
*#addwf#000000#wifi名#wifi密码
```
######指令参数说明
 | 参数（示例） |说明|
| ------------  |--|
|*#addwf#   |短信指令名称|
|000000 |用户密码（不能少于4个字符）|
|wifi名 |开发板附近可以连入的WIFI热点名|
|wifi密码 |开发板附近可以连入的WIFI热点密码|

######指令反馈结果
成功时开发板回复短信：
```
设备498060912345收到了wifi热点名:xxxx,密码:xxxx
```

失败时开发板回复短信：
```
用户密码不正确！
```

######指令反馈结果说明
无

---

<a name="restart-控制开发板重启"></a>

#### restart - 控制开发板重启


######“短信指令:restart - 控制开发板重启”使用说明
######指令的作用
　　给开发板中的任意一张SIM卡发送 *#restart# 指令，可以控制开发板立即重启。
######指令的格式（示例）
```
*#restart#000000
```
######指令参数说明
 | 参数（示例） |说明|
| ------------  |--|
|*#restart#   |短信指令名称|
|000000 |用户密码（不能少于4个字符）|

######指令反馈结果
成功时开发板回复短信：
```
设备498060912345接到了您的重启指令。
```

失败时开发板回复短信：
```
用户密码不正确！
```

######指令反馈结果说明
无

---


### 管理短信指令

<a name="pm99inf-变更接口地址"></a>

#### pm99inf - 变更接口地址


######“管理员短信指令:pm99inf - 为开发板设置接口地址信息”使用说明
######指令的作用
　　通过短信为开发板设置接口地址。
　　通过短信设置接口地址，功能上等同与登录开发板后台WEB管理页面，并修改接口地址。对应的WEB界面图示如下：
  ![](短信指令/管理短信指令/images/168b2f65_63c8c6c4457c5.png)
######一、通过短信为开发板设置接口地址
######指令的格式（示例）
```html
*#pm99inf#7257d243875d0a5a#http://www.domain.com/inf
```
######指令参数说明
 | 参数（示例） |说明|
| ------------  |--|
|*#pm99inf#   |短信指令名称|
|7257d243875d0a5a |管理密码对应的“半长”token（参见设备管理后台之“密码管理”章节）|
|http://www.domain.com/inf |开发板的接口地址|

######指令反馈结果
成功时开发板回复短信：
```
设备 498060912345 的接口URL配置完成!
```

失败时开发板回复短信：
```
格式错误!请与管理员联系.
```

######指令反馈结果说明
无
　　
　　
  
######二、通过短信反向查询开发板中的接口地址
######指令的格式（示例）
```html
*#pm99askinf#7257d243875d0a5a
```

  
######指令参数说明
| 参数（示例） |说明|
| ------------  |--|
|*#pm99askinf#   |短信指令名称|
|7257d243875d0a5a |管理密码对应的“半长”token（参见设备管理后台之“密码管理”章节）|


######指令反馈结果
成功时开发板回复短信：
```
设备 498060912345 的接口：http://www.domain.com/inf
```

失败时开发板回复短信：
```
格式错误!请与管理员联系.
```

######指令反馈结果说明
无

---

<a name="pm99msgid-变更上报消息"></a>

#### pm99msgid - 变更上报消息


######“管理员短信指令:pm99msgid - 为开发板设置上报的接口消息”使用说明
######指令的作用
　　通过短信为开发板设置允许向接口上报的消息ID。
　　通过短信设置接口消息ID，功能上等同与登录开发板后台WEB管理页面，并修改接口消息设置。对应的WEB界面图示如下：
![](短信指令/管理短信指令/images/7283c8b9_63ce0787721f4.png)

######指令的格式（示例）
```html
*#pm99msgid#7257d243875d0a5a#100,501,603
```
######指令参数说明
 | 参数（示例） |说明|
| ------------  |--|
|*#pm99msgid#   |短信指令名称|
|7257d243875d0a5a |管理密码对应的“半长”token（参见设备管理后台之“密码管理”章节）|
|100,501,603 |开发板允许上报的接口消息ID|

######指令反馈结果
成功时开发板回复短信：
```
设备 498060912345 的接口上报消息设置完成!
```

失败时开发板回复短信：
```
格式错误!请与管理员联系.
```

######指令反馈结果说明
无

---

<a name="pm99aes-变更加密设置"></a>

#### pm99aes - 变更加密设置


######“管理员短信指令:pm99aes - 为开发板设置接口加密设置”使用说明
######指令的作用
　　通过短信为开发板设置接口上报时的加密参数。
　　通过短信设置接口加密参数，功能上等同与登录开发板后台WEB管理页面，并修改接口的加密参数。对应的WEB界面图示如下：
    ![](短信指令/管理短信指令/images/3f90e3bd_63d47197acf5b.png)
######指令的格式（示例）
```html
*#pm99aes#7257d243875d0a5a#aes#FLfSxDB7WICM1q7#c9NbOH3XtlYsuahX
或
*#pm99aes#7257d243875d0a5a#no   /**关闭开发板接口加密**/
```
######指令参数说明
 | 参数（示例） |说明|
| ------------  |--|
|*#pm99aes#   |短信指令名称|
|7257d243875d0a5a |管理密码对应的“半长”token（参见设备管理后台之“密码管理”章节）|
|aes |开发板设置开启AES128加密。如果值为“no”表示关闭开发板的加密设置|
|FLfSxDB7WICM1q7 | 设置AES128的 KEY |
|c9NbOH3XtlYsuahX | 设置AES128的 IV |

######指令反馈结果
成功时开发板回复短信：
```
设备 498060912345 的AES加密设置完成!
```

失败时开发板回复短信：
```
格式错误!请与管理员联系.
```

######指令反馈结果说明
无

---

<a name="pm99admpwd-变更管理密码"></a>

#### pm99admpwd - 变更管理密码


######“管理员短信指令:pm99admpwd - 修改开发板的管理员密码”使用说明
######指令的作用
　　通过短信修改开发板的管理员密码。
　　通过短信修改管理员密码，功能上等同与登录开发板后台WEB管理页面，并修改管理员密码。对应的WEB界面图示如下：
  ![](短信指令/管理短信指令/images/d6514817_63d46c674bb83.png)
  
######指令的格式（示例）
```html
*#pm99admpwd#7257d243875d0a5a#admin#123456
```
######指令参数说明
 | 参数（示例） |说明|
| ------------  |--|
|*#pm99admpwd#   |短信指令名称|
|7257d243875d0a5a |管理密码对应的“半长”token（参见设备管理后台之“密码管理”章节）|
|admin |开发板的旧管理员密码|
|123456 | 开发板的新管理员密码|

######指令反馈结果
成功时开发板回复短信：
```
设备 498060912345 新的管理员密码设置完成!
```

失败时开发板回复短信：
```
格式或密码错误!请与管理员联系.
```

######指令反馈结果说明
无

---

<a name="pm99usrpwd-变更用户密码"></a>

#### pm99usrpwd - 变更用户密码


######“管理员短信指令:pm99usrpwd - 修改开发板的用户密码”使用说明
######指令的作用
　　通过短信修改开发板的用户密码。一般用于远程维护开发板中的用户密码，应对用户反馈密码遗忘等场景。
　　通过短信修改用户密码，功能上等同与登录开发板后台WEB管理页面，并修改用户密码。对应的WEB界面图示如下：
  ![](短信指令/管理短信指令/images/2453f401_63db3c8ee2c9b.png)
  
######指令的格式（示例）
```html
*#pm99usrpwd#7257d243875d0a5a#000000
```
######指令参数说明
 | 参数（示例） |说明|
| ------------  |--|
|*#pm99usrpwd#   |短信指令名称|
|7257d243875d0a5a |管理密码对应的“半长”token（参见设备管理后台之“密码管理”章节）|
|000000 |开发板的用户密码|

######指令反馈结果
成功时开发板回复短信：
```
设备 498060912345 的用户密码设置完成!
```

失败时开发板回复短信：
```
格式或密码错误!请与管理员联系.
```

######指令反馈结果说明
无

---

<a name="pm99rst-重启开发板"></a>

#### pm99rst - 重启开发板


######“管理员短信指令:pm99rst - 控制开发板重启”使用说明
######指令的作用
　　通过短信重启开发板。
######指令的格式（示例）
```html
*#pm99rst#7257d243875d0a5a
```
######指令参数说明
 | 参数（示例） |说明|
| ------------  |--|
|*#pm99rst#   |短信指令名称|
|7257d243875d0a5a |管理密码对应的“半长”token（参见设备管理后台之“密码管理”章节）|

######指令反馈结果
成功时开发板回复短信：
```
设备 498060912345 接到了您的重启指令.
```

失败时开发板回复短信：
```
格式错误!请与管理员联系.
```

######指令反馈结果说明
无

---


## 硬件安装

<a name="开发板硬件介绍"></a>

### 开发板硬件介绍


#####开发板硬件实物图
（**主板布局图**）：
![](硬件安装/images/7f53c326_68254a428f57f.png)

#####开发板硬件各部分说明：
　　X5开发板尺寸为 105mm * 84mm，板上自带WiFi天线、4G LTE天线、4G模组以及多个M2螺栓控，支持安装M2六角接线柱。
  
　　**位置①：**开发板的电源接口。电源接口与最常见的安卓手机接口一样，采用的是TypeC接口，如下图：
 ![](硬件安装/images/d8bd1d66_68254e7ac378d.png)

　　开发板可以连接普通安卓手机的电源头。注意，电源头必须要符合5v2A规格，即电源的电压必须是5v，电流至少要2A以上。（新一代支持快充的安卓电源，通常会同时标注：5v3A、9v2A等多种规格，只要标注了5v通常就可以使用。）
  
  　　**位置②：**开发板的SIM卡插槽。开发板支持同时插入二张SIM卡，支持双卡双待。使用时将SIM卡插入到卡槽中就可以了。SIM卡槽可以插入“nano”卡（小卡），小卡实物图如下：
![](硬件安装/images/eec8f728_6825aef1d60bb.png)
  　
　　**位置③：**开发板的显示屏接口。显示屏是可选组件，使用时即插即用。显示屏可以提示开发板运行中的一些关键信息，如WiFi链接状态以及IP地址、SIM卡当前状态等信息。显示屏的实物图如下：
  
  ![](硬件安装/images/76901277_6825b155aff07.png)

　
　　开发板可以与市面上的公版外壳进行配套，外壳的具体规格为：125ｍｍ x 85ｍｍ x 28ｍｍ（长宽高），外壳实物如下：
![](硬件安装/images/90d9e525_63c0faaa1ecd9.jpg)

　　只需要将调试配置好的开发板放入到外壳中，然后将您自己设计的产品商标贴纸，贴到外壳上，即可以完成产品的定型。

![](硬件安装/images/e6619659_63c0f9d73a22b.png)

![](硬件安装/images/6feeac6d_63c0fa1b3059e.png)

---

<a name="电源头规格说明"></a>

### 电源头规格说明


　　电源是开发板是否能稳定运行的决定因素之一，开发板电源的电压必须是5V，极限为6V。使用超过6V（含）以上的电源，开发板将无法稳定工作，乃至烧毁。
  
　　开发板对电源电流要求至少是2A。
  
　　使用不足2A的电源头（比如苹果手机的1A供电头），开发板将无法正确工作。电流不足时，表现为无法开机、无法检测到SIM卡，无法正常接收到短信、或接收短信严重延迟等现象。
  
　　除了电源本身之外，还需要关注USB供电线的品质。低品质的USB线，无法提供2A的电流，此时即使电源本身供电达标，也仍然无法向设备输出2A的电流。
  
　　最后，使用USB一分多供电器时请特别注意，要求每个端口都能提供2A的供电能力。比如5口USB分线器，总的供电能力至少要求在40W以上，使用时请务必仔细测试确认。

![](硬件安装/images/90e503d2_6825b4f90218b.png)

---


## 设备管理后台

<a name="进入设备管理后台"></a>

### 进入设备管理后台


　　开发板正确连上WIFI之后，就可以登录到开发板的“设备管理后台”WEB页面，完成诸如接口配置等相关的配置与管理工作。

######进入设备管理后的步骤：

　　（1）参照“快速入门”章节，开发板正确插卡、通电之后，给设备中的卡发送短信：
`*#addwf#000000#WiFi热点名#WiFi热点密码`
　　开发板收到包含有WIFI热点信息的短信后，会自动的搜索并连入指定的WIFI热点。（注意：热点必须是2.4G，不能是5G）

　　（2）参照“快速入门”章节中的“获取开发板的ＩＰ地址”一节，获取到当前开发板的IP地址，然后在浏览器中访问以下地址，进入到“设备管理后台”WEB页面。
    `http://192.168.7.170/mgr`
　　其中，此处的192.168.7.170是假设已经获取到的开发板IP地址，您实际获取到的IP地址可能与示例不同，实际使用时，请替换成您实际的IP地址即可。

　　（3）在浏览器中输入开发板后面管理页面的地址，登录到开发板后面管理页面。注意：首次登录时可能会提示您输入管理员名称、密码，以验证您的管理身份。开发板出厂默认的登录名称、密码分别是：admin、admin，您初次登录成功之后，可以在“设备管理后台”页面中修改默认的管理密码。
  
**设备管理后台图示如下：**
![](设备管理后台/images/4d512c0a_63c8ad3e1a8b9.png)


　　设备管理后台的首页主要包括三个部分：

　　第一部分是“**标题区域**”，包括了当前设备的版本号 以及 设备代码。设备代码是全球唯一的设备ID，每一张开发板都有一个全球唯一的ID标识。
  
　　第二部分是“**设备配置**”区域，通过设备配置的相关子功能，您可以完成诸如接口信息配置，系统运行参数配置、设备密码管理等相关的信息配置工作，方便您将开发板连入到您指定的接口或第三方平台中。
  
　　第三部分是“**管理工具**”区域，您可以通过开发板提供的管理工具功能，方便的对开发中的接口推送结果进行调试，或者是对开发板的配置信息进行统一的备份或恢复。
  
　　在后面的章节中，我们将向您介绍每一个功能的具体使用方法。

---


### 接口信息配置

<a name="功能概述"></a>

#### 功能概述


　　“**接口信息配置**”功能用于给开发板配置基本的接口信息，以便于将开发板接入到您指定的接口或第三方平台。
  目前，开发板支持http接口、https接口以及tcp接口，共三种接口类型。
  
　　由于接口配置信息功能的内容较多，我们将用专门的章节各您说明功能中，各个部分的使用方法。

######接口配置信息界面：
![](设备管理后台/（1）接口信息配置/images/35de05a9_6825baef787b4.png)

---

<a name="接口地址设置"></a>

#### 接口地址设置


　　“**接口地址设置**”文本框用于填写您的接口地址信息或第三方平台的接口信息。
　　

######接口地址设置界面：
![](设备管理后台/（1）接口信息配置/images/168b2f65_63c8c6c4457c5.png)

_
　　“接口地址设置”文本框中，可以填写您要接入的接口地址。接口地址可以是 http:// 开头或 https:// 开头的HTTP接口，也可以是 tcp:// 开头的 TCP接口。
  
######HTTP接口填写说明：
　　对于http接口，一般填写的接口地址样例为：
`http://www.domain.com/server/inf`
　　对于https接口，接口地址样例为：
`https://www.domain.com/server/inf`
　　设备中有需要向接口上报的数据时，设备会通过HTTP协议，向您指定的接口自动上报数据。

　　一般来说，http接口只需要填写一个。但是，“接口地址设置”文本框中，也允许填写多个http接口信息，多个接口之间以“换行”分隔，接口地址样例为：
  
  			https://www.domain01.com/server/inf
  			https://www.domain02.com/server/inf
			https://www.domain03.com/server/inf
  
　　当您在“接口信息配置”文本框中，同时填写了多个HTTP接口时，设备向接口上报数据时，会以“**轮流上报**”的方式，每次轮流更换一个上报接口进入数据上报。
　　以上述接口为例：
```seq
开发板-接口:&rarr;　　　　　消息（1）上报至domain01接口　　　　　&rarr;
开发板-接口:&rarr;　　　　　消息（2）上报至domain02接口　　　　　&rarr;
开发板-接口:&rarr;　　　　　消息（3）上报至domain03接口　　　　　&rarr;
开发板-接口:&rarr;　　　　　消息（4）上报至domain01接口　　　　　&rarr;
开发板-接口:&rarr;　　　　　消息（5）上报至domain02接口　　　　　&rarr;
开发板-接口:&rarr;　　　　　消息（6）上报至domain03接口　　　　　&rarr;
```
　　通常，填写多个HTTP接口轮流上报，一般适用于以下场景：
  
　　（1）需要将开发板的短信，直接接入到webhook群机器人。为了提高信息的转发速度，您可以在同一个群中，同时创建了多个群机器人，然后，您可以将每一个群机器人的webhook地址，分别填写到“接口信息配置”文本框中，这样，当开发板在向webhook上报数据时，便会利用多个群机器人，逐一轮流向群中上报信息。
  
　　（2）在某些场景中，您可以利用http轮流上报的特性，实现http访问的负载均衡。当有多个开发板需要同时向某一个http接口上报数据时，为了避免http接口服务器在同一时间内的数据访问的压力过大，您可以设置多组http接口服务器，共同接收来自开发板的HTTP数据上报，从而实现将HTTP访问压力，均衡负载到多个HTTP接口服务器上。

> **注意：**
　　（1）同时填写多个http接口时，开发板只能以“轮流上报”的方式，逐一向各个接口上报数据。目前，开发板暂不具备向多个接口“同时上报”的能力，后续的版本中可能增加此类功能，如有需求请关注“版本变更履历”一节。

>　　（2）一般而言，我们不推荐您使用https接口。因为，https接口仅能做到数据的“防监听、防篡改”，但并不能做到数据的“防伪造”。实际上，您可以用任意一款工具，模拟开发板的数据上报格式，向您的https接口上报数据。您的接口收到数据后，难以分辨当前上报的数据是开发板上报的真实数据，还是恶意的伪造数据。

>　　所以，如果对上报的数据有较高的安全要求时，我们推荐您使用http接口，同时开启开发板的“数据加密”功能（在密码管理中）来代替https接口。开发板开启“数据加密”功能后，可以实现数据的“防监听、防篡改、防伪造”。同时，又利用了http接口的轻量性特点，让开发板可以较快的速度，与http接口完成数据交互。

>　　我们强烈不推荐，将https接口 与 “数据加密”功能同时开启使用。因为，这将较大程度上的影响开发板的运行效率，进而影响开发板运行的稳定性。

>　　最后，在必须使用https接口的场景中，您需要确认https接口的SSL安全协议，必须是v1.2版本。（v1.1或v1.3均不支持）


------------

> **HTTP接口的技术限制：**

>　　（1）由于开发板工作于“内网”，开发板本身通常无法获得公网IP地址，所以，使用HTTP接口时，只能由开发板向接口进行“单向的”数据上报。
　　如果需要远程对开发板进行控制（向开发板发送控制指令等），则需要借助DDNS等技术，将开发板反向映射到一个公网地址，然后通过DDNS的公网地址控制开发板。具体所DDNS涉及的内网映射内容，超出了本文的范围，请您自行百度搜索。
　　（2）当开发板仅使用4G网络与接口通讯，而本身没有连入WIFI网络时，开发板自身的OTA（设备固件空中升级）功能，无法被启用。只有正确的连入的WIFI网络，开发板才能执行在线的固件升级。

　　
######TCP接口地址的填写说明：

　　在对于tcp接口，一般填写的接口地址样例为：`tcp://www.domain.com:8888` 
  
　　或者使用IP的地址样例： `tcp://10.235.6.98:8888`

　　tcp接口地址由 tcp:// 固定格式开头，中间填写TCP接口的域名或IP地址，然后填写“TCP接口的端口号”，TCP接口域名（或IP）与端口号之间，以“冒号”分隔。
  
　　TCP接口地址格式如下：`tcp://[TCP接口域名或IP]:[端口号]` 
  

> **注意：**
>　　（1）TCP接口地址，只允许填写一个。填写多个TCP接口地址，无效。
  
>　　（2）TCP接口也允许开启开发板自身的“数据加密”功能。更多内容，请参见“数据加密”相关章节。
  
>　　（3）由于TCP通讯的技术原理与HTTP不同，TCP接口天然具备了开发板与TCP接口之间的双向通信功能。即在TCP接口通讯建立完成之后，开发板即可以向TCP接口上报数据，同时，TCP接口端也可以随时向开发板下达控制指令，这样，就方便的完成了接口与开发板之间的双向通信。

>　　（4）使用TCP接口时，开发板即可以通过WIFI网络向TCP接口上报数据，也可以通过手机卡自身的4G网络向TCP接口上报数据。

------------

> **TCP接口的技术限制：**

>　　在当前的版本中，使用TCP接口将有如下的限制：
  
>　　（1）当开发板仅使用4G网络与接口通讯，而本身没有连入WIFI网络时，开发板自身的OTA（设备固件空中升级）功能，无法被启用。只有正确的连入的WIFI网络，开发板才能执行在线的固件升级。

---

<a name="http接口设置"></a>

#### HTTP接口设置


　　当您的接口使用的是HTTP接口时，通过“**HTTP接口设置**”功能可以对HTTP协议的细节，完成进一步的设置。
  

######HTTP接口设置界面：
![](设备管理后台/（1）接口信息配置/images/36e8519f_63cdce5639a0d.png)

　　
　　（1）**HTTP请求方式：**用于设置开发板向接口发送HTTP请求时，可以通过 GET 或是 POST 两种方式提交数据。一般来说，在正式的使用环境中，我们**推荐您使用POST**，而GET方式由于受到参数长度的限制，不适合发送数据量较多的数据。GET方式一般用于初步的开发调试中使用。
　　
　　（2）**Content-Type：**Content-Type可以设置HTTP提交数据的方式，有两种选择分别是：FORM 或 JSON。

　　如果您选择了FORM，则开发板向您的接口提交数据时，模拟的是HTTP FORM表单，您的接口一侧收到数据后，可以通过 request 对象获取开发板提交过来的数据，比如在Java中，您可以使用 request.getParameter("参数名") 的方式，获取到数据。
  
　　如果您选择了JSON，则开发板向您的接口提交数据时，您的接口一侧可以通过读取 request 流的方式，获取到一个包括所有数据的完整的JSON串。比如在Java中，示例代码如下：
  ```java
  String contentType = request.getHeader("Content-Type");
  if (contentType.contains("application/json")) {
  	BufferedReader br = null;
  	try {
		  br = new BufferedReader(new InputStreamReader(request.getInputStream(), "UTF-8"));
		  StringBuilder sb = new StringBuilder();
		  String s;
		  while ((s = r.readLine()) != null) {
			  sb.append(s);
		  }
		  String jsonStr = sb.toString();
		  System.out.println("Json数据是：" + jsonStr);
	  } finally {
	  	if (br != null)  r.close();
	  }
  } 
  ```
  
　　注意：如果您选择了 GET + JSON，那么您在接口一侧需要使用 request.getParameter("p") 来获取到GET中的数据。这里的“**p**”，是开发板在GET方式中提交数据时的“固定参数名”。所有数据组装成JSON串后，会放在“p”参数中向您的接口中提交。以100消息为例，“p”参数获取到的参数内容，格式如下：
```json
{ "devId": "498060912345", "type": 100, "ip": "192.168.7.170", "ssid": "mywifi", "dbm": 61, "netCh": 0 } 
```
　　
　　无论如何，GET + JSON 的方式，一般只应用于内部调试阶段，正式环境中都不推荐使用这种组合。
  
　　**Content-Type**，无论您选择 FORM 或是 JSON ，在技术本身的优缺点层面上并没有差异。您可以根据您自己的需要自行选择。
  
　　（3）**请求频率：**一般来说，设置为“无限制”即可。在对接某些第三方平台时（比如对接webhook机器人），有些第三方平台，会限制HTTP请求的频率。比如，钉钉和企业微信，都要求机器人webhook地址的请求频率，不能超过每分钟20次，否则会触发惩罚机制。在这种情况下，您可以将此选项设置为：限制并每分钟不超过20次，即可。
  
　　（4）**HTTP附加头：**一般来说，这个选项用不到。在某些特殊的情况，比如您的接口中开启了HTTP基本身份验证（Basic auth），此时如果用户通过浏览器直接访问接口时，浏览器会弹出“请输入访问的用户名、密码”的提示框，而您希望开发板向接口上报数据不受这个限制，此时，您就可以将HTTP认证信息，附加到HTTP头信息中，类似以下格式：
```
"Authorization: Basic dXNlcm5hbWU6cGFzc3dvcmQ="
```
　　具体关于HTTP头信息的用法，您可以根据自己的需要自行设计。

---

<a name="tcp接口设置"></a>

#### TCP接口设置


　　当您的接口使用的是TCP接口时，通过“**TCP接口设置**”功能可以对TCP接口的细节，完成进一步的设置。
  

######TCP接口相关的设置界面：
![](设备管理后台/（1）接口信息配置/images/e364331c_6825bbd7a0b3d.png)
　　
　　（1）**联网卡槽：**与HTTP接口不同的是，通过TCP接口上报数据时，开发板允许 **WIFI** 或 **手机卡自身的网络** 两种方式，进行数据上报。默认情况下，如果开发板已经连入了WIFI网络，则优先使用WIFI网络向接口上报数据。如果WIFI网络临时断开，则开发板会默认尝试开启手机卡网络进行数据上报，并直到WIFI网络恢复后，再重新切换回WIFI网络。
  
　　当通过手机卡网络上报数据时，会消耗手机卡的流量并可能产生流量费用，有时这并不是您所期望的（比如某些卡的流量费用相当昂贵），此时您可以通过本选项进行进一步的控制。本选项共包括以下几种选择：
  
　　1. 全部允许　　　　　即：允许在没有WIFI网络的环境中，使用 卡1 或 卡2 的手机卡流量。
　　2. 仅允许卡槽１　　　即：在没有WIFI网络的环境中，只允许卡槽1中的卡，尝试开启流量功能。
　　3. 仅允许卡槽２　　　即：在没有WIFI网络的环境中，只允许卡槽2中的卡，尝试开启流量功能。
　　4. 全部禁止　　　　　即：只允许使用WIFI网络转发数据，手机卡网络一律不允许使用。
  

> **注意：**
　　当开发板的所有网络都无法连接时，开发板的数据上报将被“暂停”。
　　“暂停”期间的需要上报数据并不会丢失（即使在“暂停”期间开发板被人为重启），当网络连接恢复后，所有“暂停”期间未能上报的数据，会重新向接口逐一完成上报。

　　
　　（2）**联网顺序：**WIFI已成功联网的情况下，总是优先通过WIFI上报数据。当WIFI未联网的状态下，默认情况下，开发板会随机使用卡1或卡2的手机卡网络进行联网。

---

<a name="接口消息设置"></a>

#### 接口消息设置


　　开发板自身在运行期间会发生多种“状态变化”，当某些“状态”发生变化时，开发板就会触发消息上报的处理，将相关状态数据打包后主动向接口上报。
　　“**接口消息设置**”用于设置将开发板的哪些消息，允许向接口上报。一般来说，这里只需要设置您的接口所需要关心的消息即可，对于您不关心的消息，可以选择不上报。
  

######接口消息设置界面：
![](设备管理后台/（1）接口信息配置/images/258f532e_6825bc7d7d4da.png)
　　
######一、已联网消息：
　　（1）**100（WIFI已联网）消息：**当开发板正确连入了您指定的WIFI网络时，开发板将向接口上报100消息，表示开发板本身已经通过WIFI联网成功。
　　（2）**101（卡槽1已联网）消息：**当开发板已经连入了卡槽1网络时，开发板将向接口上报101消息，表示开发板本身已经通过卡槽1联网成功。
　　（2）**102（卡槽1已联网）消息：**当开发板已经连入了卡槽2网络时，开发板将向接口上报102消息，表示开发板本身已经通过卡槽2联网成功。

> **注意：**
　　由于目前HTTP接口只允许使用WIFI网络，所以，使用HTTP接口时，将只能够获取到100消息。如果您的接口是TCP接口，则可能会获取到100、101、102三种消息中的任意一种。

------------

> **【小提示】**
　　开发板在通电开机之后，首先做的第一件事情是尝试完成开发板的联网。所以，合理利用100、101、102消息，可以实现监测开发板是否已经开机。

  
　　
######二、SIM卡消息：
　　（1）**202（SIM卡基站注册中）消息：**当您向开发板插入SIM卡时，开发板会对SIM卡进行初始化。SIM卡初始化过程包括监测SIM卡本身是否能正常工作，以及驱动SIM卡向运营商基站注册等工作。开发板在执行SIM卡初始化的动作之前，会首先向接口上报202消息，提示SIM卡已经插入，并且正在进行初始化。
  
　　（2）**203（SIM卡ID已经获取）消息：**SIM卡的ICCID、IMSI、MSISDN是SIM卡的三个基本参数。当SIM卡初始化完成后，会向接口上报关于当前SIM卡的ICCID、IMSI、MSISDN三个基本信息。
  
>  **ICCID**为SIM本身的集成电路ID。此ID通常被印刷在SIM的背面，并且在SIM卡本身更换时（如补卡）发生改变。
  **IMSI**为SIM卡的运营商识别ID。此ID是与电话号码一一对应的（但IMSI不是电话号码），IMSI可以在逻辑上唯一标识一张卡，即使SIM卡本身发生更换（如补卡后），IMSI也不会改变。
  **MSISDN**为通常意义上的“手机号”，MSISDN由运营商在发卡时进行预置。但是随着客户隐私保护的不断深入，越来越多的新卡，在出厂时并不会预置“手机号”。所以，在很多的手机卡上 MSISDN 通常都是空白值。
  
　　（3）**204（SIM卡已就绪）消息：**当接口收到204消息时，表示SIM卡已经完成了所有的初始化工作，SIM卡本身已经可以正常的接打电话、收发短信了。
  
　　（4）**205（SIM卡已弹出）消息：**如果在开发板开机的过程中，用户主动的取走了开发板中的SIM卡，则对应的接口上会收到205消息，表示SIM已经被取出。
  
　　（5）**209（SIM卡异常）消息：**如果开发板无法正确的完成对SIM卡的初始化工作，则会向接卡上报209消息。通常而言，如果开发板上报209消息，一般可能是如下几种原因：
　　（5.1）SIM卡欠费停机。补缴话费后可以自动恢复；
　　（5.2）SIM卡插卡不良。未能正确插卡（如SIM卡与卡套安装不良）；
　　（5.3）SIM卡已损坏。这里指SIM的物理损坏，需考虑重新补卡；
　　（5.4）SIM卡已被封停。具体原因请咨询手机卡的运营商；
  
> **注意：**
　　203、204消息一般是大致在**同一时间内**先后接收到，但是接收的顺序可能是不确定的。即，有可能先接收到204消息，然后再接收到203消息。
  
　　
######三、通讯模组消息：
　　（1）**301（通讯模组错误）消息：**当您向开发板插入SIM卡时，开发板会首先对通讯模组进行初始化。如果通讯模组初始化失败，开发板会向接口发送301消息。一般而言，如遇301错误，通常为开发板损坏。
    
　　
######四、命令应答消息：
　　您可以通过向开发板发送“命令”，让开发板完成命令指定的动作，比如通过命令获取开发板的当前状态，或通过命令控制开发板向外发送短信或拨打电话等等。
　　（1）**401（命令已收到）消息：**当您向开发板发送命令后，如果开发板收到了您的命令，会立即返回401消息，表示命令已经成功接收。
  
　　（2）**402（命令已处理）消息：**当您向开发板发送命令后，如果开发板对您的命令已经处理完成，会立即返回402消息，表示您的命令已经执行完成。
  
　　
######五、短信消息：
　　（1）**501（新短信）消息：**当开发板上的SIM卡收到了新的短信时，会向接口上报501消息。501消息中会包括短信号码、短信内容、短信时间以及卡槽编号等必要的信息。
  
　　（1）**502（短信外发成功）消息：**当您通过控制指令遥控开发板的SIM卡向外发短信时，如果短信发送成功，则开发板会向接口上报502消息。需要注意的是，如果外发短信不成功，则开发板不会给出任何消息提示。在实际的使用过程中，当外发短信的控制指令被成功执行起算，超过30秒仍然收不到502消息，则一般认为是短信外发失败。如果SIM卡在某个时点之后，短信外发始终都不能成功，则优先考虑SIM卡本身话费是否充足（外发短信一般需要在运营商层面扣除话费）。
  
　　
######六、电话消息：
　　（1）**601（来电振铃）消息：**当开发板上的SIM卡收到了来电，本机处于来电振铃状态时，开发板会向接口上报601消息，表示有电话正在呼入，等待接听中。
  
　　（2）**602（来电接通）消息：**当开发板正在处于来电振铃状态时，给开发板发送“接听来电命令”时，开发板会立即接听本次来电，并向接口端上报602消息，表示本次来电已成功接听。
  
　　（3）**603（对方挂断来电）消息：**当开发板上的SIM卡收到了来电，在呼叫方挂断电话之后（本次来电结束），开发板会向接口上报603消息。603消息中会包括来电号码、来电时间、对方挂断时间以及卡槽编号等必要的信息。
  
　　（4）**620（去电拨号中）消息：**当开发板的电话处于空闲状态时，给开发板发送“电话外呼拨号命令”时，开发板会首先尝试向对方号码拨打电话，在处于拨号中的环节时，开发板会向接口上报620消息，表示正在拨打对方号码。
  
　　（5）**621（去电对方振铃中）消息：**当开发板外呼拨号完成后，对方手机开始振铃时，开发板会向接口上报621消息，表示电话外呼拨号已经成功，对方手机正在振铃中，等待对方接听。
  
　　（6）**622（去电已接通）消息：**当开发板外呼拨号对方振铃后，对方主动接听了本次来电，开发板会向接口上报622消息，表示对方已经接听电话。
  
　　（7）**623（去电已挂断）消息：**当开发板外呼通过中，对方主动挂断电话，或开发板自身通过“本地挂机命令”主动挂断了电话，开发板会向接口上报623消息，表示本次通话已经结束。
  
　　（8）**641（通过中本地按键）消息：**当开发板处于通话中的状态时，开发板自身通过“本地按键命令”按下了某些按键，开发板会向接口上报641消息，表示开发板自身在通话中的按键动作已经完成。
  
　　（9）**642（通过中远程按键）消息：**当开发板处于通话中的状态时，对方在电话机中按下了某些按键时，开发板会向接口上报642消息，表示对方在通话中的按键已完成。
    
　　
######七、电话控制回应消息：
　　（1）**681（外呼拨号成功）消息：**向开发板发送“电话外呼拨号命令”时，开发板会立即控制手机卡向指定号码进行拨号。当拨号成功时，开发板会向接口上报681消息，表示电话外呼拨号已经成功。
  
　　（2）**682（外呼拨号失败）消息：**向开发板发送“电话外呼拨号命令”时，开发板会立即控制手机卡向指定号码进行拨号。当拨号失败时，开发板会向接口上报682消息，表示本次电话外呼拨号失败。（可能的原因一般包括：卡故障、卡欠费等）
  
　　（3）**684（接听成功）消息：**当开发板处于“来电振铃”状态时，向开发板发送“电话接听命令”，开发板会立即尝试接听本次来电。当来电接听成功时，开发板会向接口上报684消息，表示本次来电已经成功接听。
  
　　（4）**685（接听失败）消息：**当开发板处于“来电振铃”状态时，向开发板发送“电话接听命令”，开发板会立即尝试接听本次来电。当来电接听失败时，开发板会向接口上报685消息，表示本次来电未接成功接听。
  
　　（5）**687（TTS播放成功）消息：**当开发板处于“通话中”状态时，向开发板发送“TTS播放命令”，开发板会立即向本次通话中的对方播放指定的语音内容。当语音内容被成功播放时，开发板会立即向接口上报687消息，表示指定的语音内容已经开始播放。
  
　　（6）**688（TTS播放失败）消息：**当语音内容被不能成功播放时，开发板会立即向接口上报688消息，表示指定的语音内容未能成功播放。（比如不在通话中状态等）
  
　　（7）**689（TTS播放结束）消息：**当语音内容被完整的播放完成后，开发板会立即向接口上报689消息，表示指定的语音内容已经完整的播放完成。
　　
######八、其它消息：
　　（1）**998（PING）消息：**开发板在运行期间，会定时向接口上报PING消息。表示开发板已经开机且工作正常。通常来说，HTTP接口一般不需要处理998消息。但TCP接口则必须接收本消息，并以此判断客户端（开发板一侧）的TCP链接正常。在TCP接口模式下，998消息无论您是否勾选，998消息会始终向您的TCP接口推送。
  
> **【小提示】**
　　通常可以用定时监测998消息的方法，确定开发板是否已经处于开机工作中的状态。比如，可以将PING消息设置为每60秒主动触发一次，然后接口端如果连续2次或3次都没有接收到998消息，则可以认为开发板网络断开且无法联网了 或是 开发板关机了。

---

<a name="其它设置"></a>

#### 其它设置


　　“**其它设置**”是与开发板接口相关的一些附加选项，用户可以根据自身的需要进行设置。
　　

######其它设置界面：
![](设备管理后台/（1）接口信息配置/images/93a0cba3_6825c49ecad0b.png)

　
　　（1）**401消息超时时间：**当向开发板发送“命令”时，如果“命令”中带有tid字段表示命令的“发送方”需要对本次发送的命令进行确认，当开发板收到带有tid字段的“命令”时，会立即向接口上报“命令已收到”的应答消息。
```plantuml
@startuml
命令发送方 -> 开发板:　　　电话外呼拨号命令（tid:order3587）
开发板 --> 命令发送方 :　         返回401消息（tid:order3587）
开发板 --> 命令发送方 :　         返回681消息（tid:order3587）
@enduml
```
 　
　　（2）**PING消息间隔：**此设置用于为998消息设置一个周期上报的时间。比如您如果设置为60，表示开发板每间隔60秒，会向接口上报一次998消息。
> **注意：**
　　在使用手机卡网络联网时，此值不宜设置的过大。否则在运营商层面上，会被认为手机卡所创建的TCP链接已经超时，运营商会主动切断手机卡网络的TCP链接。默认情况下此值为110秒，通常情况下这个值是合适的。

　　
　　（3）**JSON控制字符转普通字符：**控制字符一般是指例如：制表符(0x09)、换行符（0x0a)等特殊字符。在标准的JSON中是不允许直接出现这种特殊符号的。例如以下JSON格式：
  ```json
{
	"smsBody" : "您好
	这是示例"
}
  ```
　　在上例中，“您好”与“这是示例”之间有一个换行符。
　　在JSON的标准规范中，这是不允许的。然而在实际使用中，目前大多数流行的JSON库，都能够自动处理这种情况，并不会认为是非法的JSON格式。但是仍有一部分JSON库不会自动处理，而是直接报告JSON格式非法。

　　为了适应这种情况，您可以勾选本选项，由开发板在向接口上报数据之前，事先将其转换为标准的JSON格式。在前述示例中，如果勾选了本选项，处理的结果是：
```json
{
	"smsBody" : "您好\n这是示例"
}
```

> **注意：**
　　此选项默认是不勾选的。通常而言，我们建议您不需要修改此选项的默认设置。只有在您的JSON库明确的处理不了此种问题时，再考虑开启本选项。

---


### 系统参数管理

<a name="功能概述"></a>

#### 功能概述


　　“**系统参数管理**”可以控制开发板向接口上报时，允许上报哪些数据字段，以及修改上报数据字段的名称。
　　

######系统参数管理界面：
![](设备管理后台/（2）系统参数管理/images/24db9f77_6825c7aa0b6ed.png)
　　
　　**（1）是否“启用”参数：**只有设置为“**启用**”的参数，开发板才会向接口上报。以100消息为例，默认情况下，100消息的JSON格式为：
 ``` 
{
  "devId": "498060912345",
  "type": 100,
  "ip": "192.168.7.170",
  "ssid": "mywifi",
  "dbm": 61,
  "netCh": 0
} 
```
　　如果在“系统参数管理”中，将ssid、dbm两个字段设置为“不启用”（取消勾选），那么开发板上报100消息时，将会变为以下格式：
 ``` 
{
  "devId": "498060912345",
  "type": 100,
  "ip": "192.168.7.170",
  "netCh": 0
} 
```
　　由此可见，由于ssid、dbm两个字段没有启用，所以100消息中，这两个字段被忽略了。实际上，不仅仅是100消息，所有包括ssid、dbm字段的消息，都不再出现这两个字段的信息了。
  
　　
　　**（2）“参数别名”：**您可以为任意一个系统参数，设置一个新的名字来代替系统默认的名称。以100消息为例，如果为ssid、dbm分别设置一个别名，ssid设置为apName，dbm设置为apDBm，那么开发板上报100消息时，将会变为以下格式：
 ``` 
{
  "devId": "498060912345",
  "type": 100,
  "ip": "192.168.7.170",
  "apName": "mywifi",
  "apDBm": 61,
  "netCh": 0
} 
```
　　同样的，不仅仅是100消息，所有包括ssid、dbm字段的消息中，这两个字段的默认名称都会被“别名”代替。

------------

> **特别说明**
　　时间戳类参数，比如smsTm（短信时间），长度都是12位的（精确到秒）。
　　charset参数：目前取值总是 utf8 ，表示开发板上报的参数是以utf8方式编码的。

---

<a name="隐含的系统参数"></a>

#### 隐含的系统参数


　　在系统中，有一些隐含的的系统参数，虽然没有在“系统参数界面”中列出，但您在需要时总是可以引用到它们。这些未在界面中明确列出的系统参数包括了：
######隐含的系统参数说明

 | 参数名  |参数名称| 参数值（示例）  |参数引用格式|说明|
 | ------ |:------ |---------------|-----------|---|
 |LN | 换行控制符 | \n | {{LN}} | 生成一个换行符 0x10|
 |LR | 回车控制符 | \r | {{LR}} | 生成一个回车符 0x13|
 |YMDHMS | 开发板当前时间 | 24-01-05 12:00:23 | {{YMDHMS}} | 格式：年年-月月-日日 时时:分分:秒秒 |
 |YMD | 开发板当前时间 | 24-01-05  | {{YMD}} | 格式：年年-月月-日日 |
 |HMS | 开发板当前时间 |  12:00:23 | {{HMS}} | 格式：时时:分分:秒秒 |
 |NOW | 开发板当前时间戳 | 1704427223 | {{NOW}} | 格式：10位时间戳，精确到秒。|
 |ADMIN_NAME | 开发板的管理员名称 | admin | {{ADMIN_NAME}} | 与开发板后台的登录名一致。|
 |ADMIN_PWD | 开发板的管理密码 | passwd | {{ADMIN_PWD}} | 与开发板后台的登录密码一致。|
|WIFI_F_MAC | 开发板的完整Mac地址 | 64:32:2f:18:43:32 | {{WIFI_F_MAC}} | 开发板的WIFI MAC地址。|
|WIFI_S_MAC | 开发板的简化Mac地址 | 64322f184332 | {{WIFI_S_MAC}} | 开发板的WIFI MAC地址（不带分号）。|
|PRODUCT_MODEL | 开发板产品型号 | X31 | {{PRODUCT_MODEL}} | 开发板的产品型号。|
|PRODUCT_VER | 开发板固件版本号 | X31 | {{PRODUCT_VER}} | 开发板的固件版本号。|

---


### 用户参数管理

<a name="功能概述"></a>

#### 功能概述


　　“**用户参数管理**”是一个十分灵活的用户参数管理工具。合理的利用“用户参数管理”功能，可以让开发板通过简单的配置，即可完成与第三方平台的接口对接，无需编写任何程序代码。
　　


######（1）用户参数管理界面
![](https://www.lvyatech.com:37799/server/index.php?s=/api/attachment/visitFile&sign=d7c78624a241b05973a0e911818affac)
　　
###### （2）界面字段说明

　　（1.1）“**启用**”字段：只有设置为“**启用**”的用户参数，开发板才会向接口上报。但无论是否启用，用户参数在使用时，均可以被“引用”。

　　（1.2）“**参数名**”字段：用户参数的名称。合法的参数名为英文字母、数字的组合，以及包括“#”号。
  
　　（1.3）“**值**”字段：用户参数对应的实际内容。可以输入任何内容，但不允许输入换行（值的内容必须为一个完整的行）。
  
　　（1.4）“**适用消息ID**”字段：用户参数允许在哪些消息中可以被向接口上报。如果此值为空白值，则默认在所有消息中向接口上报。如果指定了消息ID（可以是多个，以“逗号”分隔），则仅在指定的消息ID中，向接口上报。
  
　　（1.5）“**分隔符**”字段：此字段只用于上报数据为JSON的情况。不填写“分隔符”时，用户参数值被认为是一个完整的字符串。如果填写了分隔符，则将用户参数值按“分隔符”进行分割，分割之后以“数组”的形式体现在JSON中。举例说明如下：
　　假设新增了一个用户参数名为 uids ，值为 a,b,c ，分隔符为“空白值”，则最终生成的JSON串格式为：
```json
{ "uids" : "a,b,c" }
```
　　在上例的基础上，如果分隔符填写为“,”（逗号），此时值“a,b,c”会按指定的分隔符“,”进行分割，并将用户参数值从“字符串”转换为“字符串数组”。最终生成的JSON串格式为：
```json
{ "uids" : [ "a" , "b" , "c" ] }
```
　　同样的，如果值为“a”，分隔符为“空白值”，则最终生成的JSON串格式为：
```json
{ "uids" : "a" }
```
　　在上例的基础上，如果分隔符填写为“,”（逗号），则最终生成的JSON串格式为：
```json
{ "uids" : [ "a" ] }
```
　　
###### （3）应用示例：
　　假如，我们需要给开发板添加一个特定的uniqID字段，字段值是：A881234 。我们希望开发板在所有的向接口上报的数据中，都携带这个信息，以便于接口一端进行后续业务处理。可以在“用户参数管理”中，先增加一个新的参数，如下图所示：
　　![](设备管理后台/（3）用户参数管理/images/7b9db5ff_63d347b95c915.png)
　　
　　按上图所示，只需要在“用户参数管理”中增加“uniqID”参数，并填写参数值：A881234，适用消息ID字段保留“空白值”，就可以了。这样，比如在100消息中，开发板向接口上报的信息中，就会自动多了一个uniqID这个字段，如下所示：
```json
{
  "devId": "498060912345",
  "type": 100,
  "ip": "192.168.7.170",
  "ssid": "mywifi",
  "dbm": 61,
  "netCh": 0,
  "uniqID" : "A881234"  /**这个是用户自定义参数**/
}
```
　　
　　此处，由于“适用消息ID”字段，保留了“空白值”。所以，默认情况下，开发板会在所有需要向接口上报的信息中，都额外增加一个“uniqID”参数。
　　如果您只希望能在特定的消息中增加这个参数，比如只希望在 100、101、102 这三个上报消息中额外增加“uniqID”参数，而其它消息不要增加这个参数，那么，您就可以在“适用消息ID”字段中，填写： 100,101,102 ，这样就可以将“uniqID”参数，限定在100、101、102这三个消息中有效。如下图所示：
　　![](设备管理后台/（3）用户参数管理/images/5b71b912_63d3497e3d1b3.png)
  
　　更多关于“适用消息ID”字段的扩展用法，您可以参见“适用消息ID”的专属讲述章节。

---

<a name="关于-参数引用"></a>

#### 关于“参数引用”


###### 关于“引用参数”的说明
　　您可以在用户参数“值”中引用“系统参数”（系统参数管理中定义），或引用已经定义的“用户参数”。
　　引用“系统参数”的格式为：```{{系统参数名}}``` 。引用“用户参数”的格式为：```{{{用户参数名}}}`` 。
  
  >总结：
　　用 **两层大括号** 引用“系统参数”，用 **三层大括号** 引用“用户参数”。
  
  **举例说明如下：**
　　（2.1）定义一个用户参数名为：devName ，参数值为：“设备名{{devId}}”。注意，这里的“参数值”中，引用了系统参数 “devId” 。定义好的用户参数示例如下：
  ![](设备管理后台/（3）用户参数管理/images/492e29e6_63d34afca2821.png)
  
　　用户参数定义完成之后，当开发板在向接口上报数据时，会在原有上报数据的基础上，额外添加“devName”这个参数，并且将devName的值进行替换，将值里面的“引用”参数，替换为实真实的数据，像下述所示：
```json
{ 
	……其它数据……,
	"devName" : "设备名498060912345"   /* {{devId}}对应的开发板唯一ID为 498060912345 */
} 
```
　　在此例中，参数值中引用的{{devId}}在实际执行时，首先被替换为设备的唯一ID，然后将替换后的结果上报到接口。

------------

　　（2.2）继续上例说明引用“用户参数”的情况。假如再额外定义一个用户参数名为：content，参数值为：“{{{devName}}}，已经成功连入WIFI网络！”。定义好的用户参数示例如下：
  ![](设备管理后台/（3）用户参数管理/images/b95d6bae_63d34c7d2437b.png)
>注意：
　　在content的参数值中，又引用了示例中定义了另一个用户参数“devName”
  
　　这种情况下，开发板在向接口上报数据时，会同时添加2个用户参数，并且对值进行计算。实际上报的数据格式是：
```json
{ 
	……其它数据……,
	"devName" : "设备名498060912345",   /* {{devId}}对应的开发板唯一ID为 498060912345 */
	"content" : "设备名498060912345，已经成功连入WIFI网络！"
}
```
　　在此例中，参数值中引用的{{{devName}}}在实际执行时，首先被替换为devName的值，然后将替换后的结果上报到接口。

------------

　　（2.3）继续上例说明“**启用**”字段的用法。假如在上报接口时，并不希望开发板向接口上报“devName”这个字段，“devName”字段仅仅是“只定义”，不希望在接口数据中体现出来，可以将“devName”字段改为“不启用”，参见下图：
　　![](设备管理后台/（3）用户参数管理/images/6d95bf9a_63ce84982653c.png)
　　只需要将“启用”字段设置为“不启用”即可。此时，对于不启用的用户变量，允许被引用，但不在最终接口上报的数据中体现。实际上报的数据格式是：
```json
{
	……其它数据……,
	"content" : "设备名498060912345，已经成功连入WIFI网络！"
}
```

------------

　　（2.4）“引用”不仅仅可以用在“用户参数值”中，也可以在“接口地址”中添加对“系统变量”或“用户变量”的引用。
假如我们有多块开发板，因为某种特殊的原因，希望每一块开发板都向“特定的”HTTP接口地址上报数据，那么可以在接口地址中直接添加对devId的引用，如下图所示：
　　![](设备管理后台/（3）用户参数管理/images/a3ab18a7_63ce877ce9fa8.png)
  
　　比如，接口地址的填写内容为：`https://www.domain/api/{{devId}}_send/`，将来在开发板向接口地址上报数据时，接口地址会首先被计算，计算后的真实的接口地址是：`https://www.domain/api/498060912345_send/`。通过这种方式，我们就可以实现让每一块开发板，都有自己独立的接口地址。
　　
　　同样的，接口地址中不仅仅可以引用“系统参数”，也可以引用“用户参数”。用法类似，在此就不在展开赘述了。
  
######开发板中允许引用参数的项目：
1）“用户参数管理”功能中，所有“值”的位置：
![](设备管理后台/（3）用户参数管理/images/948657c5_68564d9963b8b.png)
-

2）“接口信息配置”中，URL地址与http头的值：
![](设备管理后台/（3）用户参数管理/images/1e43111c_68564e38b213f.png)

-

3）“自定义接口消息”中的所有消息内容：
![](设备管理后台/（3）用户参数管理/images/ef044f7f_68564e9820186.png)


-

4）“通讯加密”中的“Token生成策略”：
![](设备管理后台/（3）用户参数管理/images/b874b066_68564f06a8d76.png)

-

5）“运行参数管理”中标记为允许写计算式的项目：
![](设备管理后台/（3）用户参数管理/images/0854974e_68564f5897364.png)

---

<a name="关于-适用消息id"></a>

#### 关于“适用消息ID”


###### “适用消息ID”字段列的使用说明
　　通过“适用消息ID”字段，可以将用户参数限定在特定的“消息ID”中进行上报。
　　比如，我们定义了用户参数：content，对应的值为“{{devId}}已经成功连入WIFI”，“适用消息ID”字段为空白值。
　　那么，开发板会在每一个允许上报的消息ID中，额外添加用户自定义参数 content。
　　实际向接口上报的数据格式如下：
```json
{
	……其它参数……,
	"content" : "498060912345已经成功连入WIFI"
}
```
　　在某些情况下，假设我们只希望content参数，仅仅在100、101、102消息中出现，而其它消息不出现此参数，则只需要在“适用消息ID”字段中填写以下内容：`100,101,102`，即可完成设置。
  
　　接下来，我们再考虑一种稍稍复杂的情况，比如，我们希望在100消息中 content 字段的值为：“{{devId}}已经成功连入WIFI”。但是又希望在501消息中 content 字段的值为：“新短信到达！内容：{{smsBody}}”。

　　这种情况下，我们只需要在“用户参数管理”中，定义两个 content 参数，并通过“适用消息ID”字段，填写不同的消息ID，进行区分就可以了。如下图所示：
　　![](设备管理后台/（3）用户参数管理/images/9a2e9acb_63ce8d7c125ed.png)
  
　　通过“适用消息ID”字段分隔之后，开发板会在不同的消息中，针对 content 字段，分别上报不同的消息内容，例如在100消息中上报内容的格式是：
```json
{
	……其它参数……,
	"content" : "498060912345已经成功连入WIFI"
}
```
　　而在501消息中上报内容的格式是：
```json
{
	……其它参数……,
	"content" : "新短信到达！内容：短信测试123456"  /* 短信测试123456 是SIM卡收到短信内容 */
}
```

------------


　　然而，在实际的使用过程中，在用户参数管理中定义两个以上，具有相同名字的“用户参数”，并不是一个好办法。因为这将带来至少两方面的问题：
　　1）多个相同名字的“用户参数”，可读性差，容易搞错也比较难以理解。
　　2）如果在另一个用户参数中需要引用 content 参数时，开发板无法区分用户究竟想引用的是哪一个 content 。
　　
　　推荐的方法是，在定义两个content参数名后面增加 “#数字”，以区分具体是哪一个content。如下图所示：
　　![](设备管理后台/（3）用户参数管理/images/bc6f55e0_63ce8fd391a9a.png)
  
>注意：
　　“#”号后面必须跟数字，具体的数值可以自己指定。
　　开发板向接口上报时，“#”号以及后面的数字会自动的去除，所以 `content#1` 实际上报的名称，将仍然是：`content` 。
  
　　另外，如需在其它的用户参数中引用 content#1 时，就可以直接写为： `{{{content#1}}}` ，这样开发板就可以清楚的知道了引用的具体参数是哪一个。

---


### 自定义接口消息

<a name="功能概述"></a>

#### 功能概述


　　“**自定义接口消息**”是一个完全由用户掌控，自由定制消息格式的管理工具。合理的利用“自定义接口消息”功能，可以让开发板通过简单的配置，即可完成与第三方平台的接口对接，无需编写任何程序代码。

######（1）自定义接口消息界面
![](设备管理后台/（4）自定义接口消息/images/eb504ba7_63d3347e94e3e.png)

　　
　　使用时，首先选择您要定制的消息ID，然后在下方的“自定义消息内容”文本框中，输入您的消息格式。下面，以接入钉钉群的webhook机器人为例，向您讲述本功能的使用方法。
　　首先，根据钉钉接口文档中的约定，第三方与钉钉机器人通讯时，必须按照以下格式向机器人发送消息：
```json
{
    "text": {
        "content":"我就是我, @XXX 是不一样的烟火"
    },
    "msgtype":"text"
}
```
> 具体参见钉钉API文档：https://open.dingtalk.com/document/app/custom-robot-access

　　将上面的JSON消息发送到指定的钉钉机器人时，钉钉机器人会自动在钉钉群中显示以下信息：
![](设备管理后台/（4）自定义接口消息/images/56b56724_63d337f23744e.png)
　　
　　以上面的例子为基础，如果我们希望开发板自动连入WIFI之后，能够让钉钉机器人在群里发送一个上线消息，比如：“设备xxxx已经成功联网上线啦~”，可以这样设置：
![](设备管理后台/（4）自定义接口消息/images/4b82f469_63d338c0a3a21.png)
　　
　　这里，将content字段中的内容改为：“设备{{devId}}已经成功联网上线啦~”就可以了。其中{{devId}}是对系统变量的引用，用于在显示时替换成真实的开发板全球唯一ID。成功示例如下：
  ![](设备管理后台/（4）自定义接口消息/images/4cc64961_63d33a4f4b362.png)
　　
　　这样，每次开发板上线之后，都会在通过钉钉机器人发送一条开发板的上线提醒。
  
　　接下来，我们再考虑一个稍稍复杂一点的例子，比如，我们希望开发板上线成功后，把开发板当前的IP地址以及WIFI信号强度也一同显示出来，那么，就可以这样设置：
  ![](设备管理后台/（4）自定义接口消息/images/505cce23_63d343f483d3c.png)
  　　
　　这里，将content字段中的内容改为：“设备{{devId}}已经成功联网上线啦~{{LN}}设备IP：{{ip}}{{LN}}信号强度：{{dbm}}”。其中，{{LN}}是引用的换行符，{{ip}}与{{dbm}}分别引用的是wifi的IP地址与wifi信号强度百分比。成功示例如下 ：
  ![](设备管理后台/（4）自定义接口消息/images/d0911adb_63d344a356eef.png)
  
　　
　　对于其它消息的格式定义，与本文中的示例使用方法相同。
　　有关“引用”的相关示例，您可以参见“用户参数管理”的相关章节。

---


### 密码管理

<a name="功能概述"></a>

#### 功能概述


　　“**密码管理**”功能可以对开发板中的各种密码进行统一的管理。
  
　　开发板的密码体系分为两个层次，最低层级的是“**用户密码**”，当开发板打包成最终产品，并向最终用户发售后，“用户密码”由最终用户掌控并使用。通过“用户密码”可以完成对开发板的一般性操作，比如：发短信指令重启开发板、通过短信指令帮助开发板连入WIFI网络等基本操作。
  
　　最高层次的是“**管理密码**”，通过“管理密码”可以登录到开发板后台WEB管理界面，完成开发板底层的接口配置等“系统级操作”，也可以完成诸如开发板恢复出厂设置，以及对“用户密码”进行重置等操作。
　　
######（1）密码管理功能界面
![](设备管理后台/（5）密码管理/images/4b3d7551_63d469d759713.png)

　　
######（2）设置用户密码
　　在某些场景中，系统管理员可以登录到开发板后台WEB管理页面，完成对用户密码的修改或重置。开发板默认出厂时的用户密码为“000000”，系统管理员可以根据修改对用户密码进行修改。
  
　　修改用户密码时，只需要在用户密码文本框中输入新的用户密码，然后点击“保存用户密码”按钮，即可完成操作。
  ![](设备管理后台/（5）密码管理/images/32e6a1a3_63d46b24d46a3.png)
  　　
######（3）设置管理密码
　　系统管理员可以登录到开发板后台WEB管理员，对管理密码进行修改。开发板默认出厂时的管理用户名、密码默认是：admin/admin ，管理用户名目前暂不支持修改，管理员可以修改自己的“管理密码”。
  
　　修改管理密码时，只需要正常填入旧的管理密码，再输入新的管理密码，然后点击“保存管理密码”按钮，即可完成操作。

![](设备管理后台/（5）密码管理/images/d6514817_63d46c674bb83.png)

　　
> 说明：
	如果旧的管理密码已经遗失，则只能通过将开发板“重置回出厂设置”的方式恢复管理密码。
　　注意：将开发板重置回出厂设置之后，之前配置的所有信息都将丢失。
  
　　在“设置管理密码”的区域中，开发板将根据当前生效的管理员，自动计算出对应的token值，并显示在界面上。当您需要使用到token值时，无需要手工计算，可以直接在界面上复制后使用。
  
　　token值分为“全长”与“半长”两种形式，分别应用于不同的使用场景。一般情况下，在使用“控制指令”时，通常都要求使用“全长”的token。而在“短信指令”时，考虑到短信字符数的限制等原因，通常使用的是“半长”的token。
  
　　“全长”的Token是32位的，即界面中“token：”后面的所有32位字符；而“半长”的token是16位的，即界面中“token:”后面的红色字符的部分（中间16位）。
  
> 注意：
　　更多关于“token”的生成与计算方法，请参阅：控制指令--“安全模型与token机制”的章节。
  
**（4）通讯AES加密设置**

　　为了确保更优的安全性，开发板向接口上报的数据，允许被加密。开发板支持的加密算法是：
  `AES128 CBC pkcs#7 padding`
　　如果开启了开发板的AES加密，则开发板向接口上报的所有数据，在上报前都将进行加密。
  ![](设备管理后台/（5）密码管理/images/d5b1736f_63d46f62878a7.png)
　　AES128加密算法包括了两个参数：**KEY**、**IV**，这两个参数的长度都必须是16字节。参数的内容可以是ASCII（例如英文数字符号的组合）、也可以是10进制或16进制的字符序列。
　　参数内容是ASCII的示例：
  ![](设备管理后台/（5）密码管理/images/3f90e3bd_63d47197acf5b.png)
　　
　　参数内容是10进制的示例：
    ![](设备管理后台/（5）密码管理/images/86eb997d_63d471b4c0aeb.png)
	
>注意：
　　当采用10进制输入的格式时，多个数字之间用“半角逗号”分隔，逗号之间的数字取值从0 - 255。
  
　　
　　参数内容是16进制的示例：
    ![](设备管理后台/（5）密码管理/images/44dcf8aa_63d471c6570e6.png)

>注意：
　　当采用16进制输入的格式时，多个数字之间用“半角逗号”分隔，逗号之间的数字取值从0x0 - 0xff。
  
　　
　　
######（5）开启AES加密之后的数据上报形式
　　以100消息为例子，在非加密模式中，开发板向接口上报的100消息原文内容如下：
```json
{
  "devId":"f8efb2835b9e",
  "type":100,
  "netCh":0,
  "hwVer":"Y57v688",
  "ip":"192.168.1.236",
  "dbm":68
}
```
######（5.1）HTTP GET（POST） + FORM 加密上报形式
```html
http://www.domain.com/inf?devId=7Y9vX%2F2YKkUdweHH0uuMOQ%3D%3D&type=NivpxnnqXo27vWl3FDnwEg%3D%3D&netCh=lhZj0Fqwf7QDFDmgVM2xRw%3D%3D&hwVer=hIBb1DGuMJqSKbt02MmNmQ%3D%3D&ip=UnWfxXD7kSLYDSBEfrbOvA%3D%3D&dbm=MeXeApcLwpjbqkt7mn5VfQ%3D%3D&charset=JXH0hcPClFh9W0CoEU9Y0Q%3D%3D&/
```
　　采用HTTP + FORM模式时，开发板采用的是：**“参数名”不加密，“参数值”加密** 的方式，向接口上报。（上例以HTTP GET为例子，HTTP POST同理）
　　接口在接收到开发板的数据上报请求时，可以直接在request对象中获取到参数，并对参数值进行AES128算法解密之后，获取到真实的数据值。
  
######（5.2）HTTP GET + JSON 加密上报形式
```html
http://www.domain.com/inf?p=c0ikfw75jCueMeTDUmENq1d6vSJ%2FAr%2F9b9oMcIk44lgHCCh0eVqMTQyZvxEn71zCQLTarfNPjqhmeDZ%2B%2Bt7QKWf%2F%2FZ7u5p3Pyj57BUCkKYWQwc582hxSidFSut1ASwJF
```
　　采用HTTP GET + JSON模式时，JSON数据加密后，被放在固定的参数名“p”参数中。
　　接口在接收到开发板的数据上报请求时，可以直接在request对象中获取到参数“p”，并对参数值进行AES128算法解密之后，获取到真实的数据值。
  
######（5.3）HTTP POST + JSON 加密上报形式
```json
{
"p":"c0ikfw75jCueMeTDUmENq1d6vSJ/Ar/9b9oMcIk44lgHCCh0eVqMTQyZvxEn71zCQLTarfNPjqhmeDZ++t7QKWf//Z7u5p3Pyj57BUCkKYWQwc582hxSidFSut1ASwJF"
}
```

　　采用HTTP POST + JSON模式时，JSON数据加密后，被重新打包为 **{ "p": BASE64 }** 的JSON格式，向接口上报。
　　接口在接收到开发板的数据上报请求时，可以对JSON中的成员“p”的值进行AES128算法解密之后，获取到真实的数据值。
  
######（5.4）TCP接口 加密上报形式
```json
{"p":"c0ikfw75jCueMeTDUmENq1d6vSJ/Ar/9b9oMcIk44lgHCCh0eVqMTQyZvxEn71zCQLTarfNPjqhmeDZ++t7QKWf//Z7u5p3Pyj57BUCkKYWQwc582hxSidFSut1ASwJF"}\x11\x12
```

　　采用TCP模式时，JSON数据加密后，被重新打包为 { "p": BASE64 }的JSON格式，向接口上报。
　　接口在接收到开发板的数据上报请求时，可以对JSON中的成员“p”的值进行AES128算法解密之后，获取到真实的数据值。
>注意：
　　在TCP接口模式中，消息分段符“0x11 0x12”并不会被加密。用户在接口端仍然可以通过“0x11 0x12”对数据进行分段，以区分开发板上报的每一个完整的消息。

---


### 附加函数

<a name="附加函数概述"></a>

#### 附加函数概述


　　在开发板中引用 ***系统参数*** 或 ***用户参数*** 时，可以在参数后面，添加***附加函数***，对数据进一步处理。
  
　　例如，引用系统参数：{{devId}} 获取设备ID时，希望最终获取到 大写格式 的设备ID，则可以编写以下计算式：
 ``{{devId|$toUpper()}}`` 
　　在此计算式中，先是引用了一个系统参数，然后对devId的值通过***附加函数*** $toUpper() 将其转大写格式。。
  
　　***附加函数***可以同时引用多个，如果需要引用管理员密码 {{ADMIN_PWD}} 的值，但不希望直接获取到 {{ADMIN_PWD}} 的明文，而是获取对应的16字节md5值的大写格式，可以编写以下计算式：
``{{ADMIN_PWD|$md5('16')|$toUpper()}}``
　　在此计算式中，先获取ADMIN_PWD的值（管理员密码明文），然后对明文进行MD5计算，并取16字节的哈希值（结果类似于：4f2d8fac2345dfa8），最后对哈希值转为大写输出：4F2D8FAC2345DFA8

```text
总结：
1）所有的附加函数都是 $ 开头，格式为： $函数名('参数')。
2）在参数中添加附加函数时，必须以 | 分隔。
3）一个参数中，可以同时添加多个附加函数。
```

>注意！
- 附加函数严格区分大小写。
- 附加函数中的参数，无论参数类型，都必须用**单引号**囊括。

######扩展示例：


　　**（示例１）：**
　　引用 {{devId}} 获取设备ID时，希望获取到 设备ID（devId) 的大写值，并对 大写设备ID值 进行MD5计算，最终获取到 设备ID 大写值的16位MD5值。计算式写为：：
 ``{{devId|$toUpper()|$md5('16')|$toUpper()}}`` 
  
-
　　**（示例２）：**
　　附加函数的参数，也可以是一个另一个系统参数或用户参数，例如：
  
``{{devId|$concat('-', '{{now}}', '-', '{{ip}}')}}``

计算的最终结果是：`` 23d64887Fa-1725644897-192.168.1.12 ``

这个计算式的计算过程是：先获取devId的值（23d64887Fa），然后与$concat()中指定的4个参数逐一拼接：
```
拼接$concat()的参数1： 23d64887Fa-
拼接$concat()的参数2： 23d64887Fa-1725644897
拼接$concat()的参数3： 23d64887Fa-1725644897-
拼接$concat()的参数4： 23d64887Fa-1725644897-192.168.1.12
```
-
　　**（示例３）：**
　　附加函数的参数可以是另外一个系统参数或用户参数，但是，引用的参数中的附加函数不允许再携带参数，例如：
  
  ***正确***：``{{devId|$concat('-', '{{ip|$trim()}}') }}``
　　=> $concat()函数的参数２，引用系统参数ip以及不带参数的附加函数$trim()
  
  ***错误***：``{{devId|$concat('-', '{{ip|$replace('.', ';')}}') }}``
　　=> $concat()函数的参数２，引用系统参数ip以及***带参数***的附加函数$replace()

　　解决此类问题的方法是，把 {{ip|$replace('.', ';')}}定义为一个单独的“用户参数”，在$concat()中引用这个“用户参数”即可。例如：
  
　　在用户参数管理中定义一个用户参数：
　　```用户参数名：ip_fmt　　用户参数值：{{ip|$replace('.', ';')}}```
  
　　然后将计算式改写为：  ``{{devId|$concat('-', '{{{ip_fmt}}}') }}``

---

<a name="附加函数清单"></a>

#### 附加函数清单


######系统所支持的附加函数清单

 | 函数名  | 函数说明 | 参数 | 函数示例   |
 | --- |---|---|---------------------|
 | $replace() | 文本替换 | 以偶数配对出现 |示例：<BR><div style="width: 250pt"> {{devId&#124;$replace('a', 'A', 'bcd', 'BCD')}} </div>  说明：<BR>   对devId中的值，进行文本替换，将小写a全部替换成大写A，同时，将bcd全部替换成BCD。|
 |$substr()|字符串截取| 2个。<BR>截取字符串的<BR>起始位置(从1开始）<BR>与结束位置| 示例：<BR>{{devId&#124;$substr('1', '3')}} <BR>说明：<BR>从第1个字符之后，取到第3个字符(含)。例如：devId的值假设是 abcdef，则substr(1,3)的最终结果是：bc。|
 |$concat()|字符串拼接| 多个。<BR>将函数参数中的<BR>多个字符串与<BR>引用参数进行拼接| 示例：<BR>{{devId&#124;$concat('-', '{{ip}}')}} <BR>说明：<BR>将devId的值与横线符及当前IP进行拼接。<BR>例如：devId的值假设是 abcdef，则$concat('-', '{{ip}}')的最终结果是：<BR>abcdef-192.168.1.12|
  | $md5() | 计算md5值<BR>（小写） | 0或1个。默认取32字节的MD5 <BR> HEX字符串，也可以指定其它长度，<BR>但必须是偶数。 | 示例：<BR>{{devId&#124;$md5('16')}} <BR>说明：<BR>取devId值的16字节长的HEX字符串。|
  | $sha256() | 计算SHA-256值<BR>（大写） | 无 | 示例：<BR>{{devId&#124;$sha256()}} <BR>说明：<BR>取devId的SHA-256的Hash值的HEX字符串（64字节）。|
  | $toUpper() | 取字符串大写值 | 无 | 示例：<BR>{{devId&#124;$toUpper()}} <BR>说明：<BR>取对应字符串，大写之后的值|
   | $toLower() | 取字符串小写值 | 无 | 示例：<BR>{{devId&#124;$toLower()}} <BR>说明：<BR>取对应字符串，小写之后的值|
   | $jsonEscape()| 对json串中的字符<BR>进行转义，确保<BR>结果符合json格式| 无  | 示例：<BR>{{smsBd&#124;$jsonEscape()}} <BR>说明：<BR>有一些特殊字符是不允许出现在json串中的，比如双引号、换行符等等。可通过jsonEscape()对字符串进行json转义处理，使其符合json规范。|
 | $aesBase64() | 对字符串进行<BR>AES加密，返回标准的<BR>base64字符串。 | 无 | 示例：<BR>{{devId&#124;$aes()}} <BR>说明：<BR>对字符串进行加密，并获取加密后的值。注意：aes加密所使用到的Key/IV等参数，以及加密算法，请通过开发板后台--“密码管理”功能中进行设置。|
 | $aesBase64Url() | 对字符串进行<BR>AES加密，返回可用于<BR>http传输的标准Base64<BR>字符串。<BR>**（推荐使用）** | 无 | 示例：<BR>{{devId&#124;$aes()}} <BR>说明：<BR>对字符串进行加密，并获取加密后的值。注意：aes加密所使用到的Key/IV等参数，以及加密算法，请通过开发板后台--“密码管理”功能中进行设置。|
 | $defaultIfEmpty() | 如果引用变量的长度是0，<BR>则返回参数指定的值，<BR>否则返回变量值。 | 1个。如果引用变量长度是0，则返回参数中的字符串。 | 示例：<BR>{{phNum&#124;$ifEmpty('隐藏号码')}} <BR>说明：<BR>如果所引用的变量长度是0，则返回参数中的字符串。示例中，如果来电号码为空，则显示“隐藏号码”字样。|
 | $defaultIfBlank() | 如果引用变量是空白串，<BR>则返回参数指定值，<BR>否则返回变量值 | 1个。如果字符串判空成立，则返回参数中的字符串，否则返回引用的变量值。 | 示例：<BR>{{smsBd&#124;$ifEmpty('无短信内容')}} <BR>说明：<BR>如果所引用的变量是空串（字符串长度是0，或字符串全部是空格），则返回参数中的字符串。示例中，如果短信内容为空（无内容或内容都是空格），则显示“无短信内容”字样。|
 | $nothingIfEmpty() | 如果引用的变量长度是0，<BR>则返回参数指定的值，<BR>否则返回空 | 1个。如果引用变量长度是0，则返回参数中的字符串，否则返回空。 | $defaultIfNotEmpty()的反函数。|
 | $nothingIfBlank() | 如果引用的变量是空白串，<BR>则返回参数指定的值，<BR>否则返回空 | 1个。如果引用变量是空白串，则返回参数中的字符串，否则返回空。 | $defaultIfNotBlank()的反函数。 |
 | $nothingIfNotEmpty() | 如果引用变量的长度**不是**0，<BR>则返回参数指定的值，<BR>否则返回空。 | 1个。如果引用变量长度不是0，则返回参数中的字符串。 | |
 | $nothingIfNotBlank() | 如果引用变量是**非**空白串，<BR>则返回参数指定的值，<BR>否则返回空。 | 1个。如果字符串判非空成立，则返回参数中的字符串，否则返回空。 | |
 | $trim() | 对字符串<BR>前后空格<BR>进行剔除 | 无 | 示例：<BR>{{smsBd&#124;$trim()}} <BR>说明：<BR>剔除掉字符串中的前后空格（如有）。|
 | $urlEncode() | 对引用的变量值<BR>进行URL Encode编码 | 无 | 示例：<BR>{{smsBd&#124;$urlEncode()}} <BR>说明：<BR>将短信内容进行URL Encode编码。|
 | $urlDecode() | 对引用的变量值<BR>进行URL Decode解码 | 无 | 示例：<BR>{{smsBd&#124;$urlDecode()}} <BR>说明：<BR>将短信内容进行URL Decode解码。|
 | $ts2yyyymmdd() | 对引用的时间戳变量<BR>格式化为年月日格式 | 1个。<BR>年月日中间的分隔字符 | 示例：<BR>{{smsTs&#124;$ts2yyyymmdd('-')}} <BR>说明：<BR>将短信时间戳格式为：YYYY-MM-DD格式。|
 | $ts2yymmdd() | 对引用的时间戳变量<BR>格式化为年月日格式 | 1个。<BR>年月日中间的分隔字符 | 示例：<BR>{{smsTs&#124;$ts2yymmdd('-')}} <BR>说明：<BR>将短信时间戳格式为：YY-MM-DD格式。|
 | $ts2yyyymmddhhmmss() | 对引用的时间戳变量<BR>格式化为年月日时分秒格式 | 2个。<BR>参数1：年月日中间的分隔符；参数2：时分秒中间的分隔符 | 示例：<BR>{{smsTs&#124;$ts2yyyymmddhhmmss('-', ':')}} <BR>说明：<BR>将短信时间戳格式为：YYYY-MM-DD HH:MM:SS 格式。|
 | $ts2yymmddhhmmss() | 对引用的时间戳变量<BR>格式化为年月日时分秒格式 | 2个。<BR>参数1：年月日中间的分隔符；参数2：时分秒中间的分隔符 | 示例：<BR>{{smsTs&#124;$ts2yymmddhhmmss('-', ':')}} <BR>说明：<BR>将短信时间戳格式为：YY-MM-DD HH:MM:SS 格式。|
 | $ts2hhmmss() | 对引用的时间戳变量<BR>格式化为时分秒格式 | 1个。<BR>时分秒中间的分隔符 | 示例：<BR>{{smsTs&#124;$ts2hhmmss(':')}} <BR>说明：<BR>将短信时间戳格式为：HH:MM:SS 格式。|
  | $iifeq() | 匹配参数1的值，转为输出参数2 | 偶数个 | 示例：<BR>{{slot&#124;$iifeq('1', '卡一', '2', '卡二')}} <BR>说明：<BR>将slot值的1,2 转为中文。|

---
